<!DOCTYPE html>
<html class="no-js lt-ie9" lang="en">
<html class="no-js" lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Channels 1.0.3 documentation</title>
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css"/>
    <link rel="top" title="None" href="index.html#document-index"/>
    <script src="_static/js/modernizr.min.js"></script>
    <link rel="canonical" href="http://channels.readthedocs.io/en/stable/"/>
    <link rel="stylesheet" href="https://media.readthedocs.org/css/readthedocs-doc-embed.css" type="text/css"/>
    <script type="text/javascript" src="_static/readthedocs-data.js"></script>
    <script type="text/javascript">READTHEDOCS_DATA['page'] = 'index'</script>
    <script type="text/javascript" src="_static/readthedocs-dynamic-include.js"></script>
</head>
<body class="wy-body-for-nav" role="document">
<div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
        <div class="wy-side-scroll">
            <div class="wy-side-nav-search">
                <a href="index.html#document-index" class="icon icon-home">Channels</a>

                <div class="version">stable</div>
                <div role="search">
                    <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
                        <input type="text" name="q" placeholder="Search docs"/>
                        <input type="hidden" name="check_keywords" value="yes"/>
                        <input type="hidden" name="area" value="default"/>
                    </form>
                </div>
            </div>
            <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="index.html#document-inshort">In Short</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="index.html#document-concepts">Channels
                        Concepts</a></li>
                    <li class="toctree-l1"><a class="reference internal" href="index.html#document-installation">Installation</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="index.html#document-getting-started">Getting
                        Started with Channels</a></li>
                    <li class="toctree-l1"><a class="reference internal"
                                              href="index.html#document-deploying">Deploying</a></li>
                    <li class="toctree-l1"><a class="reference internal" href="index.html#document-generics">Generic
                        Consumers</a></li>
                    <li class="toctree-l1"><a class="reference internal" href="index.html#document-routing">Routing</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="index.html#document-binding">Data
                        Binding</a></li>
                    <li class="toctree-l1"><a class="reference internal" href="index.html#document-backends">Channel
                        Layer Types</a></li>
                    <li class="toctree-l1"><a class="reference internal" href="index.html#document-delay">Delay
                        Server</a></li>
                    <li class="toctree-l1"><a class="reference internal" href="index.html#document-testing">Testing
                        Consumers</a></li>
                    <li class="toctree-l1"><a class="reference internal"
                                              href="index.html#document-reference">Reference</a></li>
                    <li class="toctree-l1"><a class="reference internal" href="index.html#document-faqs">Frequently
                        Asked Questions</a></li>
                    <li class="toctree-l1"><a class="reference internal" href="index.html#document-asgi">ASGI
                        (Asynchronous Server Gateway Interface) Draft Spec</a></li>
                    <li class="toctree-l1"><a class="reference internal" href="index.html#document-community">Community
                        Projects</a></li>
                    <li class="toctree-l1"><a class="reference internal" href="index.html#document-contributing">Contributing</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="index.html#document-releases/index">Release
                        Notes</a></li>
                </ul>
            </div>
        </div>
    </nav>
    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
        <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
            <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
            <a href="index.html#document-index">Channels</a>
        </nav>
        <div class="wy-nav-content">
            <div class="rst-content">
                <div role="navigation" aria-label="breadcrumbs navigation">
                    <ul class="wy-breadcrumbs">
                        <li><a href="index.html#document-index">Docs</a> &raquo;</li>
                        <li>Channels 1.0.3 documentation</li>
                        <li class="wy-breadcrumbs-aside">
                            <a href="https://github.com/django/channels/blob/20af4e31b401c6589daeac26fbca89e1b512da97/docs/index.rst"
                               class="fa fa-github"> Edit on GitHub</a>
                        </li>
                    </ul>
                    <hr/>
                </div>
                <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
                    <div itemprop="articleBody">
                        <div class="section" id="django-channels">
                            <h1>Django Channels<a class="headerlink" href="#django-channels"
                                                  title="Permalink to this headline">¶</a></h1>

                            <p>Channels is a project to make Django able to handle more than just plain HTTP requests,
                                including WebSockets and HTTP2, as well as the ability to run code after a response has
                                been sent for things like thumbnailing or background calculation.</p>

                            <p>Its an easy-to-understand extension of the Django view model, and easy to integrate and
                                deploy.</p>

                            <p>First, read our <a class="reference internal" href="index.html#document-concepts"><em>Channels
                                Concepts</em></a> documentation to get an idea of the data model underlying Channels and
                                how they&#8217;re used inside Django.</p>

                            <p>Then, read <a class="reference internal" href="index.html#document-getting-started"><em>Getting
                                Started with Channels</em></a> to see how to get up and running with WebSockets with
                                only 30 lines of code.</p>

                            <p>If you want a quick overview, start with <a class="reference internal"
                                                                           href="index.html#document-inshort"><em>In
                                Short</em></a>.</p>

                            <p>If you are interested in contributing, please read our <a class="reference internal"
                                                                                         href="index.html#document-contributing"><em>Contributing</em></a>docs!
                            </p>

                            <div class="section" id="projects">
                                <h2>Projects<a class="headerlink" href="#projects"
                                               title="Permalink to this headline">¶</a></h2>

                                <p>Channels is comprised of five packages:</p>
                                <ul class="simple">
                                    <li><a class="reference external" href="https://github.com/django/channels/">Channels</a>,
                                        the Django integration layer
                                    </li>
                                    <li><a class="reference external"
                                           href="https://github.com/django/daphne/">Daphne</a>, the HTTP and Websocket
                                        termination server
                                    </li>
                                    <li><a class="reference external"
                                           href="https://github.com/django/asgiref/">asgiref</a>, the base ASGI
                                        library/memory backend
                                    </li>
                                    <li><a class="reference external" href="https://github.com/django/asgi_redis/">asgi_redis</a>,
                                        the Redis channel backend
                                    </li>
                                    <li><a class="reference external" href="https://github.com/django/asgi_ipc/">asgi_ipc</a>,
                                        the POSIX IPC channel backend
                                    </li>
                                </ul>
                                <p>This documentation covers the system as a whole; individual release notes and
                                    instructions can be found in the individual repositories.</p>
                            </div>
                            <div class="section" id="topics">
                                <h2>Topics<a class="headerlink" href="#topics" title="Permalink to this headline">¶</a>
                                </h2>

                                <div class="toctree-wrapper compound">
                                    <span id="document-inshort"></span>

                                    <div class="section" id="in-short">
                                        <h3>In Short<a class="headerlink" href="#in-short"
                                                       title="Permalink to this headline">¶</a></h3>

                                        <div class="section" id="what-is-channels">
                                            <h4>What is Channels?<a class="headerlink" href="#what-is-channels"
                                                                    title="Permalink to this headline">¶</a></h4>

                                            <p>Channels extends Django to add <a class="reference internal"
                                                                                 href="index.html#what-are-channels"><span>a new layer</span></a>
                                                that allows two important features:</p>
                                            <ul class="simple">
                                                <li>WebSocket handling, in a way very <a class="reference internal"
                                                                                         href="index.html#websocket-example"><span>similar to normal views</span></a>
                                                </li>
                                                <li>Background tasks, running in the same servers as the rest of
                                                    Django
                                                </li>
                                            </ul>
                                            <p>It allows other things too, but these are the ones you&#8217;ll use to
                                                start with.</p>
                                        </div>
                                        <div class="section" id="how">
                                            <h4>How?<a class="headerlink" href="#how"
                                                       title="Permalink to this headline">¶</a></h4>

                                            <p>It separates Django into two process types:</p>
                                            <ul class="simple">
                                                <li>One that handles HTTP and WebSockets</li>
                                                <li>One that runs views, websocket handlers and background tasks (<em>consumers</em>)
                                                </li>
                                            </ul>
                                            <p>They communicate via a protocol called <a class="reference internal"
                                                                                         href="index.html#document-asgi"><em>ASGI</em></a>,
                                                which is similar
                                                to WSGI but runs over a network and allows for more protocol types.</p>

                                            <p>Channels does not introduce asyncio, gevent, or any other async code to
                                                your Django code; all of your business logic runs synchronously in a
                                                worker
                                                process or thread.</p>
                                        </div>
                                        <div class="section" id="i-have-to-change-how-i-run-django">
                                            <h4>I have to change how I run Django?<a class="headerlink"
                                                                                     href="#i-have-to-change-how-i-run-django"
                                                                                     title="Permalink to this headline">¶</a>
                                            </h4>

                                            <p>No, all the new stuff is entirely optional. If you want it, however, you&#8217;ll
                                                change from running Django under a WSGI server, to running:</p>
                                            <ul class="simple">
                                                <li>An ASGI server, probably <a class="reference external"
                                                                                href="http://github.com/django/daphne/">Daphne</a>
                                                </li>
                                                <li>Django worker servers, using <code class="docutils literal"><span
                                                        class="pre">manage.py</span> <span class="pre">runworker</span></code>
                                                </li>
                                                <li>Something to route ASGI requests over, like Redis.</li>
                                            </ul>
                                            <p>Even when you&#8217;re running on Channels, it routes all HTTP requests
                                                to the Django
                                                view system by default, so it works like before.</p>
                                        </div>
                                        <div class="section" id="what-else-does-channels-give-me">
                                            <h4>What else does Channels give me?<a class="headerlink"
                                                                                   href="#what-else-does-channels-give-me"
                                                                                   title="Permalink to this headline">¶</a>
                                            </h4>

                                            <p>Other features include:</p>
                                            <ul class="simple">
                                                <li>Easy HTTP long-poll support for thousands of clients at once</li>
                                                <li>Full session and auth support for WebSockets</li>
                                                <li>Automatic user login for WebSockets based on site cookies</li>
                                                <li>Built-in primitives for mass triggering of events (chat, live blogs,
                                                    etc.)
                                                </li>
                                                <li>Zero-downtime deployment with browsers paused while new workers spin
                                                    up
                                                </li>
                                                <li>Optional low-level HTTP control on a per-URL basis</li>
                                                <li>Extendability to other protocols or event sources (e.g. WebRTC, raw
                                                    UDP, SMS)
                                                </li>
                                            </ul>
                                        </div>
                                        <div class="section" id="does-it-scale">
                                            <h4>Does it scale?<a class="headerlink" href="#does-it-scale"
                                                                 title="Permalink to this headline">¶</a></h4>

                                            <p>Yes, you can run any number of <em>protocol servers</em> (ones that serve
                                                HTTP
                                                and WebSockets) and <em>worker servers</em> (ones that run your Django
                                                code) to
                                                fit your use case.</p>

                                            <p>The ASGI spec allows a number of different <em>channel layers</em> to be
                                                plugged in
                                                between these two components, with different performance
                                                characteristics, and
                                                it&#8217;s designed to allow both easy sharding as well as the ability
                                                to run
                                                separate clusters with their own protocol and worker servers.</p>
                                        </div>
                                        <div class="section" id="why-doesn-t-it-use-my-favourite-message-queue">
                                            <h4>Why doesn&#8217;t it use my favourite message queue?<a
                                                    class="headerlink"
                                                    href="#why-doesn-t-it-use-my-favourite-message-queue"
                                                    title="Permalink to this headline">¶</a></h4>

                                            <p>Channels is deliberately designed to prefer low latency (goal is a few
                                                milliseconds)
                                                and high throughput over guaranteed delivery, which doesn&#8217;t match
                                                some
                                                message queue designs.</p>

                                            <p>Some features, like <a class="reference internal"
                                                                      href="index.html#enforcing-ordering"><span>guaranteed ordering of messages</span></a>,
                                                are opt-in as they incur a performance hit, but make it more message
                                                queue like.</p>
                                        </div>
                                        <div class="section"
                                             id="do-i-need-to-worry-about-making-all-my-code-async-friendly">
                                            <h4>Do I need to worry about making all my code async-friendly?<a
                                                    class="headerlink"
                                                    href="#do-i-need-to-worry-about-making-all-my-code-async-friendly"
                                                    title="Permalink to this headline">¶</a></h4>

                                            <p>No, all your code runs synchronously without any sockets or event loops
                                                to
                                                block. You can use async code within a Django view or channel consumer
                                                if you
                                                like - for example, to fetch lots of URLs in parallel - but it doesn&#8217;t
                                                affect the overall deployed site.</p>
                                        </div>
                                        <div class="section" id="what-version-of-django-does-it-work-with">
                                            <h4>What version of Django does it work with?<a class="headerlink"
                                                                                            href="#what-version-of-django-does-it-work-with"
                                                                                            title="Permalink to this headline">¶</a>
                                            </h4>

                                            <p>You can install Channels as a library for Django &gt;= 1.8. It has a few
                                                extra dependencies, but these will all be installed if you use <code
                                                        class="docutils literal"><span class="pre">pip</span></code>.
                                            </p>
                                        </div>
                                        <div class="section" id="official-project">
                                            <h4>Official project<a class="headerlink" href="#official-project"
                                                                   title="Permalink to this headline">¶</a></h4>

                                            <p>Channels is not in the Django core as initially planned, but it&#8217;s
                                                an official Django project since September 2016. More information about
                                                Channels
                                                being adopted as an official project are available on the
                                                <a class="reference external"
                                                   href="https://www.djangoproject.com/weblog/2016/sep/09/channels-adopted-official-django-project/">Django
                                                    blog</a>.</p>
                                        </div>
                                        <div class="section" id="what-do-i-read-next">
                                            <h4>What do I read next?<a class="headerlink" href="#what-do-i-read-next"
                                                                       title="Permalink to this headline">¶</a></h4>

                                            <p>Start off by reading about the <a class="reference internal"
                                                                                 href="index.html#document-concepts"><em>concepts
                                                underlying Channels</em></a>,
                                                and then move on to read our example-laden <a class="reference internal"
                                                                                              href="index.html#document-getting-started"><em>Getting
                                                    Started guide</em></a>.</p>
                                        </div>
                                    </div>
                                    <span id="document-concepts"></span>

                                    <div class="section" id="channels-concepts">
                                        <h3>Channels Concepts<a class="headerlink" href="#channels-concepts"
                                                                title="Permalink to this headline">¶</a></h3>

                                        <p>Django&#8217;s traditional view of the world revolves around requests and
                                            responses;
                                            a request comes in, Django is fired up to serve it, generates a response to
                                            send, and then Django goes away and waits for the next request.</p>

                                        <p>That was fine when the internet was driven by simple browser interactions,
                                            but the modern Web includes things like WebSockets and HTTP2 server push,
                                            which allow websites to communicate outside of this traditional cycle.</p>

                                        <p>And, beyond that, there are plenty of non-critical tasks that applications
                                            could easily offload until after a response has been sent - like saving
                                            things
                                            into a cache or thumbnailing newly-uploaded images.</p>

                                        <p>It changes the way Django runs to be &#8220;event oriented&#8221; - rather
                                            than
                                            just responding to requests, instead Django responds to a wide array of
                                            events
                                            sent on <em>channels</em>. There&#8217;s still no persistent state - each
                                            event handler,
                                            or <em>consumer</em> as we call them, is called independently in a way much
                                            like a
                                            view is called.</p>

                                        <p>Let&#8217;s look at what <em>channels</em> are first.</p>

                                        <div class="section" id="what-is-a-channel">
                                            <span id="what-are-channels"></span><h4>What is a channel?<a
                                                class="headerlink" href="#what-is-a-channel"
                                                title="Permalink to this headline">¶</a></h4>

                                            <p>The core of the system is, unsurprisingly, a datastructure called a <em>channel</em>.
                                                What is a channel? It is an <em>ordered</em>, <em>first-in first-out
                                                    queue</em> with
                                                <em>message expiry</em> and <em>at-most-once delivery</em> to <em>only
                                                    one listener at a time</em>.</p>

                                            <p>You can think of it as analogous to a task queue - messages are put onto
                                                the channel by <em>producers</em>, and then given to just one of the
                                                <em>consumers</em>
                                                listening to that channel.</p>

                                            <p>By <em>at-most-once</em> we say that either one consumer gets the message
                                                or nobody
                                                does (if the channel implementation crashes, let&#8217;s say). The
                                                alternative is <em>at-least-once</em>, where normally one consumer gets
                                                the message
                                                but when things crash it&#8217;s sent to more than one, which is not the
                                                trade-off
                                                we want.</p>

                                            <p>There are a couple of other limitations - messages must be made of
                                                serializable types, and stay under a certain size limit - but these are
                                                implementation details you won&#8217;t need to worry about until you get
                                                to more
                                                advanced usage.</p>

                                            <p>The channels have capacity, so a lot of producers can write lots of
                                                messages
                                                into a channel with no consumers and then a consumer can come along
                                                later and
                                                will start getting served those queued messages.</p>

                                            <p>If you&#8217;ve used <a class="reference external"
                                                                       href="https://gobyexample.com/channels">channels
                                                in Go</a>: Go channels
                                                are reasonably similar to Django ones. The key difference is that
                                                Django channels are network-transparent; the implementations
                                                of channels we provide are all accessible across a network to consumers
                                                and producers running in different processes or on different machines.
                                            </p>

                                            <p>Inside a network, we identify channels uniquely by a name string - you
                                                can
                                                send to any named channel from any machine connected to the same channel
                                                backend. If two different machines both write to the <code
                                                        class="docutils literal"><span
                                                        class="pre">http.request</span></code>
                                                channel, they&#8217;re writing into the same channel.</p>
                                        </div>
                                        <div class="section" id="how-do-we-use-channels">
                                            <h4>How do we use channels?<a class="headerlink"
                                                                          href="#how-do-we-use-channels"
                                                                          title="Permalink to this headline">¶</a></h4>

                                            <p>So how is Django using those channels? Inside Django
                                                you can write a function to consume a channel:</p>

                                            <div class="highlight-python">
                                                <div class="highlight"><pre><span></span><span
                                                        class="k">def</span> <span class="nf">my_consumer</span><span
                                                        class="p">(</span><span class="n">message</span><span class="p">):</span>
    <span class="k">pass</span>
</pre>
                                                </div>
                                            </div>
                                            <p>And then assign a channel to it in the channel routing:</p>

                                            <div class="highlight-python">
                                                <div class="highlight"><pre><span></span><span
                                                        class="n">channel_routing</span> <span class="o">=</span> <span
                                                        class="p">{</span>
    <span class="s2">&quot;some-channel&quot;</span><span class="p">:</span> <span class="s2">&quot;myapp.consumers.my_consumer&quot;</span><span
                                                            class="p">,</span>
<span class="p">}</span>
</pre>
                                                </div>
                                            </div>
                                            <p>This means that for every message on the channel, Django will call that
                                                consumer function with a message object (message objects have a &#8220;content&#8221;
                                                attribute which is always a dict of data, and a &#8220;channel&#8221;
                                                attribute which
                                                is the channel it came from, as well as some others).</p>

                                            <p>Instead of having Django run in the traditional request-response mode,
                                                Channels changes Django so that it runs in a worker mode - it listens on
                                                all channels that have consumers assigned, and when a message arrives on
                                                one, it runs the relevant consumer. So rather than running in just a
                                                single process tied to a WSGI server, Django runs in three separate
                                                layers:</p>
                                            <ul class="simple">
                                                <li>Interface servers, which communicate between Django and the outside
                                                    world.
                                                    This includes a WSGI adapter as well as a separate WebSocket server
                                                    - we&#8217;ll
                                                    cover this later.
                                                </li>
                                                <li>The channel backend, which is a combination of pluggable Python code
                                                    and
                                                    a datastore (e.g. Redis, or a shared memory segment) responsible for
                                                    transporting messages.
                                                </li>
                                                <li>The workers, that listen on all relevant channels and run consumer
                                                    code
                                                    when a message is ready.
                                                </li>
                                            </ul>
                                            <p>This may seem relatively simplistic, but that&#8217;s part of the design;
                                                rather than
                                                try and have a full asynchronous architecture, we&#8217;re just
                                                introducing a
                                                slightly more complex abstraction than that presented by Django
                                                views.</p>

                                            <p>A view takes a request and returns a response; a consumer takes a channel
                                                message and can write out zero to many other channel messages.</p>

                                            <p>Now, let&#8217;s make a channel for requests (called <code
                                                    class="docutils literal"><span
                                                    class="pre">http.request</span></code>),
                                                and a channel per client for responses (e.g. <code
                                                        class="docutils literal"><span class="pre">http.response.o4F2h2Fd</span></code>),
                                                where the response channel is a property (<code
                                                        class="docutils literal"><span class="pre">reply_channel</span></code>)
                                                of the request
                                                message. Suddenly, a view is merely another example of a consumer:</p>

                                            <div class="highlight-python">
                                                <div class="highlight"><pre><span></span><span class="c1"># Listens on http.request</span>
<span class="k">def</span> <span class="nf">my_consumer</span><span class="p">(</span><span
                                                            class="n">message</span><span class="p">):</span>
    <span class="c1"># Decode the request from message format to a Request object</span>
    <span class="n">django_request</span> <span class="o">=</span> <span class="n">AsgiRequest</span><span
                                                            class="p">(</span><span class="n">message</span><span
                                                            class="p">)</span>
    <span class="c1"># Run view</span>
    <span class="n">django_response</span> <span class="o">=</span> <span class="n">view</span><span
                                                            class="p">(</span><span class="n">django_request</span><span
                                                            class="p">)</span>
    <span class="c1"># Encode the response into message format</span>
    <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span
                                                            class="n">AsgiHandler</span><span class="o">.</span><span
                                                            class="n">encode_response</span><span
                                                            class="p">(</span><span
                                                            class="n">django_response</span><span class="p">):</span>
        <span class="n">message</span><span class="o">.</span><span class="n">reply_channel</span><span
                                                            class="o">.</span><span class="n">send</span><span
                                                            class="p">(</span><span class="n">chunk</span><span
                                                            class="p">)</span>
</pre>
                                                </div>
                                            </div>
                                            <p>In fact, this is how Channels works. The interface servers transform
                                                connections
                                                from the outside world (HTTP, WebSockets, etc.) into messages on
                                                channels,
                                                and then you write workers to handle these messages. Usually you leave
                                                normal
                                                HTTP up to Django&#8217;s built-in consumers that plug it into the
                                                view/template
                                                system, but you can override it to add functionality if you want.</p>

                                            <p>However, the crucial part is that you can run code (and so send on
                                                channels) in
                                                response to any event - and that includes ones you create. You can
                                                trigger
                                                on model saves, on other incoming messages, or from code paths inside
                                                views
                                                and forms. That approach comes in handy for push-style
                                                code - where you use WebSockets or HTTP long-polling to notify
                                                clients of changes in real time (messages in a chat, perhaps, or live
                                                updates
                                                in an admin as another user edits something).</p>
                                        </div>
                                        <div class="section" id="channel-types">
                                            <span id="id1"></span><h4>Channel Types<a class="headerlink"
                                                                                      href="#channel-types"
                                                                                      title="Permalink to this headline">¶</a>
                                        </h4>

                                            <p>There are actually two major uses for channels in
                                                this model. The first, and more obvious one, is the dispatching of work
                                                to
                                                consumers - a message gets added to a channel, and then any one of the
                                                workers
                                                can pick it up and run the consumer.</p>

                                            <p>The second kind of channel, however, is used for replies. Notably, these
                                                only
                                                have one thing listening on them - the interface server. Each reply
                                                channel
                                                is individually named and has to be routed back to the interface server
                                                where
                                                its client is terminated.</p>

                                            <p>This is not a massive difference - they both still behave according to
                                                the core
                                                definition of a <em>channel</em> - but presents some problems when we&#8217;re
                                                looking to
                                                scale things up. We can happily randomly load-balance normal channels
                                                across
                                                clusters of channel servers and workers - after all, any worker can
                                                process
                                                the message - but response channels would have to have their messages
                                                sent
                                                to the channel server they&#8217;re listening on.</p>

                                            <p>For this reason, Channels treats these as two different <em>channel
                                                types</em>, and
                                                denotes a <em>reply channel</em> by having the channel name contain
                                                the character <code class="docutils literal"><span class="pre">!</span></code>
                                                - e.g. <code class="docutils literal"><span class="pre">http.response!f5G3fE21f</span></code>.
                                                <em>Normal
                                                    channels</em> do not contain it, but along with the rest of the
                                                reply
                                                channel name, they must contain only the characters <code
                                                        class="docutils literal"><span class="pre">a-z</span> <span
                                                        class="pre">A-Z</span> <span class="pre">0-9</span> <span
                                                        class="pre">-</span> <span class="pre">_</span></code>,
                                                and be less than 200 characters long.</p>

                                            <p>It&#8217;s optional for a backend implementation to understand this -
                                                after all,
                                                it&#8217;s only important at scale, where you want to shard the two
                                                types differently
                                                — but it&#8217;s present nonetheless. For more on scaling, and how to
                                                handle channel
                                                types if you&#8217;re writing a backend or interface server, see <a
                                                        class="reference internal" href="index.html#scaling-up"><span>Scaling Up</span></a>.
                                            </p>
                                        </div>
                                        <div class="section" id="groups">
                                            <h4>Groups<a class="headerlink" href="#groups"
                                                         title="Permalink to this headline">¶</a></h4>

                                            <p>Because channels only deliver to a single listener, they can&#8217;t do
                                                broadcast;
                                                if you want to send a message to an arbitrary group of clients, you need
                                                to
                                                keep track of which reply channels of those you wish to send to.</p>

                                            <p>If I had a liveblog where I wanted to push out updates whenever a new
                                                post is
                                                saved, I could register a handler for the <code
                                                        class="docutils literal"><span
                                                        class="pre">post_save</span></code> signal and keep a
                                                set of channels (here, using Redis) to send updates to:</p>

                                            <div class="highlight-python">
                                                <div class="highlight"><pre><span></span><span
                                                        class="n">redis_conn</span> <span class="o">=</span> <span
                                                        class="n">redis</span><span class="o">.</span><span class="n">Redis</span><span
                                                        class="p">(</span><span
                                                        class="s2">&quot;localhost&quot;</span><span class="p">,</span> <span
                                                        class="mi">6379</span><span class="p">)</span>

<span class="nd">@receiver</span><span class="p">(</span><span class="n">post_save</span><span class="p">,</span> <span
                                                            class="n">sender</span><span class="o">=</span><span
                                                            class="n">BlogUpdate</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">send_update</span><span class="p">(</span><span class="n">sender</span><span
                                                            class="p">,</span> <span class="n">instance</span><span
                                                            class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span
                                                            class="p">):</span>
    <span class="c1"># Loop through all reply channels and send the update</span>
    <span class="k">for</span> <span class="n">reply_channel</span> <span class="ow">in</span> <span class="n">redis_conn</span><span
                                                            class="o">.</span><span class="n">smembers</span><span
                                                            class="p">(</span><span
                                                            class="s2">&quot;readers&quot;</span><span
                                                            class="p">):</span>
        <span class="n">Channel</span><span class="p">(</span><span class="n">reply_channel</span><span
                                                            class="p">)</span><span class="o">.</span><span class="n">send</span><span
                                                            class="p">({</span>
            <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span
                                                            class="n">dumps</span><span class="p">({</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">instance</span><span
                                                            class="o">.</span><span class="n">id</span><span
                                                            class="p">,</span>
                <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">instance</span><span
                                                            class="o">.</span><span class="n">content</span>
            <span class="p">})</span>
        <span class="p">})</span>

<span class="c1"># Connected to websocket.connect</span>
<span class="k">def</span> <span class="nf">ws_connect</span><span class="p">(</span><span class="n">message</span><span
                                                            class="p">):</span>
    <span class="c1"># Add to reader set</span>
    <span class="n">redis_conn</span><span class="o">.</span><span class="n">sadd</span><span class="p">(</span><span
                                                            class="s2">&quot;readers&quot;</span><span
                                                            class="p">,</span> <span class="n">message</span><span
                                                            class="o">.</span><span class="n">reply_channel</span><span
                                                            class="o">.</span><span class="n">name</span><span
                                                            class="p">)</span>
</pre>
                                                </div>
                                            </div>
                                            <p>While this will work, there&#8217;s a small problem - we never remove
                                                people from
                                                the <code class="docutils literal"><span
                                                        class="pre">readers</span></code> set when they disconnect. We
                                                could add a consumer that
                                                listens to <code class="docutils literal"><span class="pre">websocket.disconnect</span></code>
                                                to do that, but we&#8217;d also need to
                                                have some kind of expiry in case an interface server is forced to quit
                                                or
                                                loses power before it can send disconnect signals - your code will never
                                                see any disconnect notification but the reply channel is completely
                                                invalid and messages you send there will sit there until they expire.
                                            </p>

                                            <p>Because the basic design of channels is stateless, the channel server has
                                                no
                                                concept of &#8220;closing&#8221; a channel if an interface server goes
                                                away - after all,
                                                channels are meant to hold messages until a consumer comes along (and
                                                some
                                                types of interface server, e.g. an SMS gateway, could theoretically
                                                serve
                                                any client from any interface server).</p>

                                            <p>We don&#8217;t particularly care if a disconnected client doesn&#8217;t
                                                get the messages
                                                sent to the group - after all, it disconnected - but we do care about
                                                cluttering up the channel backend tracking all of these clients that are
                                                no
                                                longer around (and possibly, eventually getting a collision on the reply
                                                channel name and sending someone messages not meant for them, though
                                                that would
                                                likely take weeks).</p>

                                            <p>Now, we could go back into our example above and add an expiring set and
                                                keep
                                                track of expiry times and so forth, but what would be the point of a
                                                framework
                                                if it made you add boilerplate code? Instead, Channels implements this
                                                abstraction as a core concept called Groups:</p>

                                            <div class="highlight-python">
                                                <div class="highlight"><pre><span></span><span
                                                        class="nd">@receiver</span><span class="p">(</span><span
                                                        class="n">post_save</span><span class="p">,</span> <span
                                                        class="n">sender</span><span class="o">=</span><span class="n">BlogUpdate</span><span
                                                        class="p">)</span>
<span class="k">def</span> <span class="nf">send_update</span><span class="p">(</span><span class="n">sender</span><span
                                                            class="p">,</span> <span class="n">instance</span><span
                                                            class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span
                                                            class="p">):</span>
    <span class="n">Group</span><span class="p">(</span><span class="s2">&quot;liveblog&quot;</span><span
                                                            class="p">)</span><span class="o">.</span><span class="n">send</span><span
                                                            class="p">({</span>
        <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">json</span><span
                                                            class="o">.</span><span class="n">dumps</span><span
                                                            class="p">({</span>
            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">instance</span><span
                                                            class="o">.</span><span class="n">id</span><span
                                                            class="p">,</span>
            <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">instance</span><span
                                                            class="o">.</span><span class="n">content</span>
        <span class="p">})</span>
    <span class="p">})</span>

<span class="c1"># Connected to websocket.connect</span>
<span class="k">def</span> <span class="nf">ws_connect</span><span class="p">(</span><span class="n">message</span><span
                                                            class="p">):</span>
    <span class="c1"># Add to reader group</span>
    <span class="n">Group</span><span class="p">(</span><span class="s2">&quot;liveblog&quot;</span><span
                                                            class="p">)</span><span class="o">.</span><span class="n">add</span><span
                                                            class="p">(</span><span class="n">message</span><span
                                                            class="o">.</span><span class="n">reply_channel</span><span
                                                            class="p">)</span>

<span class="c1"># Connected to websocket.disconnect</span>
<span class="k">def</span> <span class="nf">ws_disconnect</span><span class="p">(</span><span
                                                            class="n">message</span><span class="p">):</span>
    <span class="c1"># Remove from reader group on clean disconnect</span>
    <span class="n">Group</span><span class="p">(</span><span class="s2">&quot;liveblog&quot;</span><span
                                                            class="p">)</span><span class="o">.</span><span class="n">discard</span><span
                                                            class="p">(</span><span class="n">message</span><span
                                                            class="o">.</span><span class="n">reply_channel</span><span
                                                            class="p">)</span>
</pre>
                                                </div>
                                            </div>
                                            <p>Not only do groups have their own <code class="docutils literal"><span
                                                    class="pre">send()</span></code> method (which backends can provide
                                                an efficient implementation of), they also automatically manage expiry
                                                of
                                                the group members - when the channel starts having messages expire on it
                                                due
                                                to non-consumption, we go in and remove it from all the groups it&#8217;s
                                                in as well.
                                                Of course, you should still remove things from the group on disconnect
                                                if you
                                                can; the expiry code is there to catch cases where the disconnect
                                                message
                                                doesn&#8217;t make it for some reason.</p>

                                            <p>Groups are generally only useful for reply channels (ones containing
                                                the character <code class="docutils literal"><span class="pre">!</span></code>),
                                                as these are unique-per-client, but can be used for
                                                normal channels as well if you wish.</p>
                                        </div>
                                        <div class="section" id="next-steps">
                                            <h4>Next Steps<a class="headerlink" href="#next-steps"
                                                             title="Permalink to this headline">¶</a></h4>

                                            <p>That&#8217;s the high-level overview of channels and groups, and how you
                                                should
                                                start thinking about them. Remember, Django provides some channels
                                                but you&#8217;re free to make and consume your own, and all channels are
                                                network-transparent.</p>

                                            <p>One thing channels do not do, however, is guarantee delivery. If you need
                                                certainty that tasks will complete, use a system designed for this with
                                                retries and persistence (e.g. Celery), or alternatively make a
                                                management
                                                command that checks for completion and re-submits a message to the
                                                channel
                                                if nothing is completed (rolling your own retry logic, essentially).</p>

                                            <p>We&#8217;ll cover more about what kind of tasks fit well into Channels in
                                                the rest
                                                of the documentation, but for now, let&#8217;s progress to <a
                                                        class="reference internal"
                                                        href="index.html#document-getting-started"><em>Getting Started
                                                    with Channels</em></a>
                                                and writing some code.</p>
                                        </div>
                                    </div>
                                    <span id="document-installation"></span>

                                    <div class="section" id="installation">
                                        <h3>Installation<a class="headerlink" href="#installation"
                                                           title="Permalink to this headline">¶</a></h3>

                                        <p>Channels is available on PyPI - to install it, just run:</p>

                                        <div class="highlight-python">
                                            <div class="highlight"><pre><span></span>pip install -U channels
</pre>
                                            </div>
                                        </div>
                                        <p>Once that&#8217;s done, you should add <code class="docutils literal"><span
                                                class="pre">channels</span></code> to your
                                            <code class="docutils literal"><span
                                                    class="pre">INSTALLED_APPS</span></code> setting:</p>

                                        <div class="highlight-python">
                                            <div class="highlight"><pre><span></span>INSTALLED_APPS = (
    &#39;django.contrib.auth&#39;,
    &#39;django.contrib.contenttypes&#39;,
    &#39;django.contrib.sessions&#39;,
    &#39;django.contrib.sites&#39;,
    ...
    &#39;channels&#39;,
)
</pre>
                                            </div>
                                        </div>
                                        <p>That&#8217;s it! Once enabled, <code class="docutils literal"><span
                                                class="pre">channels</span></code> will integrate itself into Django and
                                            take control of the <code class="docutils literal"><span class="pre">runserver</span></code>
                                            command. See <a class="reference internal"
                                                            href="index.html#document-getting-started"><em>Getting
                                                Started with Channels</em></a> for more.</p>

                                        <div class="section" id="installing-the-latest-development-version">
                                            <h4>Installing the latest development version<a class="headerlink"
                                                                                            href="#installing-the-latest-development-version"
                                                                                            title="Permalink to this headline">¶</a>
                                            </h4>

                                            <p>To install the latest version of Channels, clone the repo, change to the
                                                repo,
                                                change to the repo directory, and pip install it into your current
                                                virtual
                                                environment:</p>

                                            <div class="highlight-python">
                                                <div class="highlight"><pre><span></span>$ git clone git@github.com:django/channels.git
$ cd channels
$ &lt;activate your project’s virtual environment&gt;
(environment) $ pip install -e .  # the dot specifies the current repo
</pre>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <span id="document-getting-started"></span>

                                    <div class="section" id="getting-started-with-channels">
                                        <h3>Getting Started with Channels<a class="headerlink"
                                                                            href="#getting-started-with-channels"
                                                                            title="Permalink to this headline">¶</a>
                                        </h3>

                                        <p>(If you haven&#8217;t yet, make sure you <a class="reference internal"
                                                                                       href="index.html#document-installation"><em>install
                                            Channels</em></a>)</p>

                                        <p>Now, let&#8217;s get to writing some consumers. If you&#8217;ve not read it
                                            already,
                                            you should read <a class="reference internal"
                                                               href="index.html#document-concepts"><em>Channels
                                                Concepts</em></a>, as it covers the basic description of what
                                            channels and groups are, and lays out some of the important implementation
                                            patterns and caveats.</p>

                                        <div class="section" id="first-consumers">
                                            <h4>First Consumers<a class="headerlink" href="#first-consumers"
                                                                  title="Permalink to this headline">¶</a></h4>

                                            <p>When you first run Django with Channels installed, it will be set up in
                                                the default layout -
                                                where all HTTP requests (on the <code class="docutils literal"><span
                                                        class="pre">http.request</span></code> channel) are routed to
                                                the
                                                Django view layer - nothing will be different to how things worked in
                                                the past
                                                with a WSGI-based Django, and your views and static file serving (from
                                                <code class="docutils literal"><span class="pre">runserver</span></code>
                                                will work as normal)</p>

                                            <p>As a very basic introduction, let&#8217;s write a consumer that overrides
                                                the built-in
                                                handling and handles every HTTP request directly. This isn&#8217;t
                                                something you&#8217;d
                                                usually do in a project, but it&#8217;s a good illustration of how
                                                channels
                                                underlie even core Django - it&#8217;s less of an addition and more
                                                adding a whole
                                                new layer under the existing view layer.</p>

                                            <p>Make a new project, a new app, and put this in a <code
                                                    class="docutils literal"><span
                                                    class="pre">consumers.py</span></code> file in the app:</p>

                                            <div class="highlight-python">
                                                <div class="highlight"><pre><span></span><span
                                                        class="kn">from</span> <span class="nn">django.http</span> <span
                                                        class="kn">import</span> <span class="n">HttpResponse</span>
<span class="kn">from</span> <span class="nn">channels.handler</span> <span class="kn">import</span> <span class="n">AsgiHandler</span>

<span class="k">def</span> <span class="nf">http_consumer</span><span class="p">(</span><span
                                                            class="n">message</span><span class="p">):</span>
    <span class="c1"># Make standard HTTP response - access ASGI path attribute directly</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">HttpResponse</span><span class="p">(</span><span
                                                            class="s2">&quot;Hello world! You asked for </span><span
                                                            class="si">%s</span><span class="s2">&quot;</span> <span
                                                            class="o">%</span> <span class="n">message</span><span
                                                            class="o">.</span><span class="n">content</span><span
                                                            class="p">[</span><span
                                                            class="s1">&#39;path&#39;</span><span class="p">])</span>
    <span class="c1"># Encode that response into message format (ASGI)</span>
    <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span
                                                            class="n">AsgiHandler</span><span class="o">.</span><span
                                                            class="n">encode_response</span><span
                                                            class="p">(</span><span class="n">response</span><span
                                                            class="p">):</span>
        <span class="n">message</span><span class="o">.</span><span class="n">reply_channel</span><span
                                                            class="o">.</span><span class="n">send</span><span
                                                            class="p">(</span><span class="n">chunk</span><span
                                                            class="p">)</span>
</pre>
                                                </div>
                                            </div>
                                            <p>The most important thing to note here is that, because things we send in
                                                messages must be JSON serializable, the request and response messages
                                                are in a key-value format. You can read more about that format in the
                                                <a class="reference internal" href="index.html#document-asgi"><em>ASGI
                                                    specification</em></a>, but you don&#8217;t need to worry about it
                                                too much;
                                                just know that there&#8217;s an <code class="docutils literal"><span
                                                        class="pre">AsgiRequest</span></code> class that translates from
                                                ASGI into
                                                Django request objects, and the <code class="docutils literal"><span
                                                        class="pre">AsgiHandler</span></code> class handles translation
                                                of
                                                <code class="docutils literal"><span
                                                        class="pre">HttpResponse</span></code> into ASGI messages, which
                                                you see used above. Usually,
                                                Django&#8217;s built-in code will do all this for you when you&#8217;re
                                                using normal views.</p>

                                            <p>Now we need to do one more thing, and that&#8217;s tell Django that this
                                                consumer
                                                should be tied to the <code class="docutils literal"><span class="pre">http.request</span></code>
                                                channel rather than the default Django
                                                view system. This is done in the settings file - in particular, we need
                                                to
                                                define our <code class="docutils literal"><span
                                                        class="pre">default</span></code> channel layer and what its
                                                routing is set to.</p>

                                            <p>Channel routing is a bit like URL routing, and so it&#8217;s structured
                                                similarly -
                                                you point the setting at a dict mapping channels to consumer callables.
                                                Here&#8217;s what that looks like:</p>

                                            <div class="highlight-python">
                                                <div class="highlight"><pre><span></span><span class="c1"># In settings.py</span>
<span class="n">CHANNEL_LAYERS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;BACKEND&quot;</span><span class="p">:</span> <span class="s2">&quot;asgiref.inmemory.ChannelLayer&quot;</span><span
                                                            class="p">,</span>
        <span class="s2">&quot;ROUTING&quot;</span><span class="p">:</span> <span class="s2">&quot;myproject.routing.channel_routing&quot;</span><span
                                                            class="p">,</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre>
                                                </div>
                                            </div>
                                            <div class="highlight-python">
                                                <div class="highlight"><pre><span></span><span class="c1"># In routing.py</span>
<span class="kn">from</span> <span class="nn">channels.routing</span> <span class="kn">import</span> <span class="n">route</span>
<span class="n">channel_routing</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">route</span><span class="p">(</span><span class="s2">&quot;http.request&quot;</span><span class="p">,</span> <span
                                                            class="s2">&quot;myapp.consumers.http_consumer&quot;</span><span
                                                            class="p">),</span>
<span class="p">]</span>
</pre>
                                                </div>
                                            </div>
                                            <div class="admonition warning">
                                                <p class="first admonition-title">Warning</p>

                                                <p class="last">This example, and most of the examples here, use the
                                                    &#8220;in memory&#8221; channel
                                                    layer. This is the easiest to get started with but provides
                                                    absolutely no
                                                    cross-process channel transportation, and so can only be used with
                                                    <code class="docutils literal"><span
                                                            class="pre">runserver</span></code>. You&#8217;ll want to
                                                    choose another backend (discussed later)
                                                    to run things in production.</p>
                                            </div>
                                            <p>As you can see, this is a little like Django&#8217;s <code
                                                    class="docutils literal"><span class="pre">DATABASES</span></code>
                                                setting; there are
                                                named channel layers, with a default one called <code
                                                        class="docutils literal"><span class="pre">default</span></code>.
                                                Each layer
                                                needs a channel layer class, some options (if the channel layer needs
                                                them),
                                                and a routing scheme, which points to a list containing the routing
                                                settings.
                                                It&#8217;s recommended you call this <code
                                                        class="docutils literal"><span
                                                        class="pre">routing.py</span></code> and put it alongside <code
                                                        class="docutils literal"><span class="pre">urls.py</span></code>
                                                in your project, but you can put it wherever you like, as long as the
                                                path is
                                                correct.</p>

                                            <p>If you start up <code class="docutils literal"><span
                                                    class="pre">python</span> <span class="pre">manage.py</span> <span
                                                    class="pre">runserver</span></code> and go to
                                                <code class="docutils literal"><span
                                                        class="pre">http://localhost:8000</span></code>, you&#8217;ll
                                                see that, rather than a default Django page,
                                                you get the Hello World response, so things are working. If you don&#8217;t
                                                see
                                                a response, check you <a class="reference internal"
                                                                         href="index.html#document-installation"><em>installed
                                                    Channels correctly</em></a>.</p>

                                            <p>Now, that&#8217;s not very exciting - raw HTTP responses are something
                                                Django has
                                                been able to do for a long time. Let&#8217;s try some WebSockets, and
                                                make a basic
                                                chat server!</p>

                                            <p>We&#8217;ll start with a simple server that just echoes every message it
                                                gets sent
                                                back to the same client - no cross-client communication. It&#8217;s not
                                                terribly
                                                useful, but it&#8217;s a good way to start out writing Channels
                                                consumers.</p>

                                            <p>Delete that previous consumer and its routing - we&#8217;ll want the
                                                normal Django view layer to
                                                serve HTTP requests from now on, which happens if you don&#8217;t
                                                specify a consumer
                                                for <code class="docutils literal"><span class="pre">http.request</span></code>
                                                - and make this WebSocket consumer instead:</p>

                                            <div class="highlight-python">
                                                <div class="highlight"><pre><span></span><span class="c1"># In consumers.py</span>

<span class="k">def</span> <span class="nf">ws_message</span><span class="p">(</span><span class="n">message</span><span
                                                            class="p">):</span>
    <span class="c1"># ASGI WebSocket packet-received and send-packet message types</span>
    <span class="c1"># both have a &quot;text&quot; key for their textual data.</span>
    <span class="n">message</span><span class="o">.</span><span class="n">reply_channel</span><span
                                                            class="o">.</span><span class="n">send</span><span
                                                            class="p">({</span>
        <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">message</span><span
                                                            class="o">.</span><span class="n">content</span><span
                                                            class="p">[</span><span
                                                            class="s1">&#39;text&#39;</span><span class="p">],</span>
    <span class="p">})</span>
</pre>
                                                </div>
                                            </div>
                                            <p>Hook it up to the <code class="docutils literal"><span class="pre">websocket.receive</span></code>
                                                channel like this:</p>

                                            <div class="highlight-python">
                                                <div class="highlight"><pre><span></span><span class="c1"># In routing.py</span>
<span class="kn">from</span> <span class="nn">channels.routing</span> <span class="kn">import</span> <span class="n">route</span>
<span class="kn">from</span> <span class="nn">myapp.consumers</span> <span class="kn">import</span> <span class="n">ws_message</span>

<span class="n">channel_routing</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">route</span><span class="p">(</span><span class="s2">&quot;websocket.receive&quot;</span><span
                                                            class="p">,</span> <span class="n">ws_message</span><span
                                                            class="p">),</span>
<span class="p">]</span>
</pre>
                                                </div>
                                            </div>
                                            <p>Now, let&#8217;s look at what this is doing. It&#8217;s tied to the
                                                <code class="docutils literal"><span
                                                        class="pre">websocket.receive</span></code> channel, which means
                                                that it&#8217;ll get a message
                                                whenever a WebSocket packet is sent to us by a client.</p>

                                            <p>When it gets that message, it takes the <code
                                                    class="docutils literal"><span
                                                    class="pre">reply_channel</span></code> attribute from it, which
                                                is the unique response channel for that client, and sends the same
                                                content
                                                back to the client using its <code class="docutils literal"><span
                                                        class="pre">send()</span></code> method.</p>

                                            <p>Let&#8217;s test it! Run <code class="docutils literal"><span
                                                    class="pre">runserver</span></code>, open a browser, navigate to a
                                                page on the server
                                                (you can&#8217;t use any page&#8217;s console because of origin
                                                restrictions), and put the
                                                following into the JavaScript console to open a WebSocket and send some
                                                data
                                                down it (you might need to change the socket address if you&#8217;re
                                                using a
                                                development VM or similar):</p>

                                            <div class="highlight-python">
                                                <div class="highlight"><pre><span></span>// Note that the path doesn&#39;t matter for routing; any WebSocket
// connection gets bumped over to WebSocket consumers
socket = new WebSocket(&quot;ws://&quot; + window.location.host + &quot;/chat/&quot;);
socket.onmessage = function(e) {
    alert(e.data);
}
socket.onopen = function() {
    socket.send(&quot;hello world&quot;);
}
// Call onopen directly if socket is already open
if (socket.readyState == WebSocket.OPEN) socket.onopen();
</pre>
                                                </div>
                                            </div>
                                            <p>You should see an alert come back immediately saying &#8220;hello world&#8221;
                                                - your
                                                message has round-tripped through the server and come back to trigger
                                                the alert.</p>
                                        </div>
                                        <div class="section" id="groups">
                                            <h4>Groups<a class="headerlink" href="#groups"
                                                         title="Permalink to this headline">¶</a></h4>

                                            <p>Now, let&#8217;s make our echo server into an actual chat server, so
                                                people can talk
                                                to each other. To do this, we&#8217;ll use Groups, one of the <a
                                                        class="reference internal"
                                                        href="index.html#document-concepts"><em>core concepts</em></a>
                                                of Channels, and our fundamental way of doing multi-cast messaging.</p>

                                            <p>To do this, we&#8217;ll hook up the <code class="docutils literal"><span
                                                    class="pre">websocket.connect</span></code> and <code
                                                    class="docutils literal"><span
                                                    class="pre">websocket.disconnect</span></code>
                                                channels to add and remove our clients from the Group as they connect
                                                and
                                                disconnect, like this:</p>

                                            <div class="highlight-python">
                                                <div class="highlight"><pre><span></span><span class="c1"># In consumers.py</span>
<span class="kn">from</span> <span class="nn">channels</span> <span class="kn">import</span> <span
                                                            class="n">Group</span>

<span class="c1"># Connected to websocket.connect</span>
<span class="k">def</span> <span class="nf">ws_add</span><span class="p">(</span><span class="n">message</span><span
                                                            class="p">):</span>
    <span class="n">message</span><span class="o">.</span><span class="n">reply_channel</span><span
                                                            class="o">.</span><span class="n">send</span><span
                                                            class="p">({</span><span
                                                            class="s2">&quot;accept&quot;</span><span class="p">:</span> <span
                                                            class="bp">True</span><span class="p">})</span>
    <span class="n">Group</span><span class="p">(</span><span class="s2">&quot;chat&quot;</span><span class="p">)</span><span
                                                            class="o">.</span><span class="n">add</span><span class="p">(</span><span
                                                            class="n">message</span><span class="o">.</span><span
                                                            class="n">reply_channel</span><span class="p">)</span>

<span class="c1"># Connected to websocket.disconnect</span>
<span class="k">def</span> <span class="nf">ws_disconnect</span><span class="p">(</span><span
                                                            class="n">message</span><span class="p">):</span>
    <span class="n">Group</span><span class="p">(</span><span class="s2">&quot;chat&quot;</span><span class="p">)</span><span
                                                            class="o">.</span><span class="n">discard</span><span
                                                            class="p">(</span><span class="n">message</span><span
                                                            class="o">.</span><span class="n">reply_channel</span><span
                                                            class="p">)</span>
</pre>
                                                </div>
                                            </div>
                                            <p>Of course, if you&#8217;ve read through <a class="reference internal"
                                                                                          href="index.html#document-concepts"><em>Channels
                                                Concepts</em></a>, you&#8217;ll know that channels
                                                added to groups expire out if their messages expire (every channel layer
                                                has
                                                a message expiry time, usually between 30 seconds and a few minutes, and
                                                it&#8217;s
                                                often configurable) - but the <code class="docutils literal"><span
                                                        class="pre">disconnect</span></code> handler will get called
                                                nearly all
                                                of the time anyway.</p>

                                            <div class="admonition note">
                                                <p class="first admonition-title">Note</p>

                                                <p>Channels&#8217; design is predicated on expecting and working around
                                                    failure;
                                                    it assumes that some small percentage of messages will never get
                                                    delivered,
                                                    and so all the core functionality is designed to <em>expect
                                                        failure</em> so that
                                                    when a message doesn&#8217;t get delivered, it doesn&#8217;t ruin
                                                    the whole system.</p>

                                                <p class="last">We suggest you design your applications the same way -
                                                    rather than relying
                                                    on 100% guaranteed delivery, which Channels won&#8217;t give you,
                                                    look at each
                                                    failure case and program something to expect and handle it - be that
                                                    retry
                                                    logic, partial content handling, or just having something not work
                                                    that one
                                                    time. HTTP requests are just as fallible, and most people&#8217;s
                                                    response to that
                                                    is a generic error page!</p>
                                            </div>
                                            <p id="websocket-example">Now, that&#8217;s taken care of adding and
                                                removing WebSocket send channels for the
                                                <code class="docutils literal"><span class="pre">chat</span></code>
                                                group; all we need to do now is take care of message sending. Instead
                                                of echoing the message back to the client like we did above, we&#8217;ll
                                                instead send
                                                it to the whole <code class="docutils literal"><span
                                                        class="pre">Group</span></code>, which means any client who&#8217;s
                                                been added to it will
                                                get the message. Here&#8217;s all the code:</p>

                                            <div class="highlight-python">
                                                <div class="highlight"><pre><span></span><span class="c1"># In consumers.py</span>
<span class="kn">from</span> <span class="nn">channels</span> <span class="kn">import</span> <span
                                                            class="n">Group</span>

<span class="c1"># Connected to websocket.connect</span>
<span class="k">def</span> <span class="nf">ws_add</span><span class="p">(</span><span class="n">message</span><span
                                                            class="p">):</span>
    <span class="n">message</span><span class="o">.</span><span class="n">reply_channel</span><span
                                                            class="o">.</span><span class="n">send</span><span
                                                            class="p">({</span><span
                                                            class="s2">&quot;accept&quot;</span><span class="p">:</span> <span
                                                            class="bp">True</span><span class="p">})</span>
    <span class="n">Group</span><span class="p">(</span><span class="s2">&quot;chat&quot;</span><span class="p">)</span><span
                                                            class="o">.</span><span class="n">add</span><span class="p">(</span><span
                                                            class="n">message</span><span class="o">.</span><span
                                                            class="n">reply_channel</span><span class="p">)</span>

<span class="c1"># Connected to websocket.receive</span>
<span class="k">def</span> <span class="nf">ws_message</span><span class="p">(</span><span class="n">message</span><span
                                                            class="p">):</span>
    <span class="n">Group</span><span class="p">(</span><span class="s2">&quot;chat&quot;</span><span class="p">)</span><span
                                                            class="o">.</span><span class="n">send</span><span
                                                            class="p">({</span>
        <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;[user] </span><span
                                                            class="si">%s</span><span class="s2">&quot;</span> <span
                                                            class="o">%</span> <span class="n">message</span><span
                                                            class="o">.</span><span class="n">content</span><span
                                                            class="p">[</span><span
                                                            class="s1">&#39;text&#39;</span><span class="p">],</span>
    <span class="p">})</span>

<span class="c1"># Connected to websocket.disconnect</span>
<span class="k">def</span> <span class="nf">ws_disconnect</span><span class="p">(</span><span
                                                            class="n">message</span><span class="p">):</span>
    <span class="n">Group</span><span class="p">(</span><span class="s2">&quot;chat&quot;</span><span class="p">)</span><span
                                                            class="o">.</span><span class="n">discard</span><span
                                                            class="p">(</span><span class="n">message</span><span
                                                            class="o">.</span><span class="n">reply_channel</span><span
                                                            class="p">)</span>
</pre>
                                                </div>
                                            </div>
                                            <p>And what our routing should look like in <code
                                                    class="docutils literal"><span class="pre">routing.py</span></code>:
                                            </p>

                                            <div class="highlight-python">
                                                <div class="highlight"><pre><span></span><span
                                                        class="kn">from</span> <span class="nn">channels.routing</span> <span
                                                        class="kn">import</span> <span class="n">route</span>
<span class="kn">from</span> <span class="nn">myapp.consumers</span> <span class="kn">import</span> <span class="n">ws_add</span><span
                                                            class="p">,</span> <span class="n">ws_message</span><span
                                                            class="p">,</span> <span class="n">ws_disconnect</span>

<span class="n">channel_routing</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">route</span><span class="p">(</span><span class="s2">&quot;websocket.connect&quot;</span><span
                                                            class="p">,</span> <span class="n">ws_add</span><span
                                                            class="p">),</span>
    <span class="n">route</span><span class="p">(</span><span class="s2">&quot;websocket.receive&quot;</span><span
                                                            class="p">,</span> <span class="n">ws_message</span><span
                                                            class="p">),</span>
    <span class="n">route</span><span class="p">(</span><span class="s2">&quot;websocket.disconnect&quot;</span><span
                                                            class="p">,</span> <span class="n">ws_disconnect</span><span
                                                            class="p">),</span>
<span class="p">]</span>
</pre>
                                                </div>
                                            </div>
                                            <p>Note that the <code class="docutils literal"><span class="pre">http.request</span></code>
                                                route is no longer present - if we leave it
                                                out, then Django will route HTTP requests to the normal view system by
                                                default,
                                                which is probably what you want. Even if you have a <code
                                                        class="docutils literal"><span
                                                        class="pre">http.request</span></code> route that
                                                matches just a subset of paths or methods, the ones that don&#8217;t
                                                match will still
                                                fall through to the default handler, which passes it into URL routing
                                                and the
                                                views.</p>

                                            <p>With all that code, you now have a working set of a logic for a chat
                                                server.
                                                Test time! Run <code class="docutils literal"><span class="pre">runserver</span></code>,
                                                open a browser and use that same JavaScript
                                                code in the developer console as before:</p>

                                            <div class="highlight-python">
                                                <div class="highlight"><pre><span></span>// Note that the path doesn&#39;t matter right now; any WebSocket
// connection gets bumped over to WebSocket consumers
socket = new WebSocket(&quot;ws://&quot; + window.location.host + &quot;/chat/&quot;);
socket.onmessage = function(e) {
    alert(e.data);
}
socket.onopen = function() {
    socket.send(&quot;hello world&quot;);
}
// Call onopen directly if socket is already open
if (socket.readyState == WebSocket.OPEN) socket.onopen();
</pre>
                                                </div>
                                            </div>
                                            <p>You should see an alert come back immediately saying &#8220;hello world&#8221;
                                                - but this
                                                time, you can open another tab and do the same there, and both tabs will
                                                receive the message and show an alert. Any incoming message is sent to
                                                the
                                                <code class="docutils literal"><span class="pre">chat</span></code>
                                                group by the <code class="docutils literal"><span
                                                        class="pre">ws_message</span></code> consumer, and both your
                                                tabs will have
                                                been put into the <code class="docutils literal"><span
                                                        class="pre">chat</span></code> group when they connected.</p>

                                            <p>Feel free to put some calls to <code class="docutils literal"><span
                                                    class="pre">print</span></code> in your handler functions too, if
                                                you
                                                like, so you can understand when they&#8217;re called. You can also use
                                                <code class="docutils literal"><span class="pre">pdb</span></code> and
                                                other similar methods you&#8217;d use to debug normal Django projects.
                                            </p>
                                        </div>
                                        <div class="section" id="running-with-channels">
                                            <h4>Running with Channels<a class="headerlink" href="#running-with-channels"
                                                                        title="Permalink to this headline">¶</a></h4>

                                            <p>Because Channels takes Django into a multi-process model, you no longer
                                                run
                                                everything in one process along with a WSGI server (of course, you&#8217;re
                                                still
                                                free to do that if you don&#8217;t want to use Channels). Instead, you
                                                run one or
                                                more <em>interface servers</em>, and one or more <em>worker servers</em>,
                                                connected by
                                                that <em>channel layer</em> you configured earlier.</p>

                                            <p>There are multiple kinds of &#8220;interface servers&#8221;, and each one
                                                will service a
                                                different type of request - one might do both WebSocket and HTTP
                                                requests, while
                                                another might act as an SMS message gateway, for example.</p>

                                            <p>These are separate from the &#8220;worker servers&#8221; where Django
                                                will run actual logic,
                                                though, and so the <em>channel layer</em> transports the content of
                                                channels across
                                                the network. In a production scenario, you&#8217;d usually run <em>worker
                                                    servers</em>
                                                as a separate cluster from the <em>interface servers</em>, though of
                                                course you
                                                can run both as separate processes on one machine too.</p>

                                            <p>By default, Django doesn&#8217;t have a channel layer configured - it
                                                doesn&#8217;t need one to run
                                                normal WSGI requests, after all. As soon as you try to add some
                                                consumers,
                                                though, you&#8217;ll need to configure one.</p>

                                            <p>In the example above we used the in-memory channel layer implementation
                                                as our default channel layer. This just stores all the channel data in a
                                                dict
                                                in memory, and so isn&#8217;t actually cross-process; it only works
                                                inside
                                                <code class="docutils literal"><span class="pre">runserver</span></code>,
                                                as that runs the interface and worker servers in different threads
                                                inside the same process. When you deploy to production, you&#8217;ll
                                                need to
                                                use a channel layer like the Redis backend <code
                                                        class="docutils literal"><span
                                                        class="pre">asgi_redis</span></code> that works cross-process;
                                                see <a class="reference internal"
                                                       href="index.html#document-backends"><em>Channel Layer Types</em></a>
                                                for more.</p>

                                            <p>The second thing, once we have a networked channel backend set up, is to
                                                make
                                                sure we&#8217;re running an interface server that&#8217;s capable of
                                                serving WebSockets.
                                                To solve this, Channels comes with <code class="docutils literal"><span
                                                        class="pre">daphne</span></code>, an interface server
                                                that can handle both HTTP and WebSockets at the same time, and then ties
                                                this
                                                in to run when you run <code class="docutils literal"><span class="pre">runserver</span></code>
                                                - you shouldn&#8217;t notice any difference
                                                from the normal Django <code class="docutils literal"><span class="pre">runserver</span></code>,
                                                though some of the options may be a little
                                                different.</p>

                                            <p><em>(Under the hood, runserver is now running Daphne in one thread and a
                                                worker
                                                with autoreload in another - it&#8217;s basically a miniature version of
                                                a deployment,
                                                but all in one process)</em></p>

                                            <p>Let&#8217;s try out the Redis backend - Redis runs on pretty much every
                                                machine, and
                                                has a very small overhead, which makes it perfect for this kind of
                                                thing. Install
                                                the <code class="docutils literal"><span
                                                        class="pre">asgi_redis</span></code> package using <code
                                                        class="docutils literal"><span class="pre">pip</span></code>.
                                            </p>

                                            <div class="highlight-python">
                                                <div class="highlight"><pre><span></span>pip install asgi_redis
</pre>
                                                </div>
                                            </div>
                                            <p>and set up your channel layer like this:</p>

                                            <div class="highlight-python">
                                                <div class="highlight"><pre><span></span><span class="c1"># In settings.py</span>
<span class="n">CHANNEL_LAYERS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;BACKEND&quot;</span><span class="p">:</span> <span class="s2">&quot;asgi_redis.RedisChannelLayer&quot;</span><span
                                                            class="p">,</span>
        <span class="s2">&quot;CONFIG&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;hosts&quot;</span><span class="p">:</span> <span class="p">[(</span><span class="s2">&quot;localhost&quot;</span><span
                                                            class="p">,</span> <span class="mi">6379</span><span
                                                            class="p">)],</span>
        <span class="p">},</span>
        <span class="s2">&quot;ROUTING&quot;</span><span class="p">:</span> <span class="s2">&quot;myproject.routing.channel_routing&quot;</span><span
                                                            class="p">,</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre>
                                                </div>
                                            </div>
                                            <p>Fire up <code class="docutils literal"><span class="pre">runserver</span></code>,
                                                and it&#8217;ll work as before - unexciting, like good
                                                infrastructure should be. You can also try out the cross-process nature;
                                                run
                                                these two commands in two terminals:</p>
                                            <ul class="simple">
                                                <li><code class="docutils literal"><span class="pre">manage.py</span>
                                                    <span class="pre">runserver</span> <span
                                                            class="pre">--noworker</span></code></li>
                                                <li><code class="docutils literal"><span class="pre">manage.py</span>
                                                    <span class="pre">runworker</span></code></li>
                                            </ul>
                                            <p>As you can probably guess, this disables the worker threads in <code
                                                    class="docutils literal"><span class="pre">runserver</span></code>
                                                and handles them in a separate process. You can pass <code
                                                        class="docutils literal"><span class="pre">-v</span> <span
                                                        class="pre">2</span></code> to <code
                                                        class="docutils literal"><span
                                                        class="pre">runworker</span></code>
                                                if you want to see logging as it runs the consumers.</p>

                                            <p>If Django is in debug mode (<code class="docutils literal"><span
                                                    class="pre">DEBUG=True</span></code>), then <code
                                                    class="docutils literal"><span class="pre">runworker</span></code>
                                                will serve
                                                static files, as <code class="docutils literal"><span class="pre">runserver</span></code>
                                                does. Just like a normal Django setup, you&#8217;ll
                                                have to set up your static file serving for when <code
                                                        class="docutils literal"><span class="pre">DEBUG</span></code>
                                                is turned off.</p>
                                        </div>
                                        <div class="section" id="persisting-data">
                                            <h4>Persisting Data<a class="headerlink" href="#persisting-data"
                                                                  title="Permalink to this headline">¶</a></h4>

                                            <p>Echoing messages is a nice simple example, but it&#8217;s ignoring the
                                                real
                                                need for a system like this - persistent state for connections.
                                                Let&#8217;s consider a basic chat site where a user requests a chat room
                                                upon initial
                                                connection, as part of the query string (e.g. <code
                                                        class="docutils literal"><span class="pre">wss://host/websocket?room=abc</span></code>).
                                            </p>

                                            <p>The <code class="docutils literal"><span class="pre">reply_channel</span></code>
                                                attribute you&#8217;ve seen before is our unique pointer to the
                                                open WebSocket - because it varies between different clients, it&#8217;s
                                                how we can
                                                keep track of &#8220;who&#8221; a message is from. Remember, Channels is
                                                network-transparent
                                                and can run on multiple workers, so you can&#8217;t just store things
                                                locally in
                                                global variables or similar.</p>

                                            <p>Instead, the solution is to persist information keyed by the <code
                                                    class="docutils literal"><span
                                                    class="pre">reply_channel</span></code> in
                                                some other data store - sound familiar? This is what Django&#8217;s
                                                session framework
                                                does for HTTP requests, using a cookie as the key. Wouldn&#8217;t it be
                                                useful if
                                                we could get a session using the <code class="docutils literal"><span
                                                        class="pre">reply_channel</span></code> as a key?</p>

                                            <p>Channels provides a <code class="docutils literal"><span class="pre">channel_session</span></code>
                                                decorator for this purpose - it
                                                provides you with an attribute called <code
                                                        class="docutils literal"><span class="pre">message.channel_session</span></code>
                                                that acts
                                                just like a normal Django session.</p>

                                            <p>Let&#8217;s use it now to build a chat server that expects you to pass a
                                                chatroom
                                                name in the path of your WebSocket request (we&#8217;ll ignore auth for
                                                now - that&#8217;s next):</p>

                                            <div class="highlight-python">
                                                <div class="highlight"><pre><span></span><span class="c1"># In consumers.py</span>
<span class="kn">from</span> <span class="nn">channels</span> <span class="kn">import</span> <span
                                                            class="n">Group</span>
<span class="kn">from</span> <span class="nn">channels.sessions</span> <span class="kn">import</span> <span class="n">channel_session</span>

<span class="c1"># Connected to websocket.connect</span>
<span class="nd">@channel_session</span>
<span class="k">def</span> <span class="nf">ws_connect</span><span class="p">(</span><span class="n">message</span><span
                                                            class="p">):</span>
    <span class="c1"># Accept connection</span>
    <span class="n">message</span><span class="o">.</span><span class="n">reply_channel</span><span
                                                            class="o">.</span><span class="n">send</span><span
                                                            class="p">({</span><span
                                                            class="s2">&quot;accept&quot;</span><span class="p">:</span> <span
                                                            class="bp">True</span><span class="p">})</span>
    <span class="c1"># Work out room name from path (ignore slashes)</span>
    <span class="n">room</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span
                                                            class="n">content</span><span class="p">[</span><span
                                                            class="s1">&#39;path&#39;</span><span
                                                            class="p">]</span><span class="o">.</span><span class="n">strip</span><span
                                                            class="p">(</span><span class="s2">&quot;/&quot;</span><span
                                                            class="p">)</span>
    <span class="c1"># Save room in session and add us to the group</span>
    <span class="n">message</span><span class="o">.</span><span class="n">channel_session</span><span class="p">[</span><span
                                                            class="s1">&#39;room&#39;</span><span
                                                            class="p">]</span> <span class="o">=</span> <span class="n">room</span>
    <span class="n">Group</span><span class="p">(</span><span class="s2">&quot;chat-</span><span
                                                            class="si">%s</span><span class="s2">&quot;</span> <span
                                                            class="o">%</span> <span class="n">room</span><span
                                                            class="p">)</span><span class="o">.</span><span class="n">add</span><span
                                                            class="p">(</span><span class="n">message</span><span
                                                            class="o">.</span><span class="n">reply_channel</span><span
                                                            class="p">)</span>

<span class="c1"># Connected to websocket.receive</span>
<span class="nd">@channel_session</span>
<span class="k">def</span> <span class="nf">ws_message</span><span class="p">(</span><span class="n">message</span><span
                                                            class="p">):</span>
    <span class="n">Group</span><span class="p">(</span><span class="s2">&quot;chat-</span><span
                                                            class="si">%s</span><span class="s2">&quot;</span> <span
                                                            class="o">%</span> <span class="n">message</span><span
                                                            class="o">.</span><span
                                                            class="n">channel_session</span><span
                                                            class="p">[</span><span
                                                            class="s1">&#39;room&#39;</span><span
                                                            class="p">])</span><span class="o">.</span><span class="n">send</span><span
                                                            class="p">({</span>
        <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">message</span><span
                                                            class="p">[</span><span
                                                            class="s1">&#39;text&#39;</span><span class="p">],</span>
    <span class="p">})</span>

<span class="c1"># Connected to websocket.disconnect</span>
<span class="nd">@channel_session</span>
<span class="k">def</span> <span class="nf">ws_disconnect</span><span class="p">(</span><span
                                                            class="n">message</span><span class="p">):</span>
    <span class="n">Group</span><span class="p">(</span><span class="s2">&quot;chat-</span><span
                                                            class="si">%s</span><span class="s2">&quot;</span> <span
                                                            class="o">%</span> <span class="n">message</span><span
                                                            class="o">.</span><span
                                                            class="n">channel_session</span><span
                                                            class="p">[</span><span
                                                            class="s1">&#39;room&#39;</span><span
                                                            class="p">])</span><span class="o">.</span><span class="n">discard</span><span
                                                            class="p">(</span><span class="n">message</span><span
                                                            class="o">.</span><span class="n">reply_channel</span><span
                                                            class="p">)</span>
</pre>
                                                </div>
                                            </div>
                                            <p>Update <code class="docutils literal"><span class="pre">routing.py</span></code>
                                                as well:</p>

                                            <div class="highlight-python">
                                                <div class="highlight"><pre><span></span><span class="c1"># in routing.py</span>
<span class="kn">from</span> <span class="nn">channels.routing</span> <span class="kn">import</span> <span class="n">route</span>
<span class="kn">from</span> <span class="nn">myapp.consumers</span> <span class="kn">import</span> <span class="n">ws_connect</span><span
                                                            class="p">,</span> <span class="n">ws_message</span><span
                                                            class="p">,</span> <span class="n">ws_disconnect</span>

<span class="n">channel_routing</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">route</span><span class="p">(</span><span class="s2">&quot;websocket.connect&quot;</span><span
                                                            class="p">,</span> <span class="n">ws_connect</span><span
                                                            class="p">),</span>
    <span class="n">route</span><span class="p">(</span><span class="s2">&quot;websocket.receive&quot;</span><span
                                                            class="p">,</span> <span class="n">ws_message</span><span
                                                            class="p">),</span>
    <span class="n">route</span><span class="p">(</span><span class="s2">&quot;websocket.disconnect&quot;</span><span
                                                            class="p">,</span> <span class="n">ws_disconnect</span><span
                                                            class="p">),</span>
<span class="p">]</span>
</pre>
                                                </div>
                                            </div>
                                            <p>If you play around with it from the console (or start building a simple
                                                JavaScript chat client that appends received messages to a div), you&#8217;ll
                                                see
                                                that you can set a chat room with the initial request.</p>
                                        </div>
                                        <div class="section" id="authentication">
                                            <h4>Authentication<a class="headerlink" href="#authentication"
                                                                 title="Permalink to this headline">¶</a></h4>

                                            <p>Now, of course, a WebSocket solution is somewhat limited in scope without
                                                the
                                                ability to live with the rest of your website - in particular, we want
                                                to make
                                                sure we know what user we&#8217;re talking to, in case we have things
                                                like private
                                                chat channels (we don&#8217;t want a solution where clients just ask for
                                                the right
                                                channels, as anyone could change the code and just put in private
                                                channel names)</p>

                                            <p>It can also save you having to manually make clients ask for what they
                                                want to
                                                see; if I see you open a WebSocket to my &#8220;updates&#8221; endpoint,
                                                and I know which
                                                user you are, I can just auto-add that channel to all the relevant
                                                groups (mentions
                                                of that user, for example).</p>

                                            <p>Handily, as WebSockets start off using the HTTP protocol, they have a lot
                                                of
                                                familiar features, including a path, GET parameters, and cookies. We&#8217;d
                                                like to
                                                use these to hook into the familiar Django session and authentication
                                                systems;
                                                after all, WebSockets are no good unless we can identify who they belong
                                                to
                                                and do things securely.</p>

                                            <p>In addition, we don&#8217;t want the interface servers storing data or
                                                trying to run
                                                authentication; they&#8217;re meant to be simple, lean, fast processes
                                                without much
                                                state, and so we&#8217;ll need to do our authentication inside our
                                                consumer functions.</p>

                                            <p>Fortunately, because Channels has an underlying spec for WebSockets and
                                                other
                                                messages (<a class="reference internal" href="index.html#document-asgi"><em>ASGI</em></a>),
                                                it ships with decorators that help you with
                                                both authentication and getting the underlying Django session (which is
                                                what
                                                Django authentication relies on).</p>

                                            <p>Channels can use Django sessions either from cookies (if you&#8217;re
                                                running your
                                                websocket server on the same port as your main site, using something
                                                like Daphne),
                                                or from a <code class="docutils literal"><span
                                                        class="pre">session_key</span></code> GET parameter, which works
                                                if you want to keep
                                                running your HTTP requests through a WSGI server and offload WebSockets
                                                to a
                                                second server process on another port.</p>

                                            <p>You get access to a user&#8217;s normal Django session using the <code
                                                    class="docutils literal"><span
                                                    class="pre">http_session</span></code>
                                                decorator - that gives you a <code class="docutils literal"><span
                                                        class="pre">message.http_session</span></code> attribute that
                                                behaves
                                                just like <code class="docutils literal"><span class="pre">request.session</span></code>.
                                                You can go one further and use <code class="docutils literal"><span
                                                        class="pre">http_session_user</span></code>
                                                which will provide a <code class="docutils literal"><span class="pre">message.user</span></code>
                                                attribute as well as the session attribute.</p>

                                            <p>Now, one thing to note is that you only get the detailed HTTP information
                                                during the <code class="docutils literal"><span
                                                        class="pre">connect</span></code> message of a WebSocket
                                                connection (you can read more
                                                about that in the <a class="reference internal"
                                                                     href="index.html#document-asgi"><em>ASGI spec</em></a>)
                                                - this means we&#8217;re not
                                                wasting bandwidth sending the same information over the wire needlessly.
                                            </p>

                                            <p>This also means we&#8217;ll have to grab the user in the connection
                                                handler and then
                                                store it in the session; thankfully, Channels ships with both a <code
                                                        class="docutils literal"><span
                                                        class="pre">channel_session_user</span></code>
                                                decorator that works like the <code class="docutils literal"><span
                                                        class="pre">http_session_user</span></code> decorator we
                                                mentioned above but
                                                loads the user from the <em>channel</em> session rather than the <em>HTTP</em>
                                                session,
                                                and a function called <code class="docutils literal"><span class="pre">transfer_user</span></code>
                                                which replicates a user from one session
                                                to another. Even better, it combines all of these into a <code
                                                        class="docutils literal"><span class="pre">channel_session_user_from_http</span></code>
                                                decorator.</p>

                                            <p>Bringing that all together, let&#8217;s make a chat server where users
                                                can only
                                                chat to people with the same first letter of their username:</p>

                                            <div class="highlight-python">
                                                <div class="highlight"><pre><span></span><span class="c1"># In consumers.py</span>
<span class="kn">from</span> <span class="nn">channels</span> <span class="kn">import</span> <span
                                                            class="n">Channel</span><span class="p">,</span> <span
                                                            class="n">Group</span>
<span class="kn">from</span> <span class="nn">channels.sessions</span> <span class="kn">import</span> <span class="n">channel_session</span>
<span class="kn">from</span> <span class="nn">channels.auth</span> <span class="kn">import</span> <span class="n">channel_session_user</span><span
                                                            class="p">,</span> <span class="n">channel_session_user_from_http</span>

<span class="c1"># Connected to websocket.connect</span>
<span class="nd">@channel_session_user_from_http</span>
<span class="k">def</span> <span class="nf">ws_add</span><span class="p">(</span><span class="n">message</span><span
                                                            class="p">):</span>
    <span class="c1"># Accept connection</span>
    <span class="n">message</span><span class="o">.</span><span class="n">reply_channel</span><span
                                                            class="o">.</span><span class="n">send</span><span
                                                            class="p">({</span><span
                                                            class="s2">&quot;accept&quot;</span><span class="p">:</span> <span
                                                            class="bp">True</span><span class="p">})</span>
    <span class="c1"># Add them to the right group</span>
    <span class="n">Group</span><span class="p">(</span><span class="s2">&quot;chat-</span><span
                                                            class="si">%s</span><span class="s2">&quot;</span> <span
                                                            class="o">%</span> <span class="n">message</span><span
                                                            class="o">.</span><span class="n">user</span><span
                                                            class="o">.</span><span class="n">username</span><span
                                                            class="p">[</span><span class="mi">0</span><span class="p">])</span><span
                                                            class="o">.</span><span class="n">add</span><span class="p">(</span><span
                                                            class="n">message</span><span class="o">.</span><span
                                                            class="n">reply_channel</span><span class="p">)</span>

<span class="c1"># Connected to websocket.receive</span>
<span class="nd">@channel_session_user</span>
<span class="k">def</span> <span class="nf">ws_message</span><span class="p">(</span><span class="n">message</span><span
                                                            class="p">):</span>
    <span class="n">Group</span><span class="p">(</span><span class="s2">&quot;chat-</span><span
                                                            class="si">%s</span><span class="s2">&quot;</span> <span
                                                            class="o">%</span> <span class="n">message</span><span
                                                            class="o">.</span><span class="n">user</span><span
                                                            class="o">.</span><span class="n">username</span><span
                                                            class="p">[</span><span class="mi">0</span><span class="p">])</span><span
                                                            class="o">.</span><span class="n">send</span><span
                                                            class="p">({</span>
        <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">message</span><span
                                                            class="p">[</span><span
                                                            class="s1">&#39;text&#39;</span><span class="p">],</span>
    <span class="p">})</span>

<span class="c1"># Connected to websocket.disconnect</span>
<span class="nd">@channel_session_user</span>
<span class="k">def</span> <span class="nf">ws_disconnect</span><span class="p">(</span><span
                                                            class="n">message</span><span class="p">):</span>
    <span class="n">Group</span><span class="p">(</span><span class="s2">&quot;chat-</span><span
                                                            class="si">%s</span><span class="s2">&quot;</span> <span
                                                            class="o">%</span> <span class="n">message</span><span
                                                            class="o">.</span><span class="n">user</span><span
                                                            class="o">.</span><span class="n">username</span><span
                                                            class="p">[</span><span class="mi">0</span><span class="p">])</span><span
                                                            class="o">.</span><span class="n">discard</span><span
                                                            class="p">(</span><span class="n">message</span><span
                                                            class="o">.</span><span class="n">reply_channel</span><span
                                                            class="p">)</span>
</pre>
                                                </div>
                                            </div>
                                            <p>If you&#8217;re just using <code class="docutils literal"><span
                                                    class="pre">runserver</span></code> (and so Daphne), you can just
                                                connect
                                                and your cookies should transfer your auth over. If you were running
                                                WebSockets
                                                on a separate port, you&#8217;d have to remember to provide the
                                                Django session ID as part of the URL, like this:</p>

                                            <div class="highlight-python">
                                                <div class="highlight"><pre><span></span>socket = new WebSocket(&quot;ws://127.0.0.1:9000/?session_key=abcdefg&quot;);
</pre>
                                                </div>
                                            </div>
                                            <p>You can get the current session key in a template with <code
                                                    class="docutils literal"><span class="pre">{{</span> <span
                                                    class="pre">request.session.session_key</span> <span
                                                    class="pre">}}</span></code>.
                                                Note that this can&#8217;t work with signed cookie sessions - since only
                                                HTTP
                                                responses can set cookies, it needs a backend it can write to to
                                                separately
                                                store state.</p>
                                        </div>
                                        <div class="section" id="routing">
                                            <h4>Routing<a class="headerlink" href="#routing"
                                                          title="Permalink to this headline">¶</a></h4>

                                            <p>The <code class="docutils literal"><span
                                                    class="pre">routing.py</span></code> file acts very much like Django&#8217;s
                                                <code class="docutils literal"><span class="pre">urls.py</span></code>,
                                                including the
                                                ability to route things to different consumers based on <code
                                                        class="docutils literal"><span class="pre">path</span></code>,
                                                or any other
                                                message attribute that&#8217;s a string (for example, <code
                                                        class="docutils literal"><span
                                                        class="pre">http.request</span></code> messages have
                                                a <code class="docutils literal"><span class="pre">method</span></code>
                                                key you could route based on).</p>

                                            <p>Much like urls, you route using regular expressions; the main difference
                                                is that
                                                because the <code class="docutils literal"><span class="pre">path</span></code>
                                                is not special-cased - Channels doesn&#8217;t know that it&#8217;s a URL
                                                -
                                                you have to start patterns with the root <code class="docutils literal"><span
                                                        class="pre">/</span></code>, and end includes without a <code
                                                        class="docutils literal"><span class="pre">/</span></code>
                                                so that when the patterns combine, they work correctly.</p>

                                            <p>Finally, because you&#8217;re matching against message contents using
                                                keyword arguments,
                                                you can only use named groups in your regular expressions! Here&#8217;s
                                                an example of
                                                routing our chat from above:</p>

                                            <div class="highlight-python">
                                                <div class="highlight"><pre><span></span><span
                                                        class="n">http_routing</span> <span class="o">=</span> <span
                                                        class="p">[</span>
    <span class="n">route</span><span class="p">(</span><span class="s2">&quot;http.request&quot;</span><span class="p">,</span> <span
                                                            class="n">poll_consumer</span><span class="p">,</span> <span
                                                            class="n">path</span><span class="o">=</span><span
                                                            class="s2">r&quot;^/poll/$&quot;</span><span
                                                            class="p">,</span> <span class="n">method</span><span
                                                            class="o">=</span><span
                                                            class="s2">r&quot;^POST$&quot;</span><span
                                                            class="p">),</span>
<span class="p">]</span>

<span class="n">chat_routing</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">route</span><span class="p">(</span><span class="s2">&quot;websocket.connect&quot;</span><span
                                                            class="p">,</span> <span class="n">chat_connect</span><span
                                                            class="p">,</span> <span class="n">path</span><span
                                                            class="o">=</span><span class="s2">r&quot;^/(?P&lt;room&gt;[a-zA-Z0-9_]+)/$&quot;</span><span
                                                            class="p">),</span>
    <span class="n">route</span><span class="p">(</span><span class="s2">&quot;websocket.disconnect&quot;</span><span
                                                            class="p">,</span> <span
                                                            class="n">chat_disconnect</span><span class="p">),</span>
<span class="p">]</span>

<span class="n">routing</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># You can use a string import path as the first argument as well.</span>
    <span class="n">include</span><span class="p">(</span><span class="n">chat_routing</span><span
                                                            class="p">,</span> <span class="n">path</span><span
                                                            class="o">=</span><span
                                                            class="s2">r&quot;^/chat&quot;</span><span
                                                            class="p">),</span>
    <span class="n">include</span><span class="p">(</span><span class="n">http_routing</span><span class="p">),</span>
<span class="p">]</span>
</pre>
                                                </div>
                                            </div>
                                            <p>The routing is resolved in order, short-circuiting around the
                                                includes if one or more of their matches fails. You don&#8217;t have to
                                                start with
                                                the <code class="docutils literal"><span class="pre">^</span></code>
                                                symbol - we use Python&#8217;s <code class="docutils literal"><span
                                                        class="pre">re.match</span></code> function, which starts at the
                                                start of a line anyway - but it&#8217;s considered good practice.</p>

                                            <p>When an include matches part of a message value, it chops off the bit of
                                                the
                                                value it matched before passing it down to its routes or sub-includes,
                                                so you
                                                can put the same routing under multiple includes with different prefixes
                                                if
                                                you like.</p>

                                            <p>Because these matches come through as keyword arguments, we could modify
                                                our
                                                consumer above to use a room based on URL rather than username:</p>

                                            <div class="highlight-python">
                                                <div class="highlight"><pre><span></span><span class="c1"># Connected to websocket.connect</span>
<span class="nd">@channel_session_user_from_http</span>
<span class="k">def</span> <span class="nf">ws_add</span><span class="p">(</span><span class="n">message</span><span
                                                            class="p">,</span> <span class="n">room</span><span
                                                            class="p">):</span>
    <span class="c1"># Add them to the right group</span>
    <span class="n">Group</span><span class="p">(</span><span class="s2">&quot;chat-</span><span
                                                            class="si">%s</span><span class="s2">&quot;</span> <span
                                                            class="o">%</span> <span class="n">room</span><span
                                                            class="p">)</span><span class="o">.</span><span class="n">add</span><span
                                                            class="p">(</span><span class="n">message</span><span
                                                            class="o">.</span><span class="n">reply_channel</span><span
                                                            class="p">)</span>
</pre>
                                                </div>
                                            </div>
                                            <p>In the next section, we&#8217;ll change to sending the <code
                                                    class="docutils literal"><span class="pre">room</span></code> as a
                                                part of the
                                                WebSocket message - which you might do if you had a multiplexing client
                                                -
                                                but you could use routing there as well.</p>
                                        </div>
                                        <div class="section" id="models">
                                            <h4>Models<a class="headerlink" href="#models"
                                                         title="Permalink to this headline">¶</a></h4>

                                            <p>So far, we&#8217;ve just been taking incoming messages and rebroadcasting
                                                them to
                                                other clients connected to the same group, but this isn&#8217;t that
                                                great; really,
                                                we want to persist messages to a datastore, and we&#8217;d probably like
                                                to be
                                                able to inject messages into chatrooms from things other than WebSocket
                                                client
                                                connections (perhaps a built-in bot, or server status messages).</p>

                                            <p>Thankfully, we can just use Django&#8217;s ORM to handle persistence of
                                                messages and
                                                easily integrate the send into the save flow of the model, rather than
                                                the
                                                message receive - that way, any new message saved will be broadcast to
                                                all
                                                the appropriate clients, no matter where it&#8217;s saved from.</p>

                                            <p>We&#8217;ll even take some performance considerations into account: We&#8217;ll
                                                make our
                                                own custom channel for new chat messages and move the model save and the
                                                chat
                                                broadcast into that, meaning the sending process/consumer can move on
                                                immediately and not spend time waiting for the database save and the
                                                (slow on some backends) <code class="docutils literal"><span
                                                        class="pre">Group.send()</span></code> call.</p>

                                            <p>Let&#8217;s see what that looks like, assuming we
                                                have a ChatMessage model with <code class="docutils literal"><span
                                                        class="pre">message</span></code> and <code
                                                        class="docutils literal"><span class="pre">room</span></code>
                                                fields:</p>

                                            <div class="highlight-python">
                                                <div class="highlight"><pre><span></span><span class="c1"># In consumers.py</span>
<span class="kn">from</span> <span class="nn">channels</span> <span class="kn">import</span> <span
                                                            class="n">Channel</span>
<span class="kn">from</span> <span class="nn">channels.sessions</span> <span class="kn">import</span> <span class="n">channel_session</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span
                                                            class="n">ChatMessage</span>

<span class="c1"># Connected to chat-messages</span>
<span class="k">def</span> <span class="nf">msg_consumer</span><span class="p">(</span><span
                                                            class="n">message</span><span class="p">):</span>
    <span class="c1"># Save to model</span>
    <span class="n">room</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span
                                                            class="n">content</span><span class="p">[</span><span
                                                            class="s1">&#39;room&#39;</span><span class="p">]</span>
    <span class="n">ChatMessage</span><span class="o">.</span><span class="n">objects</span><span
                                                            class="o">.</span><span class="n">create</span><span
                                                            class="p">(</span>
        <span class="n">room</span><span class="o">=</span><span class="n">room</span><span class="p">,</span>
        <span class="n">message</span><span class="o">=</span><span class="n">message</span><span
                                                            class="o">.</span><span class="n">content</span><span
                                                            class="p">[</span><span
                                                            class="s1">&#39;message&#39;</span><span class="p">],</span>
    <span class="p">)</span>
    <span class="c1"># Broadcast to listening sockets</span>
    <span class="n">Group</span><span class="p">(</span><span class="s2">&quot;chat-</span><span
                                                            class="si">%s</span><span class="s2">&quot;</span> <span
                                                            class="o">%</span> <span class="n">room</span><span
                                                            class="p">)</span><span class="o">.</span><span class="n">send</span><span
                                                            class="p">({</span>
        <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">message</span><span
                                                            class="o">.</span><span class="n">content</span><span
                                                            class="p">[</span><span
                                                            class="s1">&#39;message&#39;</span><span class="p">],</span>
    <span class="p">})</span>

<span class="c1"># Connected to websocket.connect</span>
<span class="nd">@channel_session</span>
<span class="k">def</span> <span class="nf">ws_connect</span><span class="p">(</span><span class="n">message</span><span
                                                            class="p">):</span>
    <span class="c1"># Work out room name from path (ignore slashes)</span>
    <span class="n">room</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span
                                                            class="n">content</span><span class="p">[</span><span
                                                            class="s1">&#39;path&#39;</span><span
                                                            class="p">]</span><span class="o">.</span><span class="n">strip</span><span
                                                            class="p">(</span><span class="s2">&quot;/&quot;</span><span
                                                            class="p">)</span>
    <span class="c1"># Save room in session and add us to the group</span>
    <span class="n">message</span><span class="o">.</span><span class="n">channel_session</span><span class="p">[</span><span
                                                            class="s1">&#39;room&#39;</span><span
                                                            class="p">]</span> <span class="o">=</span> <span class="n">room</span>
    <span class="n">Group</span><span class="p">(</span><span class="s2">&quot;chat-</span><span
                                                            class="si">%s</span><span class="s2">&quot;</span> <span
                                                            class="o">%</span> <span class="n">room</span><span
                                                            class="p">)</span><span class="o">.</span><span class="n">add</span><span
                                                            class="p">(</span><span class="n">message</span><span
                                                            class="o">.</span><span class="n">reply_channel</span><span
                                                            class="p">)</span>

<span class="c1"># Connected to websocket.receive</span>
<span class="nd">@channel_session</span>
<span class="k">def</span> <span class="nf">ws_message</span><span class="p">(</span><span class="n">message</span><span
                                                            class="p">):</span>
    <span class="c1"># Stick the message onto the processing queue</span>
    <span class="n">Channel</span><span class="p">(</span><span class="s2">&quot;chat-messages&quot;</span><span
                                                            class="p">)</span><span class="o">.</span><span class="n">send</span><span
                                                            class="p">({</span>
        <span class="s2">&quot;room&quot;</span><span class="p">:</span> <span class="n">message</span><span
                                                            class="o">.</span><span
                                                            class="n">channel_session</span><span
                                                            class="p">[</span><span
                                                            class="s1">&#39;room&#39;</span><span class="p">],</span>
        <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">message</span><span
                                                            class="p">[</span><span
                                                            class="s1">&#39;text&#39;</span><span class="p">],</span>
    <span class="p">})</span>

<span class="c1"># Connected to websocket.disconnect</span>
<span class="nd">@channel_session</span>
<span class="k">def</span> <span class="nf">ws_disconnect</span><span class="p">(</span><span
                                                            class="n">message</span><span class="p">):</span>
    <span class="n">Group</span><span class="p">(</span><span class="s2">&quot;chat-</span><span
                                                            class="si">%s</span><span class="s2">&quot;</span> <span
                                                            class="o">%</span> <span class="n">message</span><span
                                                            class="o">.</span><span
                                                            class="n">channel_session</span><span
                                                            class="p">[</span><span
                                                            class="s1">&#39;room&#39;</span><span
                                                            class="p">])</span><span class="o">.</span><span class="n">discard</span><span
                                                            class="p">(</span><span class="n">message</span><span
                                                            class="o">.</span><span class="n">reply_channel</span><span
                                                            class="p">)</span>
</pre>
                                                </div>
                                            </div>
                                            <p>Note that we could add messages onto the <code
                                                    class="docutils literal"><span
                                                    class="pre">chat-messages</span></code> channel from anywhere;
                                                inside a View, inside another model&#8217;s <code
                                                        class="docutils literal"><span
                                                        class="pre">post_save</span></code> signal, inside a management
                                                command run via <code class="docutils literal"><span
                                                        class="pre">cron</span></code>. If we wanted to write a bot,
                                                too, we could put its
                                                listening logic inside the <code class="docutils literal"><span
                                                        class="pre">chat-messages</span></code> consumer, as every
                                                message would
                                                pass through it.</p>
                                        </div>
                                        <div class="section" id="enforcing-ordering">
                                            <span id="id1"></span><h4>Enforcing Ordering<a class="headerlink"
                                                                                           href="#enforcing-ordering"
                                                                                           title="Permalink to this headline">¶</a>
                                        </h4>

                                            <p>There&#8217;s one final concept we want to introduce you to before you go
                                                on to build
                                                sites with Channels - consumer ordering.</p>

                                            <p>Because Channels is a distributed system that can have many workers, by
                                                default
                                                it just processes messages in the order the workers get them off the
                                                queue.
                                                It&#8217;s entirely feasible for a WebSocket interface server to send
                                                out two
                                                <code class="docutils literal"><span class="pre">receive</span></code>
                                                messages close enough together that a second worker will pick
                                                up and start processing the second message before the first worker has
                                                finished processing the first.</p>

                                            <p>This is particularly annoying if you&#8217;re storing things in the
                                                session in the
                                                one consumer and trying to get them in the other consumer - because
                                                the <code class="docutils literal"><span
                                                        class="pre">connect</span></code> consumer hasn&#8217;t exited,
                                                its session hasn&#8217;t saved. You&#8217;d get the
                                                same effect if someone tried to request a view before the login view had
                                                finished
                                                processing, of course, but HTTP requests usually come in a bit slower
                                                from clients.</p>

                                            <p>Channels has a solution - the <code class="docutils literal"><span
                                                    class="pre">enforce_ordering</span></code> decorator. All WebSocket
                                                messages contain an <code class="docutils literal"><span class="pre">order</span></code>
                                                key, and this decorator uses that to make sure that
                                                messages are consumed in the right order. In addition, the <code
                                                        class="docutils literal"><span class="pre">connect</span></code>
                                                message
                                                blocks the socket opening until it&#8217;s responded to, so you are
                                                always guaranteed
                                                that <code class="docutils literal"><span
                                                        class="pre">connect</span></code> will run before any <code
                                                        class="docutils literal"><span
                                                        class="pre">receives</span></code> even without the decorator.
                                            </p>

                                            <p>The decorator uses <code class="docutils literal"><span class="pre">channel_session</span></code>
                                                to keep track of what numbered messages
                                                have been processed, and if a worker tries to run a consumer on an
                                                out-of-order
                                                message, it raises the <code class="docutils literal"><span class="pre">ConsumeLater</span></code>
                                                exception, which puts the message
                                                back on the channel it came from and tells the worker to work on another
                                                message.</p>

                                            <p>There&#8217;s a high cost to using <code class="docutils literal"><span
                                                    class="pre">enforce_ordering</span></code>, which is why it&#8217;s
                                                an optional
                                                decorator. Here&#8217;s an example of it being used:</p>

                                            <div class="highlight-python">
                                                <div class="highlight"><pre><span></span><span class="c1"># In consumers.py</span>
<span class="kn">from</span> <span class="nn">channels</span> <span class="kn">import</span> <span
                                                            class="n">Channel</span><span class="p">,</span> <span
                                                            class="n">Group</span>
<span class="kn">from</span> <span class="nn">channels.sessions</span> <span class="kn">import</span> <span class="n">channel_session</span><span
                                                            class="p">,</span> <span class="n">enforce_ordering</span>
<span class="kn">from</span> <span class="nn">channels.auth</span> <span class="kn">import</span> <span class="n">channel_session_user</span><span
                                                            class="p">,</span> <span class="n">channel_session_user_from_http</span>

<span class="c1"># Connected to websocket.connect</span>
<span class="nd">@channel_session_user_from_http</span>
<span class="k">def</span> <span class="nf">ws_add</span><span class="p">(</span><span class="n">message</span><span
                                                            class="p">):</span>
    <span class="c1"># This doesn&#39;t need a decorator - it always runs separately</span>
    <span class="n">message</span><span class="o">.</span><span class="n">channel_session</span><span class="p">[</span><span
                                                            class="s1">&#39;sent&#39;</span><span
                                                            class="p">]</span> <span class="o">=</span> <span
                                                            class="mi">0</span>
    <span class="c1"># Add them to the right group</span>
    <span class="n">Group</span><span class="p">(</span><span class="s2">&quot;chat&quot;</span><span class="p">)</span><span
                                                            class="o">.</span><span class="n">add</span><span class="p">(</span><span
                                                            class="n">message</span><span class="o">.</span><span
                                                            class="n">reply_channel</span><span class="p">)</span>
    <span class="c1"># Accept the socket</span>
    <span class="n">message</span><span class="o">.</span><span class="n">reply_channel</span><span
                                                            class="o">.</span><span class="n">send</span><span
                                                            class="p">({</span><span
                                                            class="s2">&quot;accept&quot;</span><span class="p">:</span> <span
                                                            class="bp">True</span><span class="p">})</span>

<span class="c1"># Connected to websocket.receive</span>
<span class="nd">@enforce_ordering</span>
<span class="nd">@channel_session_user</span>
<span class="k">def</span> <span class="nf">ws_message</span><span class="p">(</span><span class="n">message</span><span
                                                            class="p">):</span>
    <span class="c1"># Without enforce_ordering this wouldn&#39;t work right</span>
    <span class="n">message</span><span class="o">.</span><span class="n">channel_session</span><span class="p">[</span><span
                                                            class="s1">&#39;sent&#39;</span><span
                                                            class="p">]</span> <span class="o">=</span> <span class="n">message</span><span
                                                            class="o">.</span><span
                                                            class="n">channel_session</span><span
                                                            class="p">[</span><span
                                                            class="s1">&#39;sent&#39;</span><span
                                                            class="p">]</span> <span class="o">+</span> <span
                                                            class="mi">1</span>
    <span class="n">Group</span><span class="p">(</span><span class="s2">&quot;chat&quot;</span><span class="p">)</span><span
                                                            class="o">.</span><span class="n">send</span><span
                                                            class="p">({</span>
        <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">%s</span><span
                                                            class="s2">: </span><span class="si">%s</span><span
                                                            class="s2">&quot;</span> <span class="o">%</span> <span
                                                            class="p">(</span><span class="n">message</span><span
                                                            class="o">.</span><span
                                                            class="n">channel_session</span><span
                                                            class="p">[</span><span
                                                            class="s1">&#39;sent&#39;</span><span
                                                            class="p">],</span> <span class="n">message</span><span
                                                            class="p">[</span><span
                                                            class="s1">&#39;text&#39;</span><span class="p">]),</span>
    <span class="p">})</span>

<span class="c1"># Connected to websocket.disconnect</span>
<span class="nd">@channel_session_user</span>
<span class="k">def</span> <span class="nf">ws_disconnect</span><span class="p">(</span><span
                                                            class="n">message</span><span class="p">):</span>
    <span class="n">Group</span><span class="p">(</span><span class="s2">&quot;chat&quot;</span><span class="p">)</span><span
                                                            class="o">.</span><span class="n">discard</span><span
                                                            class="p">(</span><span class="n">message</span><span
                                                            class="o">.</span><span class="n">reply_channel</span><span
                                                            class="p">)</span>
</pre>
                                                </div>
                                            </div>
                                            <p>Generally, the performance (and safety) of your ordering is tied to your
                                                session backend&#8217;s performance. Make sure you choose a session
                                                backend wisely
                                                if you&#8217;re going to rely heavily on <code class="docutils literal"><span
                                                        class="pre">enforce_ordering</span></code>.</p>
                                        </div>
                                        <div class="section" id="next-steps">
                                            <h4>Next Steps<a class="headerlink" href="#next-steps"
                                                             title="Permalink to this headline">¶</a></h4>

                                            <p>That covers the basics of using Channels; you&#8217;ve seen not only how
                                                to use basic
                                                channels, but also seen how they integrate with WebSockets, how to use
                                                groups
                                                to manage logical sets of channels, and how Django&#8217;s session and
                                                authentication
                                                systems easily integrate with WebSockets.</p>

                                            <p>We recommend you read through the rest of the reference documentation to
                                                see
                                                more about what you can do with channels; in particular, you may want to
                                                look at
                                                our <a class="reference internal"
                                                       href="index.html#document-deploying"><em>Deploying</em></a>
                                                documentation to get an idea of how to
                                                design and run apps in production environments.</p>
                                        </div>
                                    </div>
                                    <span id="document-deploying"></span>

                                    <div class="section" id="deploying">
                                        <h3>Deploying<a class="headerlink" href="#deploying"
                                                        title="Permalink to this headline">¶</a></h3>

                                        <p>Deploying applications using channels requires a few more steps than a normal
                                            Django WSGI application, but you have a couple of options as to how to
                                            deploy
                                            it and how much of your traffic you wish to route through the channel
                                            layers.</p>

                                        <p>Firstly, remember that it&#8217;s an entirely optional part of Django.
                                            If you leave a project with the default settings (no <code
                                                    class="docutils literal"><span
                                                    class="pre">CHANNEL_LAYERS</span></code>),
                                            it&#8217;ll just run and work like a normal WSGI app.</p>

                                        <p>When you want to enable channels in production, you need to do three
                                            things:</p>
                                        <ul class="simple">
                                            <li>Set up a channel backend</li>
                                            <li>Run worker servers</li>
                                            <li>Run interface servers</li>
                                        </ul>
                                        <p>You can set things up in one of two ways; either route all traffic through
                                            a <a class="reference internal" href="#asgi-alone"><span>HTTP/WebSocket interface server</span></a>,
                                            removing the need
                                            to run a WSGI server at all; or, just route WebSockets and long-poll
                                            HTTP connections to the interface server, and <a class="reference internal"
                                                                                             href="#wsgi-with-asgi"><span>leave other pages served
by a standard WSGI server</span></a>.</p>

                                        <p>Routing all traffic through the interface server lets you have WebSockets and
                                            long-polling coexist in the same URL tree with no configuration; if you
                                            split
                                            the traffic up, you&#8217;ll need to configure a webserver or layer 7
                                            loadbalancer
                                            in front of the two servers to route requests to the correct place based on
                                            path or domain. Both methods are covered below.</p>

                                        <div class="section" id="setting-up-a-channel-backend">
                                            <h4>Setting up a channel backend<a class="headerlink"
                                                                               href="#setting-up-a-channel-backend"
                                                                               title="Permalink to this headline">¶</a>
                                            </h4>

                                            <p>The first step is to set up a channel backend. If you followed the
                                                <a class="reference internal"
                                                   href="index.html#document-getting-started"><em>Getting Started with
                                                    Channels</em></a> guide, you will have ended up using the in-memory
                                                backend, which is useful for <code class="docutils literal"><span
                                                        class="pre">runserver</span></code>, but as it only works inside
                                                the
                                                same process, useless for actually running separate worker and interface
                                                servers.</p>

                                            <p>Instead, take a look at the list of <a class="reference internal"
                                                                                      href="index.html#document-backends"><em>Channel
                                                Layer Types</em></a>, and choose one that
                                                fits your requirements (additionally, you could use a third-party
                                                pluggable
                                                backend or write your own - that page also explains the interface and
                                                rules
                                                a backend has to follow).</p>

                                            <p>Typically a channel backend will connect to one or more central servers
                                                that
                                                serve as the communication layer - for example, the Redis backend
                                                connects
                                                to a Redis server. All this goes into the <code
                                                        class="docutils literal"><span class="pre">CHANNEL_LAYERS</span></code>
                                                setting;
                                                here&#8217;s an example for a remote Redis server:</p>

                                            <div class="highlight-python">
                                                <div class="highlight"><pre><span></span><span
                                                        class="n">CHANNEL_LAYERS</span> <span class="o">=</span> <span
                                                        class="p">{</span>
    <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;BACKEND&quot;</span><span class="p">:</span> <span class="s2">&quot;asgi_redis.RedisChannelLayer&quot;</span><span
                                                            class="p">,</span>
        <span class="s2">&quot;CONFIG&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;hosts&quot;</span><span class="p">:</span> <span class="p">[(</span><span class="s2">&quot;redis-server-name&quot;</span><span
                                                            class="p">,</span> <span class="mi">6379</span><span
                                                            class="p">)],</span>
        <span class="p">},</span>
        <span class="s2">&quot;ROUTING&quot;</span><span class="p">:</span> <span class="s2">&quot;my_project.routing.channel_routing&quot;</span><span
                                                            class="p">,</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre>
                                                </div>
                                            </div>
                                            <p>To use the Redis backend you have to install it:</p>

                                            <div class="highlight-python">
                                                <div class="highlight"><pre><span></span>pip install -U asgi_redis
</pre>
                                                </div>
                                            </div>
                                            <p>Some backends, though, don&#8217;t require an extra server, like the IPC
                                                backend,
                                                which works between processes on the same machine but not over the
                                                network
                                                (it&#8217;s available in the <code class="docutils literal"><span
                                                        class="pre">asgi_ipc</span></code> package):</p>

                                            <div class="highlight-python">
                                                <div class="highlight"><pre><span></span><span
                                                        class="n">CHANNEL_LAYERS</span> <span class="o">=</span> <span
                                                        class="p">{</span>
    <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;BACKEND&quot;</span><span class="p">:</span> <span class="s2">&quot;asgi_ipc.IPCChannelLayer&quot;</span><span
                                                            class="p">,</span>
        <span class="s2">&quot;ROUTING&quot;</span><span class="p">:</span> <span class="s2">&quot;my_project.routing.channel_routing&quot;</span><span
                                                            class="p">,</span>
        <span class="s2">&quot;CONFIG&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;prefix&quot;</span><span class="p">:</span> <span
                                                            class="s2">&quot;mysite&quot;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre>
                                                </div>
                                            </div>
                                            <p>Make sure the same settings file is used across all your workers and
                                                interface
                                                servers; without it, they won&#8217;t be able to talk to each other and
                                                things
                                                will just fail to work.</p>
                                        </div>
                                        <div class="section" id="run-worker-servers">
                                            <h4>Run worker servers<a class="headerlink" href="#run-worker-servers"
                                                                     title="Permalink to this headline">¶</a></h4>

                                            <p>Because the work of running consumers is decoupled from the work of
                                                talking
                                                to HTTP, WebSocket and other client connections, you need to run a
                                                cluster
                                                of &#8220;worker servers&#8221; to do all the processing.</p>

                                            <p>Each server is single-threaded, so it&#8217;s recommended you run around
                                                one or two per
                                                core on each machine; it&#8217;s safe to run as many concurrent workers
                                                on the same
                                                machine as you like, as they don&#8217;t open any ports (all they do is
                                                talk to
                                                the channel backend).</p>

                                            <p>To run a worker server, just run:</p>

                                            <div class="highlight-python">
                                                <div class="highlight"><pre><span></span>python manage.py runworker
</pre>
                                                </div>
                                            </div>
                                            <p>Make sure you run this inside an init system or a program like
                                                supervisord that
                                                can take care of restarting the process when it exits; the worker server
                                                has
                                                no retry-on-exit logic, though it will absorb tracebacks from inside
                                                consumers
                                                and forward them to stderr.</p>

                                            <p>Make sure you keep an eye on how busy your workers are; if they get
                                                overloaded,
                                                requests will take longer and longer to return as the messages queue up
                                                (until the expiry or capacity limit is reached, at which point HTTP
                                                connections will
                                                start dropping).</p>

                                            <p>In a more complex project, you won&#8217;t want all your channels being
                                                served by the
                                                same workers, especially if you have long-running tasks (if you serve
                                                them from
                                                the same workers as HTTP requests, there&#8217;s a chance long-running
                                                tasks could
                                                block up all the workers and delay responding to HTTP requests).</p>

                                            <p>To manage this, it&#8217;s possible to tell workers to either limit
                                                themselves to
                                                just certain channel names or ignore specific channels using the
                                                <code class="docutils literal"><span class="pre">--only-channels</span></code>
                                                and <code class="docutils literal"><span
                                                        class="pre">--exclude-channels</span></code> options. Here&#8217;s
                                                an example
                                                of configuring a worker to only serve HTTP and WebSocket requests:</p>

                                            <div class="highlight-python">
                                                <div class="highlight"><pre><span></span>python manage.py runworker --only-channels=http.* --only-channels=websocket.*
</pre>
                                                </div>
                                            </div>
                                            <p>Or telling a worker to ignore all messages on the &#8220;thumbnail&#8221;
                                                channel:</p>

                                            <div class="highlight-python">
                                                <div class="highlight"><pre><span></span>python manage.py runworker --exclude-channels=thumbnail
</pre>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="section" id="run-interface-servers">
                                            <h4>Run interface servers<a class="headerlink" href="#run-interface-servers"
                                                                        title="Permalink to this headline">¶</a></h4>

                                            <p>The final piece of the puzzle is the &#8220;interface servers&#8221;, the
                                                processes that
                                                do the work of taking incoming requests and loading them into the
                                                channels
                                                system.</p>

                                            <p>If you want to support WebSockets, long-poll HTTP requests and other
                                                Channels
                                                features, you&#8217;ll need to run a native ASGI interface server, as
                                                the WSGI
                                                specification has no support for running these kinds of requests
                                                concurrently.
                                                We ship with an interface server that we recommend you use called
                                                <a class="reference external" href="http://github.com/django/daphne/">Daphne</a>;
                                                it supports WebSockets,
                                                long-poll HTTP requests, HTTP/2 <em>(soon)</em> and performs quite well.
                                            </p>

                                            <p>You can just keep running your Django code as a WSGI app if you like,
                                                behind
                                                something like uwsgi or gunicorn; this won&#8217;t let you support
                                                WebSockets, though,
                                                so you&#8217;ll need to run a separate interface server to terminate
                                                those connections
                                                and configure routing in front of your interface and WSGI servers to
                                                route
                                                requests appropriately.</p>

                                            <p>If you use Daphne for all traffic, it auto-negotiates between HTTP and
                                                WebSocket,
                                                so there&#8217;s no need to have your WebSockets on a separate port or
                                                path (and
                                                they&#8217;ll be able to share cookies with your normal view code, which
                                                isn&#8217;t
                                                possible if you separate by domain rather than path).</p>

                                            <p>To run Daphne, it just needs to be supplied with a channel backend, in
                                                much
                                                the same way a WSGI server needs to be given an application.
                                                First, make sure your project has an <code
                                                        class="docutils literal"><span class="pre">asgi.py</span></code>
                                                file that looks like this
                                                (it should live next to <code class="docutils literal"><span
                                                        class="pre">wsgi.py</span></code>):</p>

                                            <div class="highlight-python">
                                                <div class="highlight"><pre><span></span><span class="kn">import</span> <span
                                                        class="nn">os</span>
<span class="kn">from</span> <span class="nn">channels.asgi</span> <span class="kn">import</span> <span class="n">get_channel_layer</span>

<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">setdefault</span><span
                                                            class="p">(</span><span class="s2">&quot;DJANGO_SETTINGS_MODULE&quot;</span><span
                                                            class="p">,</span> <span class="s2">&quot;my_project.settings&quot;</span><span
                                                            class="p">)</span>

<span class="n">channel_layer</span> <span class="o">=</span> <span class="n">get_channel_layer</span><span
                                                            class="p">()</span>
</pre>
                                                </div>
                                            </div>
                                            <p>Then, you can run Daphne and supply the channel layer as the
                                                argument:</p>

                                            <div class="highlight-python">
                                                <div class="highlight"><pre><span></span>daphne my_project.asgi:channel_layer
</pre>
                                                </div>
                                            </div>
                                            <p>Like <code class="docutils literal"><span
                                                    class="pre">runworker</span></code>, you should place this inside an
                                                init system or something
                                                like supervisord to ensure it is re-run if it exits unexpectedly.</p>

                                            <p>If you only run Daphne and no workers, all of your page requests will
                                                seem to
                                                hang forever; that&#8217;s because Daphne doesn&#8217;t have any worker
                                                servers to handle
                                                the request and it&#8217;s waiting for one to appear (while <code
                                                        class="docutils literal"><span
                                                        class="pre">runserver</span></code> also uses
                                                Daphne, it launches worker threads along with it in the same process).
                                                In this
                                                scenario, it will eventually time out and give you a 503 error after 2
                                                minutes;
                                                you can configure how long it waits with the <code
                                                        class="docutils literal"><span class="pre">--http-timeout</span></code>
                                                command line
                                                argument.</p>
                                        </div>
                                        <div class="section" id="deploying-new-versions-of-code">
                                            <h4>Deploying new versions of code<a class="headerlink"
                                                                                 href="#deploying-new-versions-of-code"
                                                                                 title="Permalink to this headline">¶</a>
                                            </h4>

                                            <p>One of the benefits of decoupling the client connection handling from
                                                work
                                                processing is that it means you can run new code without dropping client
                                                connections; this is especially useful for WebSockets.</p>

                                            <p>Just restart your workers when you have new code (by default, if you send
                                                them SIGTERM they&#8217;ll cleanly exit and finish running any
                                                in-process
                                                consumers), and any queued messages or new connections will go to the
                                                new
                                                workers. As long as the new code is session-compatible, you can even do
                                                staged
                                                rollouts to make sure workers on new code aren&#8217;t experiencing high
                                                error rates.</p>

                                            <p>There&#8217;s no need to restart the WSGI or WebSocket interface servers
                                                unless
                                                you&#8217;ve upgraded the interface server itself or changed the <code
                                                        class="docutils literal"><span class="pre">CHANNEL_LAYER</span></code>
                                                setting; none of your code is used by them, and all middleware and code
                                                that can
                                                customize requests is run on the consumers.</p>

                                            <p>You can even use different Python versions for the interface servers and
                                                the
                                                workers; the ASGI protocol that channel layers communicate over
                                                is designed to be portable across all Python versions.</p>
                                        </div>
                                        <div class="section" id="running-just-asgi">
                                            <span id="asgi-alone"></span><h4>Running just ASGI<a class="headerlink"
                                                                                                 href="#running-just-asgi"
                                                                                                 title="Permalink to this headline">¶</a>
                                        </h4>

                                            <p>If you are just running Daphne to serve all traffic, then the
                                                configuration
                                                above is enough where you can just expose it to the Internet and it&#8217;ll
                                                serve
                                                whatever kind of request comes in; for a small site, just the one Daphne
                                                instance and four or five workers is likely enough.</p>

                                            <p>However, larger sites will need to deploy things at a slightly larger
                                                scale,
                                                and how you scale things up is different from WSGI; see <a
                                                        class="reference internal"
                                                        href="#scaling-up"><span>Scaling Up</span></a>.</p>
                                        </div>
                                        <div class="section" id="running-asgi-alongside-wsgi">
                                            <span id="wsgi-with-asgi"></span><h4>Running ASGI alongside WSGI<a
                                                class="headerlink" href="#running-asgi-alongside-wsgi"
                                                title="Permalink to this headline">¶</a></h4>

                                            <p>ASGI and its canonical interface server Daphne are both relatively new,
                                                and so you may not wish to run all your traffic through it yet (or you
                                                may
                                                be using specialized features of your existing WSGI server).</p>

                                            <p>If that&#8217;s the case, that&#8217;s fine; you can run Daphne and a
                                                WSGI server alongside
                                                each other, and only have Daphne serve the requests you need it to
                                                (usually
                                                WebSocket and long-poll HTTP requests, as these do not fit into the WSGI
                                                model).</p>

                                            <p>To do this, just set up your Daphne to serve as we discussed above, and
                                                then
                                                configure your load-balancer or front HTTP server process to dispatch
                                                requests
                                                to the correct server - based on either path, domain, or if
                                                you can, the Upgrade header.</p>

                                            <p>Dispatching based on path or domain means you&#8217;ll need to design
                                                your WebSocket
                                                URLs carefully so you can always tell how to route them at the
                                                load-balancer
                                                level; the ideal thing is to be able to look for the <code
                                                        class="docutils literal"><span class="pre">Upgrade:</span> <span
                                                        class="pre">WebSocket</span></code>
                                                header and distinguish connections by this, but not all software
                                                supports this
                                                and it doesn&#8217;t help route long-poll HTTP connections at all.</p>

                                            <p>You could also invert this model, and have all connections go to Daphne
                                                by
                                                default and selectively route some back to the WSGI server, if you have
                                                particular URLs or domains you want to use that server on.</p>
                                        </div>
                                        <div class="section" id="running-on-a-paas">
                                            <h4>Running on a PaaS<a class="headerlink" href="#running-on-a-paas"
                                                                    title="Permalink to this headline">¶</a></h4>

                                            <p>To run Django with channels enabled on a Platform-as-a-Service (PaaS),
                                                you will
                                                need to ensure that your PaaS allows you to run multiple processes at
                                                different
                                                scaling levels; one group will be running Daphne, as a pure Python
                                                application
                                                (not a WSGI application), and the other should be running <code
                                                        class="docutils literal"><span
                                                        class="pre">runworker</span></code>.</p>

                                            <p>The PaaS will also either have to provide either its own Redis service or
                                                a third process type that lets you run Redis yourself to use the
                                                cross-network
                                                channel backend; both interface and worker processes need to be able to
                                                see
                                                Redis, but not each other.</p>

                                            <p>If you are only allowed one running process type, it&#8217;s possible you
                                                could
                                                combine both interface server and worker into one process using
                                                threading
                                                and the in-memory backend; however, this is not recommended for
                                                production
                                                use as you cannot scale up past a single node without groups failing to
                                                work.</p>
                                        </div>
                                        <div class="section" id="scaling-up">
                                            <span id="id1"></span><h4>Scaling Up<a class="headerlink" href="#scaling-up"
                                                                                   title="Permalink to this headline">¶</a>
                                        </h4>

                                            <p>Scaling up a deployment containing channels (and thus running ASGI) is a
                                                little
                                                different to scaling a WSGI deployment.</p>

                                            <p>The fundamental difference is that the group mechanic requires all
                                                servers serving
                                                the same site to be able to see each other; if you separate the site up
                                                and run
                                                it in a few, large clusters, messages to groups will only deliver to
                                                WebSockets
                                                connected to the same cluster. For some site designs this will be fine,
                                                and if
                                                you think you can live with this and design around it (which means never
                                                designing anything around global notifications or events), this may be a
                                                good
                                                way to go.</p>

                                            <p>For most projects, you&#8217;ll need to run a single channel layer at
                                                scale in order
                                                to achieve proper group delivery. Different backends will scale up
                                                differently,
                                                but the Redis backend can use multiple Redis servers and spread the load
                                                across them using sharding based on consistent hashing.</p>

                                            <p>The key to a channel layer knowing how to scale a channel&#8217;s
                                                delivery is if it
                                                contains the <code class="docutils literal"><span
                                                        class="pre">!</span></code> character or not, which signifies a
                                                single-reader channel.
                                                Single-reader channels are only ever connected to by a single process,
                                                and so
                                                in the Redis case are stored on a single, predictable shard. Other
                                                channels
                                                are assumed to have many workers trying to read them, and so messages
                                                for
                                                these can be evenly divided across all shards.</p>

                                            <p>Django channels are still relatively new, and so it&#8217;s likely that
                                                we don&#8217;t yet
                                                know the full story about how to scale things up; we run large load
                                                tests to
                                                try and refine and improve large-project scaling, but it&#8217;s no
                                                substitute for
                                                actual traffic. If you&#8217;re running channels at scale, you&#8217;re
                                                encouraged to
                                                send feedback to the Django team and work with us to hone the design and
                                                performance of the channel layer backends, or you&#8217;re free to make
                                                your own;
                                                the ASGI specification is comprehensive and comes with a conformance
                                                test
                                                suite, which should aid in any modification of existing backends or
                                                development
                                                of new ones.</p>
                                        </div>
                                    </div>
                                    <span id="document-generics"></span>

                                    <div class="section" id="generic-consumers">
                                        <h3>Generic Consumers<a class="headerlink" href="#generic-consumers"
                                                                title="Permalink to this headline">¶</a></h3>

                                        <p>Much like Django&#8217;s class-based views, Channels has class-based
                                            consumers.
                                            They provide a way for you to arrange code so it&#8217;s highly modifiable
                                            and
                                            inheritable, at the slight cost of it being harder to figure out the
                                            execution
                                            path.</p>

                                        <p>We recommend you use them if you find them valuable; normal function-based
                                            consumers are also entirely valid, however, and may result in more readable
                                            code for simpler tasks.</p>

                                        <p>There is one base generic consumer class, <code
                                                class="docutils literal"><span class="pre">BaseConsumer</span></code>,
                                            that provides
                                            the pattern for method dispatch and is the thing you can build entirely
                                            custom consumers on top of, and then protocol-specific subclasses that
                                            provide
                                            extra utility - for example, the <code class="docutils literal"><span
                                                    class="pre">WebsocketConsumer</span></code> provides automatic
                                            group management for the connection.</p>

                                        <p>When you use class-based consumers in <a class="reference internal"
                                                                                    href="index.html#document-routing"><em>routing</em></a>,
                                            you need
                                            to use <code class="docutils literal"><span
                                                    class="pre">route_class</span></code> rather than <code
                                                    class="docutils literal"><span class="pre">route</span></code>;
                                            <code class="docutils literal"><span class="pre">route_class</span></code>
                                            knows how to
                                            talk to the class-based consumer and extract the list of channels it needs
                                            to listen on from it directly, rather than making you pass it in explicitly.
                                        </p>

                                        <p>Here&#8217;s a routing example:</p>

                                        <div class="highlight-python">
                                            <div class="highlight"><pre><span></span><span class="kn">from</span> <span
                                                    class="nn">channels</span> <span class="kn">import</span> <span
                                                    class="n">route</span><span class="p">,</span> <span class="n">route_class</span>

<span class="n">channel_routing</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">route_class</span><span class="p">(</span><span class="n">consumers</span><span
                                                        class="o">.</span><span class="n">ChatServer</span><span
                                                        class="p">,</span> <span class="n">path</span><span
                                                        class="o">=</span><span
                                                        class="s2">r&quot;^/chat/&quot;</span><span class="p">),</span>
    <span class="n">route</span><span class="p">(</span><span class="s2">&quot;websocket.connect&quot;</span><span
                                                        class="p">,</span> <span class="n">consumers</span><span
                                                        class="o">.</span><span class="n">ws_connect</span><span
                                                        class="p">,</span> <span class="n">path</span><span
                                                        class="o">=</span><span class="s2">r&quot;^/$&quot;</span><span
                                                        class="p">),</span>
<span class="p">]</span>
</pre>
                                            </div>
                                        </div>
                                        <p>Class-based consumers are instantiated once for each message they consume,
                                            so it&#8217;s safe to store things on <code class="docutils literal"><span
                                                    class="pre">self</span></code> (in fact, <code
                                                    class="docutils literal"><span
                                                    class="pre">self.message</span></code> is the
                                            current message by default, and <code class="docutils literal"><span
                                                    class="pre">self.kwargs</span></code> are the keyword arguments
                                            passed in from the routing).</p>

                                        <div class="section" id="base">
                                            <h4>Base<a class="headerlink" href="#base"
                                                       title="Permalink to this headline">¶</a></h4>

                                            <p>The <code class="docutils literal"><span class="pre">BaseConsumer</span></code>
                                                class is the foundation of class-based consumers, and what
                                                you can inherit from if you wish to build your own entirely from
                                                scratch.</p>

                                            <p>You use it like this:</p>

                                            <div class="highlight-python">
                                                <div class="highlight"><pre><span></span><span
                                                        class="kn">from</span> <span class="nn">channels.generic</span> <span
                                                        class="kn">import</span> <span class="n">BaseConsumer</span>

<span class="k">class</span> <span class="nc">MyConsumer</span><span class="p">(</span><span
                                                            class="n">BaseConsumer</span><span class="p">):</span>

    <span class="n">method_mapping</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;channel.name.here&quot;</span><span class="p">:</span> <span class="s2">&quot;method_name&quot;</span><span
                                                            class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">method_name</span><span class="p">(</span><span
                                                            class="bp">self</span><span class="p">,</span> <span
                                                            class="n">message</span><span class="p">,</span> <span
                                                            class="o">**</span><span class="n">kwargs</span><span
                                                            class="p">):</span>
        <span class="k">pass</span>
</pre>
                                                </div>
                                            </div>
                                            <p>All you need to define is the <code class="docutils literal"><span
                                                    class="pre">method_mapping</span></code> dictionary, which maps
                                                channel names to method names. The base code will take care of the
                                                dispatching
                                                for you, and set <code class="docutils literal"><span class="pre">self.message</span></code>
                                                to the current message as well.</p>

                                            <p>If you want to perfom more complicated routing, you&#8217;ll need to
                                                override the
                                                <code class="docutils literal"><span
                                                        class="pre">dispatch()</span></code> and <code
                                                        class="docutils literal"><span
                                                        class="pre">channel_names()</span></code> methods in order to do
                                                the right thing;
                                                remember, though, your channel names cannot change during runtime and
                                                must
                                                always be the same for as long as your process runs.</p>

                                            <p><code class="docutils literal"><span
                                                    class="pre">BaseConsumer</span></code> and all other generic
                                                consumers that inherit from it provide
                                                two instance variables on the class:</p>
                                            <ul class="simple">
                                                <li><code class="docutils literal"><span class="pre">self.message</span></code>,
                                                    the <a class="reference internal"
                                                           href="index.html#ref-message"><span>Message object</span></a>
                                                    representing the
                                                    message the consumer was called for.
                                                </li>
                                                <li><code class="docutils literal"><span class="pre">self.kwargs</span></code>,
                                                    keyword arguments from the <a class="reference internal"
                                                                                  href="index.html#document-routing"><em>Routing</em></a>
                                                </li>
                                            </ul>
                                        </div>
                                        <div class="section" id="websockets">
                                            <h4>WebSockets<a class="headerlink" href="#websockets"
                                                             title="Permalink to this headline">¶</a></h4>

                                            <p>There are two WebSockets generic consumers; one that provides group
                                                management,
                                                simpler send/receive methods, and basic method routing, and a subclass
                                                which
                                                additionally automatically serializes all messages sent and receives
                                                using JSON.</p>

                                            <p>The basic WebSocket generic consumer is used like this:</p>

                                            <div class="highlight-python">
                                                <div class="highlight"><pre><span></span><span
                                                        class="kn">from</span> <span class="nn">channels.generic.websockets</span> <span
                                                        class="kn">import</span> <span
                                                        class="n">WebsocketConsumer</span>

<span class="k">class</span> <span class="nc">MyConsumer</span><span class="p">(</span><span
                                                            class="n">WebsocketConsumer</span><span class="p">):</span>

    <span class="c1"># Set to True to automatically port users from HTTP cookies</span>
    <span class="c1"># (you don&#39;t need channel_session_user, this implies it)</span>
    <span class="n">http_user</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="c1"># Set to True if you want it, else leave it out</span>
    <span class="n">strict_ordering</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">connection_groups</span><span class="p">(</span><span
                                                            class="bp">self</span><span class="p">,</span> <span
                                                            class="o">**</span><span class="n">kwargs</span><span
                                                            class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called to return the list of groups to automatically add/remove</span>
<span class="sd">        this connection to/from.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;test&quot;</span><span
                                                            class="p">]</span>

    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span
                                                            class="p">,</span> <span class="n">message</span><span
                                                            class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span
                                                            class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform things on connection start</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Accept the connection; this is done by default if you don&#39;t override</span>
        <span class="c1"># the connect function.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span
                                                            class="n">reply_channel</span><span class="o">.</span><span
                                                            class="n">send</span><span class="p">({</span><span
                                                            class="s2">&quot;accept&quot;</span><span class="p">:</span> <span
                                                            class="bp">True</span><span class="p">})</span>

    <span class="k">def</span> <span class="nf">receive</span><span class="p">(</span><span class="bp">self</span><span
                                                            class="p">,</span> <span class="n">text</span><span
                                                            class="o">=</span><span class="bp">None</span><span
                                                            class="p">,</span> <span class="nb">bytes</span><span
                                                            class="o">=</span><span class="bp">None</span><span
                                                            class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span
                                                            class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called when a message is received with either text or bytes</span>
<span class="sd">        filled out.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Simple echo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span
                                                            class="n">text</span><span class="o">=</span><span
                                                            class="n">text</span><span class="p">,</span> <span
                                                            class="nb">bytes</span><span class="o">=</span><span
                                                            class="nb">bytes</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">disconnect</span><span class="p">(</span><span
                                                            class="bp">self</span><span class="p">,</span> <span
                                                            class="n">message</span><span class="p">,</span> <span
                                                            class="o">**</span><span class="n">kwargs</span><span
                                                            class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform things on connection close</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>
</pre>
                                                </div>
                                            </div>
                                            <p>You can call <code class="docutils literal"><span
                                                    class="pre">self.send</span></code> inside the class to send things
                                                to the connection&#8217;s
                                                <code class="docutils literal"><span
                                                        class="pre">reply_channel</span></code> automatically. Any group
                                                names returned from <code class="docutils literal"><span class="pre">connection_groups</span></code>
                                                are used to add the socket to when it connects and to remove it from
                                                when it
                                                disconnects; you get keyword arguments too if your URL path, say,
                                                affects
                                                which group to talk to.</p>

                                            <p>Additionally, the property <code class="docutils literal"><span
                                                    class="pre">self.path</span></code> is always set to the current URL
                                                path.</p>

                                            <p>The JSON-enabled consumer looks slightly different:</p>

                                            <div class="highlight-python">
                                                <div class="highlight"><pre><span></span><span
                                                        class="kn">from</span> <span class="nn">channels.generic.websockets</span> <span
                                                        class="kn">import</span> <span
                                                        class="n">JsonWebsocketConsumer</span>

<span class="k">class</span> <span class="nc">MyConsumer</span><span class="p">(</span><span class="n">JsonWebsocketConsumer</span><span
                                                            class="p">):</span>

    <span class="c1"># Set to True if you want it, else leave it out</span>
    <span class="n">strict_ordering</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">connection_groups</span><span class="p">(</span><span
                                                            class="bp">self</span><span class="p">,</span> <span
                                                            class="o">**</span><span class="n">kwargs</span><span
                                                            class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called to return the list of groups to automatically add/remove</span>
<span class="sd">        this connection to/from.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;test&quot;</span><span
                                                            class="p">]</span>

    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span
                                                            class="p">,</span> <span class="n">message</span><span
                                                            class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span
                                                            class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform things on connection start</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">receive</span><span class="p">(</span><span class="bp">self</span><span
                                                            class="p">,</span> <span class="n">content</span><span
                                                            class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span
                                                            class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called when a message is received with decoded JSON content</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Simple echo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span
                                                            class="n">content</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">disconnect</span><span class="p">(</span><span
                                                            class="bp">self</span><span class="p">,</span> <span
                                                            class="n">message</span><span class="p">,</span> <span
                                                            class="o">**</span><span class="n">kwargs</span><span
                                                            class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform things on connection close</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>
</pre>
                                                </div>
                                            </div>
                                            <p>For this subclass, <code class="docutils literal"><span class="pre">receive</span></code>
                                                only gets a <code class="docutils literal"><span
                                                        class="pre">content</span></code> argument that is the
                                                already-decoded JSON as Python datastructures; similarly, <code
                                                        class="docutils literal"><span class="pre">send</span></code>
                                                now only
                                                takes a single argument, which it JSON-encodes before sending down to
                                                the
                                                client.</p>

                                            <p>Note that this subclass still can&#8217;t intercept <code
                                                    class="docutils literal"><span
                                                    class="pre">Group.send()</span></code> calls to make
                                                them into JSON automatically, but it does provide <code
                                                        class="docutils literal"><span
                                                        class="pre">self.group_send(name,</span> <span class="pre">content)</span></code>
                                                that will do this for you if you call it explicitly.</p>

                                            <p><code class="docutils literal"><span
                                                    class="pre">self.close()</span></code> is also provided to easily
                                                close the WebSocket from the
                                                server end with an optional status code once you are done with it.</p>
                                        </div>
                                        <div class="section" id="websocket-multiplexing">
                                            <span id="multiplexing"></span><h4>WebSocket Multiplexing<a
                                                class="headerlink" href="#websocket-multiplexing"
                                                title="Permalink to this headline">¶</a></h4>

                                            <p>Channels provides a standard way to multiplex different data streams over
                                                a single WebSocket, called a <code class="docutils literal"><span
                                                        class="pre">Demultiplexer</span></code>.</p>

                                            <p>It expects JSON-formatted WebSocket frames with two keys, <code
                                                    class="docutils literal"><span class="pre">stream</span></code> and
                                                <code class="docutils literal"><span class="pre">payload</span></code>,
                                                and will match the <code class="docutils literal"><span class="pre">stream</span></code>
                                                against the mapping to find a
                                                channel name. It will then forward the message onto that channel while
                                                preserving <code class="docutils literal"><span class="pre">reply_channel</span></code>,
                                                so you can hook consumers up to them directly
                                                in the <code class="docutils literal"><span
                                                        class="pre">routing.py</span></code> file, and use
                                                authentication decorators as you wish.</p>

                                            <p>Example using class-based consumer:</p>

                                            <div class="highlight-python">
                                                <div class="highlight"><pre><span></span><span
                                                        class="kn">from</span> <span class="nn">channels.generic.websockets</span> <span
                                                        class="kn">import</span> <span
                                                        class="n">WebsocketDemultiplexer</span><span class="p">,</span> <span
                                                        class="n">JsonWebsocketConsumer</span>

<span class="k">class</span> <span class="nc">EchoConsumer</span><span class="p">(</span><span
                                                            class="n">websockets</span><span class="o">.</span><span
                                                            class="n">JsonWebsocketConsumer</span><span
                                                            class="p">):</span>
    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span
                                                            class="p">,</span> <span class="n">message</span><span
                                                            class="p">,</span> <span class="n">multiplexer</span><span
                                                            class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span
                                                            class="p">):</span>
        <span class="c1"># Send data with the multiplexer</span>
        <span class="n">multiplexer</span><span class="o">.</span><span class="n">send</span><span
                                                            class="p">({</span><span
                                                            class="s2">&quot;status&quot;</span><span class="p">:</span> <span
                                                            class="s2">&quot;I just connected!&quot;</span><span
                                                            class="p">})</span>

    <span class="k">def</span> <span class="nf">disconnect</span><span class="p">(</span><span
                                                            class="bp">self</span><span class="p">,</span> <span
                                                            class="n">message</span><span class="p">,</span> <span
                                                            class="n">multiplexer</span><span class="p">,</span> <span
                                                            class="o">**</span><span class="n">kwargs</span><span
                                                            class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Stream </span><span
                                                            class="si">%s</span><span class="s2"> is closed&quot;</span> <span
                                                            class="o">%</span> <span class="n">multiplexer</span><span
                                                            class="o">.</span><span class="n">stream</span><span
                                                            class="p">)</span>

    <span class="k">def</span> <span class="nf">receive</span><span class="p">(</span><span class="bp">self</span><span
                                                            class="p">,</span> <span class="n">content</span><span
                                                            class="p">,</span> <span class="n">multiplexer</span><span
                                                            class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span
                                                            class="p">):</span>
        <span class="c1"># Simple echo</span>
        <span class="n">multiplexer</span><span class="o">.</span><span class="n">send</span><span
                                                            class="p">({</span><span class="s2">&quot;original_message&quot;</span><span
                                                            class="p">:</span> <span class="n">content</span><span
                                                            class="p">})</span>


<span class="k">class</span> <span class="nc">AnotherConsumer</span><span class="p">(</span><span
                                                            class="n">websockets</span><span class="o">.</span><span
                                                            class="n">JsonWebsocketConsumer</span><span
                                                            class="p">):</span>
    <span class="k">def</span> <span class="nf">receive</span><span class="p">(</span><span class="bp">self</span><span
                                                            class="p">,</span> <span class="n">content</span><span
                                                            class="p">,</span> <span class="n">multiplexer</span><span
                                                            class="o">=</span><span class="bp">None</span><span
                                                            class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span
                                                            class="p">):</span>
        <span class="c1"># Some other actions here</span>
        <span class="k">pass</span>


<span class="k">class</span> <span class="nc">Demultiplexer</span><span class="p">(</span><span class="n">WebsocketDemultiplexer</span><span
                                                            class="p">):</span>

    <span class="c1"># Wire your JSON consumers here: {stream_name : consumer}</span>
    <span class="n">consumers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;echo&quot;</span><span class="p">:</span> <span class="n">EchoConsumer</span><span
                                                            class="p">,</span>
        <span class="s2">&quot;other&quot;</span><span class="p">:</span> <span class="n">AnotherConsumer</span><span
                                                            class="p">,</span>
    <span class="p">}</span>
</pre>
                                                </div>
                                            </div>
                                            <p>The <code class="docutils literal"><span
                                                    class="pre">multiplexer</span></code> allows the consumer class to
                                                be independant of the stream name.
                                                It holds the stream name and the demultiplexer on the attributes <code
                                                        class="docutils literal"><span class="pre">stream</span></code>
                                                and <code class="docutils literal"><span
                                                        class="pre">demultiplexer</span></code>.</p>

                                            <p>The <a class="reference internal" href="index.html#document-binding"><em>data
                                                binding</em></a> code will also send out messages to clients
                                                in the same format, and you can encode things in this format yourself by
                                                using the <code class="docutils literal"><span class="pre">WebsocketDemultiplexer.encode</span></code>
                                                class method.</p>
                                        </div>
                                        <div class="section" id="sessions-and-users">
                                            <h4>Sessions and Users<a class="headerlink" href="#sessions-and-users"
                                                                     title="Permalink to this headline">¶</a></h4>

                                            <p>If you wish to use <code class="docutils literal"><span class="pre">channel_session</span></code>
                                                or <code class="docutils literal"><span
                                                        class="pre">channel_session_user</span></code> with a
                                                class-based consumer, simply set one of the variables in the class body:
                                            </p>

                                            <div class="highlight-python">
                                                <div class="highlight"><pre><span></span><span
                                                        class="k">class</span> <span class="nc">MyConsumer</span><span
                                                        class="p">(</span><span class="n">WebsocketConsumer</span><span
                                                        class="p">):</span>

    <span class="n">channel_session_user</span> <span class="o">=</span> <span class="bp">True</span>
</pre>
                                                </div>
                                            </div>
                                            <p>This will run the appropriate decorator around your handler methods, and
                                                provide
                                                <code class="docutils literal"><span
                                                        class="pre">message.channel_session</span></code> and <code
                                                        class="docutils literal"><span
                                                        class="pre">message.user</span></code> on the message object -
                                                both
                                                the one passed in to your handler as an argument as well as <code
                                                        class="docutils literal"><span
                                                        class="pre">self.message</span></code>,
                                                as they point to the same instance.</p>

                                            <p>And if you just want to use the user from the django session, add <code
                                                    class="docutils literal"><span class="pre">http_user</span></code>:
                                            </p>

                                            <div class="highlight-python">
                                                <div class="highlight"><pre><span></span><span
                                                        class="k">class</span> <span class="nc">MyConsumer</span><span
                                                        class="p">(</span><span class="n">WebsocketConsumer</span><span
                                                        class="p">):</span>

    <span class="n">http_user</span> <span class="o">=</span> <span class="bp">True</span>
</pre>
                                                </div>
                                            </div>
                                            <p>This will give you <code class="docutils literal"><span class="pre">message.user</span></code>,
                                                which will be the same as <code class="docutils literal"><span
                                                        class="pre">request.user</span></code>
                                                would be on a regular View.</p>
                                        </div>
                                        <div class="section" id="applying-decorators">
                                            <h4>Applying Decorators<a class="headerlink" href="#applying-decorators"
                                                                      title="Permalink to this headline">¶</a></h4>

                                            <p>To apply decorators to a class-based consumer, you&#8217;ll have to wrap
                                                a functional
                                                part of the consumer; in this case, <code class="docutils literal"><span
                                                        class="pre">get_handler</span></code> is likely the place you
                                                want to override; like so:</p>

                                            <div class="highlight-python">
                                                <div class="highlight"><pre><span></span><span
                                                        class="k">class</span> <span class="nc">MyConsumer</span><span
                                                        class="p">(</span><span class="n">WebsocketConsumer</span><span
                                                        class="p">):</span>

    <span class="k">def</span> <span class="nf">get_handler</span><span class="p">(</span><span
                                                            class="bp">self</span><span class="p">,</span> <span
                                                            class="o">*</span><span class="n">args</span><span
                                                            class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span
                                                            class="p">):</span>
        <span class="n">handler</span> <span class="o">=</span> <span class="nb">super</span><span
                                                            class="p">(</span><span class="n">MyConsumer</span><span
                                                            class="p">,</span> <span class="bp">self</span><span
                                                            class="p">)</span><span class="o">.</span><span class="n">get_handler</span><span
                                                            class="p">(</span><span class="o">*</span><span class="n">args</span><span
                                                            class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span
                                                            class="p">)</span>
        <span class="k">return</span> <span class="n">your_decorator</span><span class="p">(</span><span class="n">handler</span><span
                                                            class="p">)</span>
</pre>
                                                </div>
                                            </div>
                                            <p>You can also use the Django <code class="docutils literal"><span
                                                    class="pre">method_decorator</span></code> utility to wrap methods
                                                that
                                                have <code class="docutils literal"><span
                                                        class="pre">message</span></code> as their first positional
                                                argument - note that it won&#8217;t work
                                                for more high-level methods, like <code class="docutils literal"><span
                                                        class="pre">WebsocketConsumer.receive</span></code>.</p>
                                        </div>
                                        <div class="section" id="as-route">
                                            <h4>As route<a class="headerlink" href="#as-route"
                                                           title="Permalink to this headline">¶</a></h4>

                                            <p>Instead of making routes using <code class="docutils literal"><span
                                                    class="pre">route_class</span></code> you may use the <code
                                                    class="docutils literal"><span class="pre">as_route</span></code>
                                                shortcut.
                                                This function takes route filters (<a class="reference internal"
                                                                                      href="index.html#filters"><span>Filters</span></a>)
                                                as kwargs and returns
                                                <code class="docutils literal"><span
                                                        class="pre">route_class</span></code>. For example:</p>

                                            <div class="highlight-python">
                                                <div class="highlight"><pre><span></span><span
                                                        class="kn">from</span> <span class="nn">.</span> <span
                                                        class="kn">import</span> <span class="n">consumers</span>

<span class="n">channel_routing</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">consumers</span><span class="o">.</span><span class="n">ChatServer</span><span
                                                            class="o">.</span><span class="n">as_route</span><span
                                                            class="p">(</span><span class="n">path</span><span
                                                            class="o">=</span><span
                                                            class="s2">r&quot;^/chat/&quot;</span><span
                                                            class="p">),</span>
<span class="p">]</span>
</pre>
                                                </div>
                                            </div>
                                            <p>Use the <code class="docutils literal"><span
                                                    class="pre">attrs</span></code> dict keyword for dynamic class
                                                attributes. For example you have
                                                the generic consumer:</p>

                                            <div class="highlight-python">
                                                <div class="highlight"><pre><span></span><span
                                                        class="k">class</span> <span class="nc">MyGenericConsumer</span><span
                                                        class="p">(</span><span class="n">WebsocketConsumer</span><span
                                                        class="p">):</span>
    <span class="n">group</span> <span class="o">=</span> <span class="s1">&#39;default&#39;</span>
    <span class="n">group_prefix</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">connection_groups</span><span class="p">(</span><span
                                                            class="bp">self</span><span class="p">,</span> <span
                                                            class="o">**</span><span class="n">kwargs</span><span
                                                            class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;_&#39;</span><span
                                                            class="o">.</span><span class="n">join</span><span
                                                            class="p">(</span><span class="bp">self</span><span
                                                            class="o">.</span><span class="n">group_prefix</span><span
                                                            class="p">,</span> <span class="bp">self</span><span
                                                            class="o">.</span><span class="n">group</span><span
                                                            class="p">)]</span>
</pre>
                                                </div>
                                            </div>
                                            <p>You can create consumers with different <code
                                                    class="docutils literal"><span class="pre">group</span></code> and
                                                <code class="docutils literal"><span
                                                        class="pre">group_prefix</span></code> with <code
                                                        class="docutils literal"><span class="pre">attrs</span></code>,
                                                like so:</p>

                                            <div class="highlight-python">
                                                <div class="highlight"><pre><span></span><span
                                                        class="kn">from</span> <span class="nn">.</span> <span
                                                        class="kn">import</span> <span class="n">consumers</span>

<span class="n">channel_routing</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">consumers</span><span class="o">.</span><span class="n">MyGenericConsumer</span><span
                                                            class="o">.</span><span class="n">as_route</span><span
                                                            class="p">(</span><span class="n">path</span><span
                                                            class="o">=</span><span
                                                            class="s2">r&quot;^/path/1/&quot;</span><span
                                                            class="p">,</span>
                                         <span class="n">attrs</span><span class="o">=</span><span
                                                            class="p">{</span><span
                                                            class="s1">&#39;group&#39;</span><span
                                                            class="p">:</span> <span
                                                            class="s1">&#39;one&#39;</span><span
                                                            class="p">,</span> <span
                                                            class="s1">&#39;group_prefix&#39;</span><span
                                                            class="p">:</span> <span
                                                            class="s1">&#39;pre&#39;</span><span class="p">}),</span>
    <span class="n">consumers</span><span class="o">.</span><span class="n">MyGenericConsumer</span><span
                                                            class="o">.</span><span class="n">as_route</span><span
                                                            class="p">(</span><span class="n">path</span><span
                                                            class="o">=</span><span
                                                            class="s2">r&quot;^/path/2/&quot;</span><span
                                                            class="p">,</span>
                                         <span class="n">attrs</span><span class="o">=</span><span
                                                            class="p">{</span><span
                                                            class="s1">&#39;group&#39;</span><span
                                                            class="p">:</span> <span
                                                            class="s1">&#39;two&#39;</span><span
                                                            class="p">,</span> <span
                                                            class="s1">&#39;group_prefix&#39;</span><span
                                                            class="p">:</span> <span
                                                            class="s1">&#39;public&#39;</span><span class="p">}),</span>
<span class="p">]</span>
</pre>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <span id="document-routing"></span>

                                    <div class="section" id="routing">
                                        <h3>Routing<a class="headerlink" href="#routing"
                                                      title="Permalink to this headline">¶</a></h3>

                                        <p>Routing in Channels is done using a system similar to that in core Django;
                                            a list of possible routes is provided, and Channels goes through all routes
                                            until a match is found, and then runs the resulting consumer.</p>

                                        <p>The difference comes, however, in the fact that Channels has to route based
                                            on more than just URL; channel name is the main thing routed on, and URL
                                            path is one of many other optional things you can route on, depending on
                                            the protocol (for example, imagine email consumers - they would route on
                                            domain or recipient address instead).</p>

                                        <p>The routing Channels takes is just a list of <em>routing objects</em> - the
                                            three
                                            built in ones are <code class="docutils literal"><span
                                                    class="pre">route</span></code>, <code
                                                    class="docutils literal"><span class="pre">route_class</span></code>
                                            and <code class="docutils literal"><span class="pre">include</span></code>,
                                            but any object
                                            that implements the routing interface will work:</p>
                                        <ul class="simple">
                                            <li>A method called <code class="docutils literal"><span
                                                    class="pre">match</span></code>, taking a single <code
                                                    class="docutils literal"><span class="pre">message</span></code> as
                                                an argument and
                                                returning <code class="docutils literal"><span
                                                        class="pre">None</span></code> for no match or a tuple of <code
                                                        class="docutils literal"><span class="pre">(consumer,</span>
                                                    <span class="pre">kwargs)</span></code> if matched.
                                            </li>
                                            <li>A method called <code class="docutils literal"><span class="pre">channel_names</span></code>,
                                                which returns a set of channel names that
                                                will match, which is fed to the channel layer to listen on them.
                                            </li>
                                        </ul>
                                        <p>The three default routing objects are:</p>
                                        <ul class="simple">
                                            <li><code class="docutils literal"><span class="pre">route</span></code>:
                                                Takes a channel name, a consumer function, and optional filter
                                                keyword arguments.
                                            </li>
                                            <li><code class="docutils literal"><span
                                                    class="pre">route_class</span></code>: Takes a class-based consumer,
                                                and optional filter
                                                keyword arguments. Channel names are taken from the consumer&#8217;s
                                                <code class="docutils literal"><span class="pre">channel_names()</span></code>
                                                method.
                                            </li>
                                            <li><code class="docutils literal"><span class="pre">include</span></code>:
                                                Takes either a list or string import path to a routing list,
                                                and optional filter keyword arguments.
                                            </li>
                                        </ul>
                                        <div class="section" id="filters">
                                            <span id="id1"></span><h4>Filters<a class="headerlink" href="#filters"
                                                                                title="Permalink to this headline">¶</a>
                                        </h4>

                                            <p>Filtering is how you limit matches based on, for example, URLs; you use
                                                regular
                                                expressions, like so:</p>

                                            <div class="highlight-python">
                                                <div class="highlight"><pre><span></span><span
                                                        class="n">route</span><span class="p">(</span><span class="s2">&quot;websocket.connect&quot;</span><span
                                                        class="p">,</span> <span class="n">consumers</span><span
                                                        class="o">.</span><span class="n">ws_connect</span><span
                                                        class="p">,</span> <span class="n">path</span><span
                                                        class="o">=</span><span
                                                        class="s2">r&quot;^/chat/$&quot;</span><span class="p">)</span>
</pre>
                                                </div>
                                            </div>
                                            <div class="admonition note">
                                                <p class="first admonition-title">Note</p>

                                                <p class="last">Unlike Django&#8217;s URL routing, which strips the
                                                    first slash of a URL for
                                                    neatness, Channels includes the first slash, as the routing system
                                                    is
                                                    generic and not designed just for URLs.</p>
                                            </div>
                                            <p>You can have multiple filters:</p>

                                            <div class="highlight-python">
                                                <div class="highlight"><pre><span></span><span
                                                        class="n">route</span><span class="p">(</span><span class="s2">&quot;email.receive&quot;</span><span
                                                        class="p">,</span> <span class="n">comment_response</span><span
                                                        class="p">,</span> <span class="n">to_address</span><span
                                                        class="o">=</span><span
                                                        class="s2">r&quot;.*@example.com$&quot;</span><span
                                                        class="p">,</span> <span class="n">subject</span><span
                                                        class="o">=</span><span
                                                        class="s2">&quot;^reply&quot;</span><span class="p">)</span>
</pre>
                                                </div>
                                            </div>
                                            <p>Multiple filters are always combined with logical AND; that is, you need
                                                to
                                                match every filter to have the consumer called.</p>

                                            <p>Filters can capture keyword arguments to be passed to your function or
                                                your class based consumer methods as a <code
                                                        class="docutils literal"><span class="pre">kwarg</span></code>:
                                            </p>

                                            <div class="highlight-python">
                                                <div class="highlight"><pre><span></span><span
                                                        class="n">route</span><span class="p">(</span><span class="s2">&quot;websocket.connect&quot;</span><span
                                                        class="p">,</span> <span class="n">connect_blog</span><span
                                                        class="p">,</span> <span class="n">path</span><span
                                                        class="o">=</span><span class="s1">r&#39;^/liveblog/(?P&lt;slug&gt;[^/]+)/stream/$&#39;</span><span
                                                        class="p">)</span>
</pre>
                                                </div>
                                            </div>
                                            <p>You can also specify filters on an <code class="docutils literal"><span
                                                    class="pre">include</span></code>:</p>

                                            <div class="highlight-python">
                                                <div class="highlight"><pre><span></span><span
                                                        class="n">include</span><span class="p">(</span><span
                                                        class="s2">&quot;blog_includes&quot;</span><span
                                                        class="p">,</span> <span class="n">path</span><span
                                                        class="o">=</span><span
                                                        class="s1">r&#39;^/liveblog&#39;</span><span class="p">)</span>
</pre>
                                                </div>
                                            </div>
                                            <p>When you specify filters on <code class="docutils literal"><span
                                                    class="pre">include</span></code>, the matched portion of the
                                                attribute
                                                is removed for matches inside the include; for example, this arrangement
                                                matches URLs like <code class="docutils literal"><span class="pre">/liveblog/stream/</span></code>,
                                                because the outside <code class="docutils literal"><span class="pre">include</span></code>
                                                strips off the <code class="docutils literal"><span class="pre">/liveblog</span></code>
                                                part it matches before passing it inside:</p>

                                            <div class="highlight-python">
                                                <div class="highlight"><pre><span></span><span
                                                        class="n">inner_routes</span> <span class="o">=</span> <span
                                                        class="p">[</span>
    <span class="n">route</span><span class="p">(</span><span class="s2">&quot;websocket.connect&quot;</span><span
                                                            class="p">,</span> <span class="n">connect_blog</span><span
                                                            class="p">,</span> <span class="n">path</span><span
                                                            class="o">=</span><span
                                                            class="s1">r&#39;^/stream/&#39;</span><span
                                                            class="p">),</span>
<span class="p">]</span>

<span class="n">routing</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">include</span><span class="p">(</span><span class="n">inner_routes</span><span
                                                            class="p">,</span> <span class="n">path</span><span
                                                            class="o">=</span><span
                                                            class="s1">r&#39;^/liveblog&#39;</span><span
                                                            class="p">)</span>
<span class="p">]</span>
</pre>
                                                </div>
                                            </div>
                                            <p>You can also include named capture groups in the filters on an include
                                                and
                                                they&#8217;ll be passed to the consumer just like those on <code
                                                        class="docutils literal"><span class="pre">route</span></code>;
                                                note, though,
                                                that if the keyword argument names from the <code
                                                        class="docutils literal"><span class="pre">include</span></code>
                                                and the <code class="docutils literal"><span
                                                        class="pre">route</span></code>
                                                clash, the values from <code class="docutils literal"><span class="pre">route</span></code>
                                                will take precedence.</p>
                                        </div>
                                    </div>
                                    <span id="document-binding"></span>

                                    <div class="section" id="data-binding">
                                        <h3>Data Binding<a class="headerlink" href="#data-binding"
                                                           title="Permalink to this headline">¶</a></h3>

                                        <p>The Channels data binding framework automates the process of tying Django
                                            models into frontend views, such as javascript-powered website UIs. It
                                            provides
                                            a quick and flexible way to generate messages on Groups for model changes
                                            and to accept messages that change models themselves.</p>

                                        <p>The main target for the moment is WebSockets, but the framework is flexible
                                            enough to be used over any protocol.</p>

                                        <div class="section" id="what-does-data-binding-allow">
                                            <h4>What does data binding allow?<a class="headerlink"
                                                                                href="#what-does-data-binding-allow"
                                                                                title="Permalink to this headline">¶</a>
                                            </h4>

                                            <p>Data binding in Channels works two ways:</p>
                                            <ul class="simple">
                                                <li>Outbound, where model changes made through Django are sent out to
                                                    listening
                                                    clients. This includes creation, updates and deletion of instances.
                                                </li>
                                                <li>Inbound, where a standardised message format allows creation, update
                                                    and
                                                    deletion of instances to be made by clients sending messages.
                                                </li>
                                            </ul>
                                            <p>Combined, these allow a UI to be designed that automatically updates to
                                                reflect new values and reflects across clients. A live blog is easily
                                                done
                                                using data binding against the post object, for example, or an edit
                                                interface
                                                can show data live as it&#8217;s edited by other users.</p>

                                            <p>It has some limitations:</p>
                                            <ul class="simple">
                                                <li>Signals are used to power outbound binding, so if you change the
                                                    values of
                                                    a model outside of Django (or use the <code
                                                            class="docutils literal"><span class="pre">.update()</span></code>
                                                    method on a QuerySet),
                                                    the signals are not triggered and the change will not be sent out.
                                                    You
                                                    can trigger changes yourself, but you&#8217;ll need to source the
                                                    events from the
                                                    right place for your system.
                                                </li>
                                                <li>The built-in serializers are based on the built-in Django ones and
                                                    can only
                                                    handle certain field types; for more flexibility, you can plug in
                                                    something
                                                    like the Django REST Framework serializers.
                                                </li>
                                            </ul>
                                        </div>
                                        <div class="section" id="getting-started">
                                            <h4>Getting Started<a class="headerlink" href="#getting-started"
                                                                  title="Permalink to this headline">¶</a></h4>

                                            <p>A single Binding subclass will handle outbound and inbound binding for a
                                                model,
                                                and you can have multiple bindings per model (if you want different
                                                formats
                                                or permission checks, for example).</p>

                                            <p>You can inherit from the base Binding and provide all the methods needed,
                                                but
                                                we&#8217;ll focus on the WebSocket JSON variant here, as it&#8217;s the
                                                easiest thing to
                                                get started and likely close to what you want.</p>

                                            <p>Start off like this:</p>

                                            <div class="highlight-python">
                                                <div class="highlight"><pre><span></span><span
                                                        class="kn">from</span> <span class="nn">django.db</span> <span
                                                        class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">channels.binding.websockets</span> <span class="kn">import</span> <span
                                                            class="n">WebsocketBinding</span>

<span class="k">class</span> <span class="nc">IntegerValue</span><span class="p">(</span><span
                                                            class="n">models</span><span class="o">.</span><span
                                                            class="n">Model</span><span class="p">):</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span
                                                            class="n">CharField</span><span class="p">(</span><span
                                                            class="n">max_length</span><span class="o">=</span><span
                                                            class="mi">100</span><span class="p">,</span> <span
                                                            class="n">unique</span><span class="o">=</span><span
                                                            class="bp">True</span><span class="p">)</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span
                                                            class="n">IntegerField</span><span class="p">(</span><span
                                                            class="n">default</span><span class="o">=</span><span
                                                            class="mi">0</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">IntegerValueBinding</span><span class="p">(</span><span class="n">WebsocketBinding</span><span
                                                            class="p">):</span>

    <span class="n">model</span> <span class="o">=</span> <span class="n">IntegerValue</span>
    <span class="n">stream</span> <span class="o">=</span> <span class="s2">&quot;intval&quot;</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span
                                                            class="s2">&quot;name&quot;</span><span
                                                            class="p">,</span> <span class="s2">&quot;value&quot;</span><span
                                                            class="p">]</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">group_names</span><span class="p">(</span><span
                                                            class="n">cls</span><span class="p">,</span> <span
                                                            class="n">instance</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;intval-updates&quot;</span><span
                                                            class="p">]</span>

    <span class="k">def</span> <span class="nf">has_permission</span><span class="p">(</span><span
                                                            class="bp">self</span><span class="p">,</span> <span
                                                            class="n">user</span><span class="p">,</span> <span
                                                            class="n">action</span><span class="p">,</span> <span
                                                            class="n">pk</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">True</span>
</pre>
                                                </div>
                                            </div>
                                            <p>This defines a WebSocket binding - so it knows to send outgoing messages
                                                formatted as JSON WebSocket frames - and provides the three things you
                                                must
                                                always provide:</p>
                                            <ul class="simple">
                                                <li><code class="docutils literal"><span
                                                        class="pre">fields</span></code> is a whitelist of fields to
                                                    return in the serialized request.
                                                    Channels does not default to all fields for security concerns; if
                                                    you want
                                                    this, set it to the value <code class="docutils literal"><span
                                                            class="pre">[&quot;__all__&quot;]</span></code>. As an
                                                    alternative, <code class="docutils literal"><span class="pre">exclude</span></code>
                                                    acts as a blacklist of fields.
                                                </li>
                                                <li><code class="docutils literal"><span class="pre">group_names</span></code>
                                                    returns a list of groups to send outbound updates to based
                                                    on the instance. For example, you could dispatch posts on different
                                                    liveblogs to groups that included the parent blog ID in the name;
                                                    here, we
                                                    just use a fixed group name. Based on how <code
                                                            class="docutils literal"><span
                                                            class="pre">group_names</span></code> changes as the
                                                    instance changes, Channels will work out if clients need <code
                                                            class="docutils literal"><span
                                                            class="pre">create</span></code>,
                                                    <code class="docutils literal"><span
                                                            class="pre">update</span></code> or <code
                                                            class="docutils literal"><span
                                                            class="pre">delete</span></code> messages (or if the change
                                                    is hidden from them).
                                                </li>
                                                <li><code class="docutils literal"><span
                                                        class="pre">has_permission</span></code> returns if an inbound
                                                    binding update is allowed to actually
                                                    be carried out on the model. We&#8217;ve been very unsafe and made
                                                    it always return
                                                    <code class="docutils literal"><span class="pre">True</span></code>,
                                                    but here is where you would check against either Django&#8217;s or
                                                    your
                                                    own permission system to see if the user is allowed that action.
                                                </li>
                                            </ul>
                                            <p>For reference, <code class="docutils literal"><span
                                                    class="pre">action</span></code> is always one of the unicode
                                                strings <code class="docutils literal"><span class="pre">&quot;create&quot;</span></code>,
                                                <code class="docutils literal"><span
                                                        class="pre">&quot;update&quot;</span></code> or <code
                                                        class="docutils literal"><span
                                                        class="pre">&quot;delete&quot;</span></code>. You also supply
                                                the <a class="reference internal" href="index.html#multiplexing"><span>WebSocket Multiplexing</span></a>
                                                stream name to provide to the client - you must use multiplexing if you
                                                use WebSocket data binding.</p>

                                            <p>Just adding the binding like this in a place where it will be imported
                                                will
                                                get outbound messages sending, but you still need a Consumer that will
                                                both
                                                accept incoming binding updates and add people to the right Groups when
                                                they
                                                connect. The WebSocket binding classes use the standard <a
                                                        class="reference internal" href="index.html#multiplexing"><span>WebSocket Multiplexing</span></a>,
                                                so you just need to use that:</p>

                                            <div class="highlight-python">
                                                <div class="highlight"><pre><span></span><span
                                                        class="kn">from</span> <span class="nn">channels.generic.websockets</span> <span
                                                        class="kn">import</span> <span
                                                        class="n">WebsocketDemultiplexer</span>
<span class="kn">from</span> <span class="nn">.binding</span> <span class="kn">import</span> <span class="n">IntegerValueBinding</span>

<span class="k">class</span> <span class="nc">Demultiplexer</span><span class="p">(</span><span class="n">WebsocketDemultiplexer</span><span
                                                            class="p">):</span>

    <span class="n">consumers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;intval&quot;</span><span class="p">:</span> <span
                                                            class="n">IntegerValueBinding</span><span class="o">.</span><span
                                                            class="n">consumer</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">connection_groups</span><span class="p">(</span><span
                                                            class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;intval-updates&quot;</span><span
                                                            class="p">]</span>
</pre>
                                                </div>
                                            </div>
                                            <p>As well as the standard stream-to-consumer mapping, you also need to set
                                                <code class="docutils literal"><span
                                                        class="pre">connection_groups</span></code>, a list of groups to
                                                put people in when they connect.
                                                This should match the logic of <code class="docutils literal"><span
                                                        class="pre">group_names</span></code> on your binding - we&#8217;ve
                                                used
                                                our fixed group name again. Notice that the binding has a <code
                                                        class="docutils literal"><span
                                                        class="pre">.consumer</span></code> attribute;
                                                this is a standard WebSocket-JSON consumer, that the demultiplexer can
                                                pass
                                                demultiplexed <code class="docutils literal"><span class="pre">websocket.receive</span></code>
                                                messages to.</p>

                                            <p>Tie that into your routing, and you&#8217;re ready to go:</p>

                                            <div class="highlight-python">
                                                <div class="highlight"><pre><span></span><span
                                                        class="kn">from</span> <span class="nn">channels</span> <span
                                                        class="kn">import</span> <span class="n">route_class</span><span
                                                        class="p">,</span> <span class="n">route</span>
<span class="kn">from</span> <span class="nn">.consumers</span> <span class="kn">import</span> <span class="n">Demultiplexer</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">IntegerValueBinding</span>

<span class="n">channel_routing</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">route_class</span><span class="p">(</span><span class="n">Demultiplexer</span><span
                                                            class="p">,</span> <span class="n">path</span><span
                                                            class="o">=</span><span
                                                            class="s2">&quot;^/binding/&quot;</span><span
                                                            class="p">),</span>
<span class="p">]</span>
</pre>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="section" id="frontend-considerations">
                                            <h4>Frontend Considerations<a class="headerlink"
                                                                          href="#frontend-considerations"
                                                                          title="Permalink to this headline">¶</a></h4>

                                            <p>You can use the standard Channels WebSocket wrapper <strong>(not yet
                                                available)</strong>
                                                to automatically run demultiplexing, and then tie the events you receive
                                                into
                                                your frontend framework of choice based on <code
                                                        class="docutils literal"><span class="pre">action</span></code>,
                                                <code class="docutils literal"><span class="pre">pk</span></code> and
                                                <code class="docutils literal"><span class="pre">data</span></code>.</p>

                                            <div class="admonition note">
                                                <p class="first admonition-title">Note</p>

                                                <p class="last">Common plugins for data binding against popular
                                                    JavaScript frameworks are
                                                    wanted; if you&#8217;re interested, please get in touch.</p>
                                            </div>
                                        </div>
                                        <div class="section" id="custom-serialization-protocols">
                                            <h4>Custom Serialization/Protocols<a class="headerlink"
                                                                                 href="#custom-serialization-protocols"
                                                                                 title="Permalink to this headline">¶</a>
                                            </h4>

                                            <p>Rather than inheriting from the <code class="docutils literal"><span
                                                    class="pre">WebsocketBinding</span></code>, you can inherit directly
                                                from the base <code class="docutils literal"><span
                                                        class="pre">Binding</span></code> class and implement
                                                serialization and deserialization
                                                yourself. Until proper reference documentation for this is written, we
                                                recommend looking at the source code in <code
                                                        class="docutils literal"><span class="pre">channels/bindings/base.py</span></code>;
                                                it&#8217;s
                                                reasonably well-commented.</p>
                                        </div>
                                        <div class="section" id="dealing-with-disconnection">
                                            <h4>Dealing with Disconnection<a class="headerlink"
                                                                             href="#dealing-with-disconnection"
                                                                             title="Permalink to this headline">¶</a>
                                            </h4>

                                            <p>Because the data binding Channels ships with has no history of events,
                                                it means that when a disconnection happens you may miss events that
                                                happen
                                                during your offline time. For this reason, it&#8217;s recommended you
                                                reload
                                                data directly using an API call once connection has been re-established,
                                                don&#8217;t rely on the live updates for critical functionality, or have
                                                UI designs
                                                that cope well with missing data (e.g. ones where it&#8217;s all updates
                                                and no
                                                creates, so the next update will correct everything).</p>
                                        </div>
                                    </div>
                                    <span id="document-backends"></span>

                                    <div class="section" id="channel-layer-types">
                                        <h3>Channel Layer Types<a class="headerlink" href="#channel-layer-types"
                                                                  title="Permalink to this headline">¶</a></h3>

                                        <p>Multiple choices of backend are available, to fill different tradeoffs of
                                            complexity, throughput and scalability. You can also write your own backend
                                            if
                                            you wish; the spec they confirm to is called <a class="reference internal"
                                                                                            href="index.html#document-asgi"><em>ASGI</em></a>.
                                            Any
                                            ASGI-compliant channel layer can be used.</p>

                                        <div class="section" id="redis">
                                            <h4>Redis<a class="headerlink" href="#redis"
                                                        title="Permalink to this headline">¶</a></h4>

                                            <p>The Redis layer is the recommended backend to run Channels with, as it
                                                supports both high throughput on a single Redis server as well as the
                                                ability
                                                to run against a set of Redis servers in a sharded mode.</p>

                                            <p>To use the Redis layer, simply install it from PyPI (it lives in a
                                                separate
                                                package, as we didn&#8217;t want to force a dependency on the redis-py
                                                for the main
                                                install):</p>

                                            <div class="highlight-python">
                                                <div class="highlight"><pre><span></span>pip install -U asgi_redis
</pre>
                                                </div>
                                            </div>
                                            <p>By default, it will attempt to connect to a Redis server on <code
                                                    class="docutils literal"><span
                                                    class="pre">localhost:6379</span></code>,
                                                but you can override this with the <code class="docutils literal"><span
                                                        class="pre">hosts</span></code> key in its config:</p>

                                            <div class="highlight-python">
                                                <div class="highlight"><pre><span></span><span
                                                        class="n">CHANNEL_LAYERS</span> <span class="o">=</span> <span
                                                        class="p">{</span>
    <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;BACKEND&quot;</span><span class="p">:</span> <span class="s2">&quot;asgi_redis.RedisChannelLayer&quot;</span><span
                                                            class="p">,</span>
        <span class="s2">&quot;ROUTING&quot;</span><span class="p">:</span> <span class="s2">&quot;???&quot;</span><span
                                                            class="p">,</span>
        <span class="s2">&quot;CONFIG&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;hosts&quot;</span><span class="p">:</span> <span class="p">[(</span><span class="s2">&quot;redis-channel-1&quot;</span><span
                                                            class="p">,</span> <span class="mi">6379</span><span
                                                            class="p">),</span> <span class="p">(</span><span
                                                            class="s2">&quot;redis-channel-2&quot;</span><span
                                                            class="p">,</span> <span class="mi">6379</span><span
                                                            class="p">)],</span>
        <span class="p">},</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre>
                                                </div>
                                            </div>
                                            <div class="section" id="sharding">
                                                <h5>Sharding<a class="headerlink" href="#sharding"
                                                               title="Permalink to this headline">¶</a></h5>

                                                <p>The sharding model is based on consistent hashing - in particular,
                                                    <a class="reference internal" href="index.html#channel-types"><span>response channels</span></a>
                                                    are hashed and used to pick a single
                                                    Redis server that both the interface server and the worker will use.
                                                </p>

                                                <p>For normal channels, since any worker can service any channel
                                                    request, messages
                                                    are simply distributed randomly among all possible servers, and
                                                    workers will
                                                    pick a single server to listen to. Note that if you run more Redis
                                                    servers than
                                                    workers, it&#8217;s very likely that some servers will not have
                                                    workers listening to
                                                    them; we recommend you always have at least ten workers for each
                                                    Redis server
                                                    to ensure good distribution. Workers will, however, change server
                                                    periodically
                                                    (every five seconds or so) so queued messages should eventually get
                                                    a response.</p>

                                                <p>Note that if you change the set of sharding servers you will need to
                                                    restart
                                                    all interface servers and workers with the new set before anything
                                                    works,
                                                    and any in-flight messages will be lost (even with persistence, some
                                                    will);
                                                    the consistent hashing model relies on all running clients having
                                                    the same
                                                    settings. Any misconfigured interface server or worker will drop
                                                    some or all
                                                    messages.</p>
                                            </div>
                                        </div>
                                        <div class="section" id="ipc">
                                            <h4>IPC<a class="headerlink" href="#ipc" title="Permalink to this headline">¶</a>
                                            </h4>

                                            <p>The IPC backend uses POSIX shared memory segments and semaphores in order
                                                to
                                                allow different processes on the same machine to communicate with each
                                                other.</p>

                                            <p>As it uses shared memory, it does not require any additional servers
                                                running
                                                to get working, and is quicker than any network-based channel layer.
                                                However,
                                                it can only run between processes on the same machine.</p>

                                            <div class="admonition warning">
                                                <p class="first admonition-title">Warning</p>

                                                <p class="last">The IPC layer only communicates between processes on the
                                                    same machine,
                                                    and while you might initially be tempted to run a cluster of
                                                    machines all
                                                    with their own IPC-based set of processes, this will result in
                                                    groups not
                                                    working properly; events sent to a group will only go to those
                                                    channels
                                                    that joined the group on the same machine. This backend is for
                                                    single-machine deployments only.</p>
                                            </div>
                                        </div>
                                        <div class="section" id="in-memory">
                                            <h4>In-memory<a class="headerlink" href="#in-memory"
                                                            title="Permalink to this headline">¶</a></h4>

                                            <p>The in-memory layer is only useful when running the protocol server and
                                                the
                                                worker server in a single process; the most common case of this
                                                is <code class="docutils literal"><span
                                                        class="pre">runserver</span></code>, where a server thread, this
                                                channel layer, and worker thread all
                                                co-exist inside the same python process.</p>

                                            <p>Its path is <code class="docutils literal"><span class="pre">asgiref.inmemory.ChannelLayer</span></code>.
                                                If you try and use this channel
                                                layer with <code class="docutils literal"><span
                                                        class="pre">runworker</span></code>, it will exit, as it does
                                                not support cross-process
                                                communication.</p>
                                        </div>
                                        <div class="section" id="writing-custom-channel-layers">
                                            <h4>Writing Custom Channel Layers<a class="headerlink"
                                                                                href="#writing-custom-channel-layers"
                                                                                title="Permalink to this headline">¶</a>
                                            </h4>

                                            <p>The interface channel layers present to Django and other software that
                                                communicates over them is codified in a specification called <a
                                                        class="reference internal" href="index.html#document-asgi"><em>ASGI</em></a>.
                                            </p>

                                            <p>Any channel layer that conforms to the <a class="reference internal"
                                                                                         href="index.html#document-asgi"><em>ASGI
                                                spec</em></a> can be used
                                                by Django; just set <code class="docutils literal"><span class="pre">BACKEND</span></code>
                                                to the class to instantiate and <code class="docutils literal"><span
                                                        class="pre">CONFIG</span></code> to
                                                a dict of keyword arguments to initialize the class with.</p>
                                        </div>
                                    </div>
                                    <span id="document-delay"></span>

                                    <div class="section" id="delay-server">
                                        <h3>Delay Server<a class="headerlink" href="#delay-server"
                                                           title="Permalink to this headline">¶</a></h3>

                                        <p>Channels has an optional app <code class="docutils literal"><span
                                                class="pre">channels.delay</span></code> that implements the <a
                                                class="reference internal" href="index.html#document-asgi/delay"><em>ASGI
                                            Delay Protocol</em></a>.</p>

                                        <p>The server is exposed through a custom management command <code
                                                class="docutils literal"><span class="pre">rundelay</span></code> which
                                            listens to
                                            the <cite>asgi.delay</cite> channel for messages to delay.</p>

                                        <div class="section" id="getting-started-with-delay">
                                            <h4>Getting Started with Delay<a class="headerlink"
                                                                             href="#getting-started-with-delay"
                                                                             title="Permalink to this headline">¶</a>
                                            </h4>

                                            <p>To Install the app add <cite>channels.delay</cite> to <cite>INSTALLED_APPS</cite>:
                                            </p>

                                            <div class="highlight-python">
                                                <div class="highlight"><pre><span></span>INSTALLED_APPS = (
    ...
    &#39;channels&#39;,
    &#39;channels.delay&#39;
)
</pre>
                                                </div>
                                            </div>
                                            <p>Run <cite>migrate</cite> to create the tables</p>

                                            <p><cite>python manage.py migrate</cite></p>

                                            <p>Run the delay process to start processing messages</p>

                                            <p><cite>python manage.py rundelay</cite></p>

                                            <p>Now you&#8217;re ready to start delaying messages.</p>
                                        </div>
                                        <div class="section" id="delaying-messages">
                                            <h4>Delaying Messages<a class="headerlink" href="#delaying-messages"
                                                                    title="Permalink to this headline">¶</a></h4>

                                            <p>To delay a message by a fixed number of milliseconds use the
                                                <cite>delay</cite> parameter.</p>

                                            <p>Here&#8217;s an example:</p>

                                            <div class="highlight-python">
                                                <div class="highlight"><pre><span></span><span
                                                        class="kn">from</span> <span class="nn">channels</span> <span
                                                        class="kn">import</span> <span class="n">Channel</span>

<span class="n">delayed_message</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;channel&#39;</span><span class="p">:</span> <span
                                                            class="s1">&#39;example_channel&#39;</span><span
                                                            class="p">,</span>
    <span class="s1">&#39;content&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span
                                                            class="p">:</span> <span class="mi">1</span><span class="p">},</span>
    <span class="s1">&#39;delay&#39;</span><span class="p">:</span> <span class="mi">10</span> <span class="o">*</span> <span
                                                            class="mi">1000</span>
<span class="p">}</span>
<span class="c1"># The message will be delayed 10 seconds by the server and then sent</span>
<span class="n">Channel</span><span class="p">(</span><span class="s1">&#39;asgi.delay&#39;</span><span
                                                            class="p">)</span><span class="o">.</span><span class="n">send</span><span
                                                            class="p">(</span><span
                                                            class="n">delayed_message</span><span
                                                            class="p">,</span> <span class="n">immediately</span><span
                                                            class="o">=</span><span class="bp">True</span><span
                                                            class="p">)</span>
</pre>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <span id="document-testing"></span>

                                    <div class="section" id="testing-consumers">
                                        <h3>Testing Consumers<a class="headerlink" href="#testing-consumers"
                                                                title="Permalink to this headline">¶</a></h3>

                                        <p>When you want to write unit tests for your new Channels consumers, you&#8217;ll
                                            realize that you can&#8217;t use the standard Django test client to submit
                                            fake HTTP
                                            requests - instead, you&#8217;ll need to submit fake Messages to your
                                            consumers,
                                            and inspect what Messages they send themselves.</p>

                                        <p>We provide a <code class="docutils literal"><span class="pre">TestCase</span></code>
                                            subclass that sets all of this up for you,
                                            however, so you can easily write tests and check what your consumers are
                                            sending.</p>

                                        <div class="section" id="channeltestcase">
                                            <h4>ChannelTestCase<a class="headerlink" href="#channeltestcase"
                                                                  title="Permalink to this headline">¶</a></h4>

                                            <p>If your tests inherit from the <code class="docutils literal"><span
                                                    class="pre">channels.tests.ChannelTestCase</span></code> base class,
                                                whenever you run tests your channel layer will be swapped out for a
                                                captive
                                                in-memory layer, meaning you don&#8217;t need an external server running
                                                to run tests.</p>

                                            <p>Moreover, you can inject messages onto this layer and inspect ones sent
                                                to it
                                                to help test your consumers.</p>

                                            <p>To inject a message onto the layer, simply call <code
                                                    class="docutils literal"><span
                                                    class="pre">Channel.send()</span></code> inside
                                                any test method on a <code class="docutils literal"><span class="pre">ChannelTestCase</span></code>
                                                subclass, like so:</p>

                                            <div class="highlight-python">
                                                <div class="highlight"><pre><span></span><span
                                                        class="kn">from</span> <span class="nn">channels</span> <span
                                                        class="kn">import</span> <span class="n">Channel</span>
<span class="kn">from</span> <span class="nn">channels.tests</span> <span class="kn">import</span> <span class="n">ChannelTestCase</span>

<span class="k">class</span> <span class="nc">MyTests</span><span class="p">(</span><span
                                                            class="n">ChannelTestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_a_thing</span><span class="p">(</span><span
                                                            class="bp">self</span><span class="p">):</span>
        <span class="c1"># This goes onto an in-memory channel, not the real backend.</span>
        <span class="n">Channel</span><span class="p">(</span><span class="s2">&quot;some-channel-name&quot;</span><span
                                                            class="p">)</span><span class="o">.</span><span class="n">send</span><span
                                                            class="p">({</span><span
                                                            class="s2">&quot;foo&quot;</span><span
                                                            class="p">:</span> <span
                                                            class="s2">&quot;bar&quot;</span><span class="p">})</span>
</pre>
                                                </div>
                                            </div>
                                            <p>To receive a message from the layer, you can use <code
                                                    class="docutils literal"><span class="pre">self.get_next_message(channel)</span></code>,
                                                which handles receiving the message and converting it into a Message
                                                object for
                                                you (if you want, you can call <code class="docutils literal"><span
                                                        class="pre">receive_many</span></code> on the underlying channel
                                                layer,
                                                but you&#8217;ll get back a raw dict and channel name, which is not what
                                                consumers want).</p>

                                            <p>You can use this both to get Messages to send to consumers as their
                                                primary
                                                argument, as well as to get Messages from channels that consumers are
                                                supposed
                                                to send on to verify that they did.</p>

                                            <p>You can even pass <code class="docutils literal"><span class="pre">require=True</span></code>
                                                to <code class="docutils literal"><span
                                                        class="pre">get_next_message</span></code> to make the test
                                                fail if there is no message on the channel (by default, it will return
                                                you
                                                <code class="docutils literal"><span class="pre">None</span></code>
                                                instead).</p>

                                            <p>Here&#8217;s an extended example testing a consumer that&#8217;s supposed
                                                to take a value
                                                and post the square of it to the <code class="docutils literal"><span
                                                        class="pre">&quot;result&quot;</span></code> channel:</p>

                                            <div class="highlight-python">
                                                <div class="highlight"><pre><span></span><span
                                                        class="kn">from</span> <span class="nn">channels</span> <span
                                                        class="kn">import</span> <span class="n">Channel</span>
<span class="kn">from</span> <span class="nn">channels.tests</span> <span class="kn">import</span> <span class="n">ChannelTestCase</span>

<span class="k">class</span> <span class="nc">MyTests</span><span class="p">(</span><span
                                                            class="n">ChannelTestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_a_thing</span><span class="p">(</span><span
                                                            class="bp">self</span><span class="p">):</span>
        <span class="c1"># Inject a message onto the channel to use in a consumer</span>
        <span class="n">Channel</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span
                                                            class="p">)</span><span class="o">.</span><span class="n">send</span><span
                                                            class="p">({</span><span class="s2">&quot;value&quot;</span><span
                                                            class="p">:</span> <span class="mi">33</span><span
                                                            class="p">})</span>
        <span class="c1"># Run the consumer with the new Message object</span>
        <span class="n">my_consumer</span><span class="p">(</span><span class="bp">self</span><span
                                                            class="o">.</span><span
                                                            class="n">get_next_message</span><span
                                                            class="p">(</span><span
                                                            class="s2">&quot;input&quot;</span><span class="p">,</span> <span
                                                            class="n">require</span><span class="o">=</span><span
                                                            class="bp">True</span><span class="p">))</span>
        <span class="c1"># Verify there&#39;s a result and that it&#39;s accurate</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span
                                                            class="n">get_next_message</span><span
                                                            class="p">(</span><span class="s2">&quot;result&quot;</span><span
                                                            class="p">,</span> <span class="n">require</span><span
                                                            class="o">=</span><span class="bp">True</span><span
                                                            class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span
                                                            class="p">(</span><span class="n">result</span><span
                                                            class="p">[</span><span
                                                            class="s1">&#39;value&#39;</span><span
                                                            class="p">],</span> <span class="mi">1089</span><span
                                                            class="p">)</span>
</pre>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="section" id="generic-consumers">
                                            <h4>Generic Consumers<a class="headerlink" href="#generic-consumers"
                                                                    title="Permalink to this headline">¶</a></h4>

                                            <p>You can use <code class="docutils literal"><span class="pre">ChannelTestCase</span></code>
                                                to test generic consumers as well. Just pass the message
                                                object from <code class="docutils literal"><span class="pre">get_next_message</span></code>
                                                to the constructor of the class. To test replies to a specific channel,
                                                use the <code class="docutils literal"><span
                                                        class="pre">reply_channel</span></code> property on the <code
                                                        class="docutils literal"><span class="pre">Message</span></code>
                                                object. For example:</p>

                                            <div class="highlight-python">
                                                <div class="highlight"><pre><span></span><span
                                                        class="kn">from</span> <span class="nn">channels</span> <span
                                                        class="kn">import</span> <span class="n">Channel</span>
<span class="kn">from</span> <span class="nn">channels.tests</span> <span class="kn">import</span> <span class="n">ChannelTestCase</span>

<span class="kn">from</span> <span class="nn">myapp.consumers</span> <span class="kn">import</span> <span class="n">MyConsumer</span>

<span class="k">class</span> <span class="nc">MyTests</span><span class="p">(</span><span
                                                            class="n">ChannelTestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">test_a_thing</span><span class="p">(</span><span
                                                            class="bp">self</span><span class="p">):</span>
        <span class="c1"># Inject a message onto the channel to use in a consumer</span>
        <span class="n">Channel</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span
                                                            class="p">)</span><span class="o">.</span><span class="n">send</span><span
                                                            class="p">({</span><span class="s2">&quot;value&quot;</span><span
                                                            class="p">:</span> <span class="mi">33</span><span
                                                            class="p">})</span>
        <span class="c1"># Run the consumer with the new Message object</span>
        <span class="n">message</span> <span class="o">=</span> <span class="bp">self</span><span
                                                            class="o">.</span><span
                                                            class="n">get_next_message</span><span
                                                            class="p">(</span><span
                                                            class="s2">&quot;input&quot;</span><span class="p">,</span> <span
                                                            class="n">require</span><span class="o">=</span><span
                                                            class="bp">True</span><span class="p">)</span>
        <span class="n">MyConsumer</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="c1"># Verify there&#39;s a reply and that it&#39;s accurate</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span
                                                            class="n">get_next_message</span><span
                                                            class="p">(</span><span class="n">message</span><span
                                                            class="o">.</span><span class="n">reply_channel</span><span
                                                            class="o">.</span><span class="n">name</span><span
                                                            class="p">,</span> <span class="n">require</span><span
                                                            class="o">=</span><span class="bp">True</span><span
                                                            class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span
                                                            class="p">(</span><span class="n">result</span><span
                                                            class="p">[</span><span
                                                            class="s1">&#39;value&#39;</span><span
                                                            class="p">],</span> <span class="mi">1089</span><span
                                                            class="p">)</span>
</pre>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="section" id="groups">
                                            <h4>Groups<a class="headerlink" href="#groups"
                                                         title="Permalink to this headline">¶</a></h4>

                                            <p>You can test Groups in the same way as Channels inside a <code
                                                    class="docutils literal"><span
                                                    class="pre">ChannelTestCase</span></code>;
                                                the entire channel layer is flushed each time a test is run, so it&#8217;s
                                                safe to
                                                do group adds and sends during a test. For example:</p>

                                            <div class="highlight-python">
                                                <div class="highlight"><pre><span></span><span
                                                        class="kn">from</span> <span class="nn">channels</span> <span
                                                        class="kn">import</span> <span class="n">Group</span>
<span class="kn">from</span> <span class="nn">channels.tests</span> <span class="kn">import</span> <span class="n">ChannelTestCase</span>

<span class="k">class</span> <span class="nc">MyTests</span><span class="p">(</span><span
                                                            class="n">ChannelTestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_a_thing</span><span class="p">(</span><span
                                                            class="bp">self</span><span class="p">):</span>
        <span class="c1"># Add a test channel to a test group</span>
        <span class="n">Group</span><span class="p">(</span><span class="s2">&quot;test-group&quot;</span><span
                                                            class="p">)</span><span class="o">.</span><span class="n">add</span><span
                                                            class="p">(</span><span
                                                            class="s2">&quot;test-channel&quot;</span><span
                                                            class="p">)</span>
        <span class="c1"># Send to the group</span>
        <span class="n">Group</span><span class="p">(</span><span class="s2">&quot;test-group&quot;</span><span
                                                            class="p">)</span><span class="o">.</span><span class="n">send</span><span
                                                            class="p">({</span><span class="s2">&quot;value&quot;</span><span
                                                            class="p">:</span> <span class="mi">42</span><span
                                                            class="p">})</span>
        <span class="c1"># Verify the message got into the destination channel</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span
                                                            class="n">get_next_message</span><span
                                                            class="p">(</span><span
                                                            class="s2">&quot;test-channel&quot;</span><span
                                                            class="p">,</span> <span class="n">require</span><span
                                                            class="o">=</span><span class="bp">True</span><span
                                                            class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span
                                                            class="p">(</span><span class="n">result</span><span
                                                            class="p">[</span><span
                                                            class="s1">&#39;value&#39;</span><span
                                                            class="p">],</span> <span class="mi">42</span><span
                                                            class="p">)</span>
</pre>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="section" id="clients">
                                            <h4>Clients<a class="headerlink" href="#clients"
                                                          title="Permalink to this headline">¶</a></h4>

                                            <p>For more complicated test suites you can use the <code
                                                    class="docutils literal"><span class="pre">Client</span></code>
                                                abstraction that
                                                provides an easy way to test the full life cycle of messages with a
                                                couple of methods:
                                                <code class="docutils literal"><span class="pre">send</span></code> to
                                                sending message with given content to the given channel, <code
                                                        class="docutils literal"><span class="pre">consume</span></code>
                                                to run appointed consumer for the next message, <code
                                                        class="docutils literal"><span class="pre">receive</span></code>
                                                to getting replies for client.
                                                Very often you may need to <code class="docutils literal"><span
                                                        class="pre">send</span></code> and than call a consumer one by
                                                one, for this
                                                purpose use <code class="docutils literal"><span class="pre">send_and_consume</span></code>
                                                method:</p>

                                            <div class="highlight-python">
                                                <div class="highlight"><pre><span></span><span
                                                        class="kn">from</span> <span
                                                        class="nn">channels.tests</span> <span class="kn">import</span> <span
                                                        class="n">ChannelTestCase</span><span class="p">,</span> <span
                                                        class="n">Client</span>

<span class="k">class</span> <span class="nc">MyTests</span><span class="p">(</span><span
                                                            class="n">ChannelTestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">test_my_consumer</span><span class="p">(</span><span
                                                            class="bp">self</span><span class="p">):</span>
        <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span>
        <span class="n">client</span><span class="o">.</span><span class="n">send_and_consume</span><span
                                                            class="p">(</span><span class="s1">&#39;my_internal_channel&#39;</span><span
                                                            class="p">,</span> <span class="p">{</span><span class="s1">&#39;value&#39;</span><span
                                                            class="p">:</span> <span
                                                            class="s1">&#39;my_value&#39;</span><span
                                                            class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span
                                                            class="p">(</span><span class="n">client</span><span
                                                            class="o">.</span><span class="n">receive</span><span
                                                            class="p">(),</span> <span class="p">{</span><span
                                                            class="s1">&#39;all is&#39;</span><span
                                                            class="p">:</span> <span
                                                            class="s1">&#39;done&#39;</span><span class="p">})</span>
</pre>
                                                </div>
                                            </div>
                                            <p>You can use <code class="docutils literal"><span
                                                    class="pre">HttpClient</span></code> for websocket related
                                                consumers. It automatically serializes JSON content,
                                                manage cookies and headers, give easy access to the session and add
                                                ability to authorize your requests.
                                                For example:</p>

                                            <div class="highlight-python">
                                                <div class="highlight"><pre><span></span># consumers.py
class RoomConsumer(JsonWebsocketConsumer):
    http_user = True
    groups = [&#39;rooms_watchers&#39;]

    def receive(self, content, **kwargs):
        self.send({&#39;rooms&#39;: self.message.http_session.get(&quot;rooms&quot;, [])})
        Channel(&quot;rooms_receive&quot;).send({&#39;user&#39;: self.message.user.id,
                                       &#39;message&#39;: content[&#39;message&#39;]}


# tests.py
from channels import Group
from channels.tests import ChannelTestCase, HttpClient


class RoomsTests(ChannelTestCase):

    def test_rooms(self):
        client = HttpClient()
        user = User.objects.create_user(
            username=&#39;test&#39;, email=&#39;test@test.com&#39;, password=&#39;123456&#39;)
        client.login(username=&#39;test&#39;, password=&#39;123456&#39;)

        client.send_and_consume(&#39;websocket.connect&#39;, &#39;/rooms/&#39;)
        # check that there is nothing to receive
        self.assertIsNone(client.receive())

        # test that the client in the group
        Group(RoomConsumer.groups[0]).send({&#39;text&#39;: &#39;ok&#39;}, immediately=True)
        self.assertEqual(client.receive(json=False), &#39;ok&#39;)

        client.session[&#39;rooms&#39;] = [&#39;test&#39;, &#39;1&#39;]
        client.session.save()

        client.send_and_consume(&#39;websocket.receive&#39;,
                                text={&#39;message&#39;: &#39;hey&#39;},
                                path=&#39;/rooms/&#39;)
        # test &#39;response&#39;
        self.assertEqual(client.receive(), {&#39;rooms&#39;: [&#39;test&#39;, &#39;1&#39;]})

        self.assertEqual(self.get_next_message(&#39;rooms_receive&#39;).content,
                         {&#39;user&#39;: user.id, &#39;message&#39;: &#39;hey&#39;})

        # There is nothing to receive
        self.assertIsNone(client.receive())
</pre>
                                                </div>
                                            </div>
                                            <p>Instead of <code class="docutils literal"><span class="pre">HttpClient.login</span></code>
                                                method with credentials at arguments you
                                                may call <code class="docutils literal"><span class="pre">HttpClient.force_login</span></code>
                                                (like at django client) with the user object.</p>

                                            <p><code class="docutils literal"><span class="pre">receive</span></code>
                                                method by default trying to deserialize json text content of a message,
                                                so if you need to pass decoding use <code class="docutils literal"><span
                                                        class="pre">receive(json=False)</span></code>, like in the
                                                example.</p>
                                        </div>
                                        <div class="section" id="applying-routes">
                                            <h4>Applying routes<a class="headerlink" href="#applying-routes"
                                                                  title="Permalink to this headline">¶</a></h4>

                                            <p>When you need to testing you consumers without routes in settings or you
                                                want to testing your consumers in more isolate and atomic way, it will
                                                be
                                                simpler with <code class="docutils literal"><span class="pre">apply_routes</span></code>
                                                contextmanager and decorator for your <code
                                                        class="docutils literal"><span
                                                        class="pre">ChannelTestCase</span></code>.
                                                It takes list of routes that you want to use and overwrite existing
                                                routes:</p>

                                            <div class="highlight-python">
                                                <div class="highlight"><pre><span></span><span
                                                        class="kn">from</span> <span
                                                        class="nn">channels.tests</span> <span class="kn">import</span> <span
                                                        class="n">ChannelTestCase</span><span class="p">,</span> <span
                                                        class="n">HttpClient</span><span class="p">,</span> <span
                                                        class="n">apply_routes</span>

<span class="k">class</span> <span class="nc">MyTests</span><span class="p">(</span><span
                                                            class="n">ChannelTestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">test_myconsumer</span><span class="p">(</span><span
                                                            class="bp">self</span><span class="p">):</span>
        <span class="n">client</span> <span class="o">=</span> <span class="n">HttpClient</span><span
                                                            class="p">()</span>

        <span class="k">with</span> <span class="n">apply_routes</span><span class="p">([</span><span class="n">MyConsumer</span><span
                                                            class="o">.</span><span class="n">as_route</span><span
                                                            class="p">(</span><span class="n">path</span><span
                                                            class="o">=</span><span
                                                            class="s1">&#39;/new&#39;</span><span class="p">)]):</span>
            <span class="n">client</span><span class="o">.</span><span class="n">send_and_consume</span><span class="p">(</span><span
                                                            class="s1">&#39;websocket.connect&#39;</span><span
                                                            class="p">,</span> <span
                                                            class="s1">&#39;/new&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span
                                                            class="p">(</span><span class="n">client</span><span
                                                            class="o">.</span><span class="n">receive</span><span
                                                            class="p">(),</span> <span class="p">{</span><span
                                                            class="s1">&#39;key&#39;</span><span
                                                            class="p">:</span> <span
                                                            class="s1">&#39;value&#39;</span><span class="p">})</span>
</pre>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="section" id="test-data-binding-with-httpclient">
                                            <h4>Test Data binding with <code class="docutils literal"><span class="pre">HttpClient</span></code><a
                                                    class="headerlink" href="#test-data-binding-with-httpclient"
                                                    title="Permalink to this headline">¶</a></h4>

                                            <p>As you know data binding in channels works in outbound and inbound ways,
                                                so that ways tests in different ways and <code class="docutils literal"><span
                                                        class="pre">HttpClient</span></code> and <code
                                                        class="docutils literal"><span
                                                        class="pre">apply_routes</span></code>
                                                will help to do this.
                                                When you testing outbound consumers you need just import your <code
                                                        class="docutils literal"><span class="pre">Binding</span></code>
                                                subclass with specified <code class="docutils literal"><span
                                                        class="pre">group_names</span></code>. At test you can join to
                                                one of them,
                                                make some changes with target model and check received message.
                                                Lets test <code class="docutils literal"><span class="pre">IntegerValueBinding</span></code>
                                                from <a class="reference internal"
                                                        href="index.html#document-binding"><em>data binding</em></a>
                                                with creating:</p>

                                            <div class="highlight-python">
                                                <div class="highlight"><pre><span></span><span
                                                        class="kn">from</span> <span
                                                        class="nn">channels.tests</span> <span class="kn">import</span> <span
                                                        class="n">ChannelTestCase</span><span class="p">,</span> <span
                                                        class="n">HttpClient</span>
<span class="kn">from</span> <span class="nn">channels.signals</span> <span class="kn">import</span> <span class="n">consumer_finished</span>

<span class="k">class</span> <span class="nc">TestIntegerValueBinding</span><span class="p">(</span><span class="n">ChannelTestCase</span><span
                                                            class="p">):</span>

    <span class="k">def</span> <span class="nf">test_outbound_create</span><span class="p">(</span><span
                                                            class="bp">self</span><span class="p">):</span>
        <span class="c1"># We use HttpClient because of json encoding messages</span>
        <span class="n">client</span> <span class="o">=</span> <span class="n">HttpClient</span><span
                                                            class="p">()</span>
        <span class="n">client</span><span class="o">.</span><span class="n">join_group</span><span
                                                            class="p">(</span><span class="s2">&quot;intval-updates&quot;</span><span
                                                            class="p">)</span>  <span
                                                            class="c1"># join outbound binding</span>

        <span class="c1"># create target entity</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">IntegerValue</span><span
                                                            class="o">.</span><span class="n">objects</span><span
                                                            class="o">.</span><span class="n">create</span><span
                                                            class="p">(</span><span class="n">name</span><span
                                                            class="o">=</span><span
                                                            class="s1">&#39;fifty&#39;</span><span
                                                            class="p">,</span> <span class="n">value</span><span
                                                            class="o">=</span><span class="mi">50</span><span class="p">)</span>

        <span class="n">consumer_finished</span><span class="o">.</span><span class="n">send</span><span
                                                            class="p">(</span><span class="n">sender</span><span
                                                            class="o">=</span><span class="bp">None</span><span
                                                            class="p">)</span>
        <span class="n">received</span> <span class="o">=</span> <span class="n">client</span><span
                                                            class="o">.</span><span class="n">receive</span><span
                                                            class="p">()</span>  <span class="c1"># receive outbound binding message</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span
                                                            class="p">(</span><span class="n">received</span><span
                                                            class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span
                                                            class="p">(</span><span class="s1">&#39;payload&#39;</span> <span
                                                            class="ow">in</span> <span class="n">received</span><span
                                                            class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span
                                                            class="p">(</span><span
                                                            class="s1">&#39;action&#39;</span> <span
                                                            class="ow">in</span> <span class="n">received</span><span
                                                            class="p">[</span><span
                                                            class="s1">&#39;payload&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span
                                                            class="p">(</span><span
                                                            class="s1">&#39;data&#39;</span> <span class="ow">in</span> <span
                                                            class="n">received</span><span class="p">[</span><span
                                                            class="s1">&#39;payload&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span
                                                            class="p">(</span><span
                                                            class="s1">&#39;name&#39;</span> <span class="ow">in</span> <span
                                                            class="n">received</span><span class="p">[</span><span
                                                            class="s1">&#39;payload&#39;</span><span class="p">][</span><span
                                                            class="s1">&#39;data&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span
                                                            class="p">(</span><span
                                                            class="s1">&#39;value&#39;</span> <span class="ow">in</span> <span
                                                            class="n">received</span><span class="p">[</span><span
                                                            class="s1">&#39;payload&#39;</span><span class="p">][</span><span
                                                            class="s1">&#39;data&#39;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span
                                                            class="p">(</span><span class="n">received</span><span
                                                            class="p">[</span><span
                                                            class="s1">&#39;payload&#39;</span><span class="p">][</span><span
                                                            class="s1">&#39;action&#39;</span><span class="p">],</span> <span
                                                            class="s1">&#39;create&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span
                                                            class="p">(</span><span class="n">received</span><span
                                                            class="p">[</span><span
                                                            class="s1">&#39;payload&#39;</span><span class="p">][</span><span
                                                            class="s1">&#39;model&#39;</span><span
                                                            class="p">],</span> <span class="s1">&#39;values.integervalue&#39;</span><span
                                                            class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span
                                                            class="p">(</span><span class="n">received</span><span
                                                            class="p">[</span><span
                                                            class="s1">&#39;payload&#39;</span><span class="p">][</span><span
                                                            class="s1">&#39;pk&#39;</span><span
                                                            class="p">],</span> <span class="n">value</span><span
                                                            class="o">.</span><span class="n">pk</span><span
                                                            class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span
                                                            class="p">(</span><span class="n">received</span><span
                                                            class="p">[</span><span
                                                            class="s1">&#39;payload&#39;</span><span class="p">][</span><span
                                                            class="s1">&#39;data&#39;</span><span
                                                            class="p">][</span><span
                                                            class="s1">&#39;name&#39;</span><span
                                                            class="p">],</span> <span
                                                            class="s1">&#39;fifty&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span
                                                            class="p">(</span><span class="n">received</span><span
                                                            class="p">[</span><span
                                                            class="s1">&#39;payload&#39;</span><span class="p">][</span><span
                                                            class="s1">&#39;data&#39;</span><span
                                                            class="p">][</span><span
                                                            class="s1">&#39;value&#39;</span><span
                                                            class="p">],</span> <span class="mi">50</span><span
                                                            class="p">)</span>

        <span class="c1"># assert that is nothing to receive</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span
                                                            class="p">(</span><span class="n">client</span><span
                                                            class="o">.</span><span class="n">receive</span><span
                                                            class="p">())</span>
</pre>
                                                </div>
                                            </div>
                                            <p>There is another situation with inbound binding. It is used with <a
                                                    class="reference internal" href="index.html#multiplexing"><span>WebSocket Multiplexing</span></a>,
                                                So we apply two routes: websocket route for demultiplexer and route with
                                                internal
                                                consumer for binding itself, connect to websocket entrypoint and test
                                                different actions.
                                                For example:</p>

                                            <div class="highlight-python">
                                                <div class="highlight"><pre><span></span><span
                                                        class="k">class</span> <span
                                                        class="nc">TestIntegerValueBinding</span><span
                                                        class="p">(</span><span class="n">ChannelTestCase</span><span
                                                        class="p">):</span>

    <span class="k">def</span> <span class="nf">test_inbound_create</span><span class="p">(</span><span
                                                            class="bp">self</span><span class="p">):</span>
        <span class="c1"># check that initial state is empty</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span
                                                            class="p">(</span><span class="n">IntegerValue</span><span
                                                            class="o">.</span><span class="n">objects</span><span
                                                            class="o">.</span><span class="n">all</span><span class="p">()</span><span
                                                            class="o">.</span><span class="n">count</span><span
                                                            class="p">(),</span> <span class="mi">0</span><span
                                                            class="p">)</span>

        <span class="k">with</span> <span class="n">apply_routes</span><span class="p">([</span><span class="n">Demultiplexer</span><span
                                                            class="o">.</span><span class="n">as_route</span><span
                                                            class="p">(</span><span class="n">path</span><span
                                                            class="o">=</span><span class="s1">&#39;/&#39;</span><span
                                                            class="p">),</span>
                          <span class="n">route</span><span class="p">(</span><span class="s2">&quot;binding.intval&quot;</span><span
                                                            class="p">,</span> <span
                                                            class="n">IntegerValueBinding</span><span class="o">.</span><span
                                                            class="n">consumer</span><span class="p">)]):</span>
            <span class="n">client</span> <span class="o">=</span> <span class="n">HttpClient</span><span
                                                            class="p">()</span>
            <span class="n">client</span><span class="o">.</span><span class="n">send_and_consume</span><span class="p">(</span><span
                                                            class="s1">&#39;websocket.connect&#39;</span><span
                                                            class="p">,</span> <span class="n">path</span><span
                                                            class="o">=</span><span class="s1">&#39;/&#39;</span><span
                                                            class="p">)</span>
            <span class="n">client</span><span class="o">.</span><span class="n">send_and_consume</span><span class="p">(</span><span
                                                            class="s1">&#39;websocket.receive&#39;</span><span
                                                            class="p">,</span> <span class="n">path</span><span
                                                            class="o">=</span><span class="s1">&#39;/&#39;</span><span
                                                            class="p">,</span> <span class="n">text</span><span
                                                            class="o">=</span><span class="p">{</span>
                <span class="s1">&#39;stream&#39;</span><span class="p">:</span> <span
                                                            class="s1">&#39;intval&#39;</span><span class="p">,</span>
                <span class="s1">&#39;payload&#39;</span><span class="p">:</span> <span class="p">{</span><span
                                                            class="s1">&#39;action&#39;</span><span
                                                            class="p">:</span> <span class="n">CREATE</span><span
                                                            class="p">,</span> <span
                                                            class="s1">&#39;data&#39;</span><span
                                                            class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span
                                                            class="p">:</span> <span
                                                            class="s1">&#39;one&#39;</span><span
                                                            class="p">,</span> <span
                                                            class="s1">&#39;value&#39;</span><span
                                                            class="p">:</span> <span class="mi">1</span><span class="p">}}</span>
            <span class="p">})</span>
            <span class="c1"># our Demultiplexer route message to the inbound consumer,</span>
            <span class="c1"># so we need to call this consumer</span>
            <span class="n">client</span><span class="o">.</span><span class="n">consume</span><span
                                                            class="p">(</span><span
                                                            class="s1">&#39;binding.users&#39;</span><span
                                                            class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span
                                                            class="p">(</span><span class="n">IntegerValue</span><span
                                                            class="o">.</span><span class="n">objects</span><span
                                                            class="o">.</span><span class="n">all</span><span class="p">()</span><span
                                                            class="o">.</span><span class="n">count</span><span
                                                            class="p">(),</span> <span class="mi">1</span><span
                                                            class="p">)</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">IntegerValue</span><span
                                                            class="o">.</span><span class="n">objects</span><span
                                                            class="o">.</span><span class="n">all</span><span class="p">()</span><span
                                                            class="o">.</span><span class="n">first</span><span
                                                            class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span
                                                            class="p">(</span><span class="n">value</span><span
                                                            class="o">.</span><span class="n">name</span><span
                                                            class="p">,</span> <span
                                                            class="s1">&#39;one&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span
                                                            class="p">(</span><span class="n">value</span><span
                                                            class="o">.</span><span class="n">value</span><span
                                                            class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="section" id="multiple-channel-layers">
                                            <h4>Multiple Channel Layers<a class="headerlink"
                                                                          href="#multiple-channel-layers"
                                                                          title="Permalink to this headline">¶</a></h4>

                                            <p>If you want to test code that uses multiple channel layers, specify the
                                                alias
                                                of the layers you want to mock as the <code
                                                        class="docutils literal"><span
                                                        class="pre">test_channel_aliases</span></code> attribute on
                                                the <code class="docutils literal"><span
                                                        class="pre">ChannelTestCase</span></code> subclass; by default,
                                                only the <code class="docutils literal"><span class="pre">default</span></code>
                                                layer is
                                                mocked.</p>

                                            <p>You can pass an <code class="docutils literal"><span
                                                    class="pre">alias</span></code> argument to <code
                                                    class="docutils literal"><span
                                                    class="pre">get_next_message</span></code>, <code
                                                    class="docutils literal"><span class="pre">Client</span></code> and
                                                <code class="docutils literal"><span class="pre">Channel</span></code>
                                                to use a different layer too.</p>
                                        </div>
                                    </div>
                                    <span id="document-reference"></span>

                                    <div class="section" id="reference">
                                        <h3>Reference<a class="headerlink" href="#reference"
                                                        title="Permalink to this headline">¶</a></h3>

                                        <div class="section" id="consumers">
                                            <span id="ref-consumers"></span><h4>Consumers<a class="headerlink"
                                                                                            href="#consumers"
                                                                                            title="Permalink to this headline">¶</a>
                                        </h4>

                                            <p>When you configure channel routing, the object assigned to a channel
                                                should be a callable that takes exactly one positional argument, here
                                                called <code class="docutils literal"><span
                                                        class="pre">message</span></code>, which is a <a
                                                        class="reference internal" href="#ref-message"><span>message object</span></a>.
                                                A consumer
                                                is any callable that fits this definition.</p>

                                            <p>Consumers are not expected to return anything, and if they do, it will be
                                                ignored. They may raise <code class="docutils literal"><span
                                                        class="pre">channels.exceptions.ConsumeLater</span></code> to
                                                re-insert
                                                their current message at the back of the channel it was on, but be aware
                                                you
                                                can only do this so many time (10 by default) until the message is
                                                dropped
                                                to avoid deadlocking.</p>
                                        </div>
                                        <div class="section" id="message">
                                            <span id="ref-message"></span><h4>Message<a class="headerlink"
                                                                                        href="#message"
                                                                                        title="Permalink to this headline">¶</a>
                                        </h4>

                                            <p>Message objects are what consumers get passed as their only argument.
                                                They
                                                encapsulate the basic <a class="reference internal"
                                                                         href="index.html#document-asgi"><em>ASGI</em></a>
                                                message, which is a <code class="docutils literal"><span class="pre">dict</span></code>,
                                                with
                                                extra information. They have the following attributes:</p>
                                            <ul class="simple">
                                                <li><code class="docutils literal"><span
                                                        class="pre">content</span></code>: The actual message content,
                                                    as a dict. See the
                                                    <a class="reference internal" href="index.html#document-asgi"><em>ASGI
                                                        spec</em></a> or protocol message definition document for how
                                                    this
                                                    is structured.
                                                </li>
                                                <li><code class="docutils literal"><span
                                                        class="pre">channel</span></code>: A <a
                                                        class="reference internal"
                                                        href="#ref-channel"><span>Channel</span></a> object,
                                                    representing the channel
                                                    this message was received on. Useful if one consumer handles
                                                    multiple channels.
                                                </li>
                                                <li><code class="docutils literal"><span
                                                        class="pre">reply_channel</span></code>: A <a
                                                        class="reference internal"
                                                        href="#ref-channel"><span>Channel</span></a> object,
                                                    representing the
                                                    unique reply channel for this message, or <code
                                                            class="docutils literal"><span
                                                            class="pre">None</span></code> if there isn&#8217;t one.
                                                </li>
                                                <li><code class="docutils literal"><span
                                                        class="pre">channel_layer</span></code>: A <a
                                                        class="reference internal" href="#ref-channellayer"><span>ChannelLayer</span></a>
                                                    object,
                                                    representing the underlying channel layer this was received on. This
                                                    can be
                                                    useful in projects that have more than one layer to identify where
                                                    to send
                                                    messages the consumer generates (you can pass it to the constructor
                                                    of
                                                    <a class="reference internal"
                                                       href="#ref-channel"><span>Channel</span></a> or <a
                                                            class="reference internal"
                                                            href="#ref-group"><span>Group</span></a>)
                                                </li>
                                            </ul>
                                        </div>
                                        <div class="section" id="channel">
                                            <span id="ref-channel"></span><h4>Channel<a class="headerlink"
                                                                                        href="#channel"
                                                                                        title="Permalink to this headline">¶</a>
                                        </h4>

                                            <p>Channel objects are a simple abstraction around ASGI channels, which by
                                                default
                                                are unicode strings. The constructor looks like this:</p>

                                            <div class="highlight-python">
                                                <div class="highlight"><pre><span></span><span class="n">channels</span><span
                                                        class="o">.</span><span class="n">Channel</span><span class="p">(</span><span
                                                        class="n">name</span><span class="p">,</span> <span class="n">alias</span><span
                                                        class="o">=</span><span
                                                        class="n">DEFAULT_CHANNEL_LAYER</span><span
                                                        class="p">,</span> <span class="n">channel_layer</span><span
                                                        class="o">=</span><span class="bp">None</span><span
                                                        class="p">)</span>
</pre>
                                                </div>
                                            </div>
                                            <p>Normally, you&#8217;ll just call <code class="docutils literal"><span
                                                    class="pre">Channel(&quot;my.channel.name&quot;)</span></code> and
                                                it&#8217;ll make the
                                                right thing, but if you&#8217;re in a project with multiple channel
                                                layers set up,
                                                you can pass in either the layer alias or the layer object and it&#8217;ll
                                                send
                                                onto that one instead. They have the following attributes:</p>
                                            <ul class="simple">
                                                <li><code class="docutils literal"><span class="pre">name</span></code>:
                                                    The unicode string representing the channel name.
                                                </li>
                                                <li><code class="docutils literal"><span
                                                        class="pre">channel_layer</span></code>: A <a
                                                        class="reference internal" href="#ref-channellayer"><span>ChannelLayer</span></a>
                                                    object,
                                                    representing the underlying channel layer to send messages on.
                                                </li>
                                                <li><code class="docutils literal"><span
                                                        class="pre">send(content)</span></code>: Sends the <code
                                                        class="docutils literal"><span class="pre">dict</span></code>
                                                    provided as <em>content</em> over the channel.
                                                    The content should conform to the relevant ASGI spec or protocol
                                                    definition.
                                                </li>
                                            </ul>
                                        </div>
                                        <div class="section" id="group">
                                            <span id="ref-group"></span><h4>Group<a class="headerlink" href="#group"
                                                                                    title="Permalink to this headline">¶</a>
                                        </h4>

                                            <p>Groups represent the underlying <a class="reference internal"
                                                                                  href="index.html#document-asgi"><em>ASGI</em></a>
                                                group concept in an
                                                object-oriented way. The constructor looks like this:</p>

                                            <div class="highlight-python">
                                                <div class="highlight"><pre><span></span><span class="n">channels</span><span
                                                        class="o">.</span><span class="n">Group</span><span
                                                        class="p">(</span><span class="n">name</span><span
                                                        class="p">,</span> <span class="n">alias</span><span
                                                        class="o">=</span><span
                                                        class="n">DEFAULT_CHANNEL_LAYER</span><span
                                                        class="p">,</span> <span class="n">channel_layer</span><span
                                                        class="o">=</span><span class="bp">None</span><span
                                                        class="p">)</span>
</pre>
                                                </div>
                                            </div>
                                            <p>Like <a class="reference internal"
                                                       href="#ref-channel"><span>Channel</span></a>, you would usually
                                                just pass a <code class="docutils literal"><span class="pre">name</span></code>,
                                                but
                                                can pass a layer alias or object if you want to send on a non-default
                                                one.
                                                They have the following attributes:</p>
                                            <ul class="simple">
                                                <li><code class="docutils literal"><span class="pre">name</span></code>:
                                                    The unicode string representing the group name.
                                                </li>
                                                <li><code class="docutils literal"><span
                                                        class="pre">channel_layer</span></code>: A <a
                                                        class="reference internal" href="#ref-channellayer"><span>ChannelLayer</span></a>
                                                    object,
                                                    representing the underlying channel layer to send messages on.
                                                </li>
                                                <li><code class="docutils literal"><span
                                                        class="pre">send(content)</span></code>: Sends the <code
                                                        class="docutils literal"><span class="pre">dict</span></code>
                                                    provided as <em>content</em> to all
                                                    members of the group.
                                                </li>
                                                <li><code class="docutils literal"><span class="pre">add(channel)</span></code>:
                                                    Adds the given channel (as either a <a class="reference internal"
                                                                                           href="#ref-channel"><span>Channel</span></a>
                                                    object or a unicode string name) to the group. If the channel is
                                                    already in
                                                    the group, does nothing.
                                                </li>
                                                <li><code class="docutils literal"><span
                                                        class="pre">discard(channel)</span></code>: Removes the given
                                                    channel (as either a
                                                    <a class="reference internal"
                                                       href="#ref-channel"><span>Channel</span></a> object or a unicode
                                                    string name) from the group,
                                                    if it&#8217;s in the group. Does nothing otherwise.
                                                </li>
                                            </ul>
                                        </div>
                                        <div class="section" id="channel-layer">
                                            <span id="ref-channellayer"></span><h4>Channel Layer<a class="headerlink"
                                                                                                   href="#channel-layer"
                                                                                                   title="Permalink to this headline">¶</a>
                                        </h4>

                                            <p>These are a wrapper around the underlying <a class="reference internal"
                                                                                            href="index.html#document-asgi"><em>ASGI</em></a>
                                                channel layers
                                                that supplies a routing system that maps channels to consumers, as well
                                                as
                                                aliases to help distinguish different layers in a project with multiple
                                                layers.</p>

                                            <p>You shouldn&#8217;t make these directly; instead, get them by alias
                                                (<code class="docutils literal"><span class="pre">default</span></code>
                                                is
                                                the default alias):</p>

                                            <div class="highlight-python">
                                                <div class="highlight"><pre><span></span><span
                                                        class="kn">from</span> <span class="nn">channels</span> <span
                                                        class="kn">import</span> <span class="n">channel_layers</span>
<span class="n">layer</span> <span class="o">=</span> <span class="n">channel_layers</span><span class="p">[</span><span
                                                            class="s2">&quot;default&quot;</span><span
                                                            class="p">]</span>
</pre>
                                                </div>
                                            </div>
                                            <p>They have the following attributes:</p>
                                            <ul class="simple">
                                                <li><code class="docutils literal"><span class="pre">alias</span></code>:
                                                    The alias of this layer.
                                                </li>
                                                <li><code class="docutils literal"><span
                                                        class="pre">router</span></code>: An object which represents the
                                                    layer&#8217;s mapping of channels
                                                    to consumers. Has the following attributes:
                                                    <ul>
                                                        <li><code class="docutils literal"><span
                                                                class="pre">channels</span></code>: The set of channels
                                                            this router can handle, as unicode strings
                                                        </li>
                                                        <li><code class="docutils literal"><span class="pre">match(message)</span></code>:
                                                            Takes a <a class="reference internal"
                                                                       href="#ref-message"><span>Message</span></a> and
                                                            returns either
                                                            a (consumer, kwargs) tuple specifying the consumer to run
                                                            and the keyword
                                                            argument to pass that were extracted via routing patterns,
                                                            or None,
                                                            meaning there&#8217;s no route available.
                                                        </li>
                                                    </ul>
                                                </li>
                                            </ul>
                                        </div>
                                        <div class="section" id="asgirequest">
                                            <span id="ref-asgirequest"></span><h4>AsgiRequest<a class="headerlink"
                                                                                                href="#asgirequest"
                                                                                                title="Permalink to this headline">¶</a>
                                        </h4>

                                            <p>This is a subclass of <code class="docutils literal"><span class="pre">django.http.HttpRequest</span></code>
                                                that provides decoding from
                                                ASGI requests, and a few extra methods for ASGI-specific info. The
                                                constructor is:</p>

                                            <div class="highlight-python">
                                                <div class="highlight"><pre><span></span><span class="n">channels</span><span
                                                        class="o">.</span><span class="n">handler</span><span class="o">.</span><span
                                                        class="n">AsgiRequest</span><span class="p">(</span><span
                                                        class="n">message</span><span class="p">)</span>
</pre>
                                                </div>
                                            </div>
                                            <p><code class="docutils literal"><span class="pre">message</span></code>
                                                must be an <a class="reference internal"
                                                              href="index.html#document-asgi"><em>ASGI</em></a> <code
                                                        class="docutils literal"><span
                                                        class="pre">http.request</span></code> format message.</p>

                                            <p>Additional attributes are:</p>
                                            <ul class="simple">
                                                <li><code class="docutils literal"><span
                                                        class="pre">reply_channel</span></code>, a <a
                                                        class="reference internal"
                                                        href="#ref-channel"><span>Channel</span></a> object that
                                                    represents the
                                                    <code class="docutils literal"><span
                                                            class="pre">http.response.?</span></code> reply channel for
                                                    this request.
                                                </li>
                                                <li><code class="docutils literal"><span
                                                        class="pre">message</span></code>, the raw ASGI message passed
                                                    in the constructor.
                                                </li>
                                            </ul>
                                        </div>
                                        <div class="section" id="asgihandler">
                                            <span id="ref-asgihandler"></span><h4>AsgiHandler<a class="headerlink"
                                                                                                href="#asgihandler"
                                                                                                title="Permalink to this headline">¶</a>
                                        </h4>

                                            <p>This is a class in <code class="docutils literal"><span class="pre">channels.handler</span></code>
                                                that&#8217;s designed to handle the workflow
                                                of HTTP requests via ASGI messages. You likely don&#8217;t need to
                                                interact with it
                                                directly, but there are two useful ways you can call it:</p>
                                            <ul class="simple">
                                                <li><code class="docutils literal"><span class="pre">AsgiHandler(message)</span></code>
                                                    will process the message through the Django view
                                                    layer and yield one or more response messages to send back to the
                                                    client,
                                                    encoded from the Django <code class="docutils literal"><span
                                                            class="pre">HttpResponse</span></code>.
                                                </li>
                                                <li><code class="docutils literal"><span class="pre">encode_response(response)</span></code>
                                                    is a classmethod that can be called with a
                                                    Django <code class="docutils literal"><span
                                                            class="pre">HttpResponse</span></code> and will yield one or
                                                    more ASGI messages that are
                                                    the encoded response.
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                    <span id="document-faqs"></span>

                                    <div class="section" id="frequently-asked-questions">
                                        <h3>Frequently Asked Questions<a class="headerlink"
                                                                         href="#frequently-asked-questions"
                                                                         title="Permalink to this headline">¶</a></h3>

                                        <div class="section"
                                             id="why-are-you-doing-this-rather-than-just-using-tornado-gevent-asyncio-etc">
                                            <h4>Why are you doing this rather than just using
                                                Tornado/gevent/asyncio/etc.?<a class="headerlink"
                                                                               href="#why-are-you-doing-this-rather-than-just-using-tornado-gevent-asyncio-etc"
                                                                               title="Permalink to this headline">¶</a>
                                            </h4>

                                            <p>They&#8217;re kind of solving different problems. Tornado, gevent and
                                                other
                                                in-process async solutions are a way of making a single Python process
                                                act
                                                asynchronously - doing other things while a HTTP request is going on, or
                                                juggling hundreds of incoming connections without blocking on a single
                                                one.</p>

                                            <p>Channels is different - all the code you write for consumers runs
                                                synchronously.
                                                You can do all the blocking filesystem calls and CPU-bound tasks you
                                                like
                                                and all you&#8217;ll do is block the one worker you&#8217;re running on;
                                                the other
                                                worker processes will just keep on going and handling other
                                                messages.</p>

                                            <p>This is partially because Django is all written in a synchronous manner,
                                                and
                                                rewriting it to all be asynchronous would be a near-impossible task, but
                                                also
                                                because we believe that normal developers should not have to write
                                                asynchronous-friendly code. It&#8217;s really easy to shoot yourself in
                                                the foot;
                                                do a tight loop without yielding in the middle, or access a file that
                                                happens
                                                to be on a slow NFS share, and you&#8217;ve just blocked the entire
                                                process.</p>

                                            <p>Channels still uses asynchronous code, but it confines it to the
                                                interface
                                                layer - the processes that serve HTTP, WebSocket and other requests.
                                                These do
                                                indeed use asynchronous frameworks (currently, asyncio and Twisted) to
                                                handle
                                                managing all the concurrent connections, but they&#8217;re also fixed
                                                pieces of code;
                                                as an end developer, you&#8217;ll likely never have to touch them.</p>

                                            <p>All of your work can be with standard Python libraries and patterns and
                                                the
                                                only thing you need to look out for is worker contention - if you flood
                                                your
                                                workers with infinite loops, of course they&#8217;ll all stop working,
                                                but that&#8217;s
                                                better than a single thread of execution stopping the entire site.</p>
                                        </div>
                                        <div class="section" id="why-aren-t-you-using-node-go-etc-to-proxy-to-django">
                                            <h4>Why aren&#8217;t you using node/go/etc. to proxy to Django?<a
                                                    class="headerlink"
                                                    href="#why-aren-t-you-using-node-go-etc-to-proxy-to-django"
                                                    title="Permalink to this headline">¶</a></h4>

                                            <p>There are a couple of solutions where you can use a more &#8220;async-friendly&#8221;
                                                language (or Python framework) to bridge things like WebSockets to
                                                Django -
                                                terminate them in (say) a Node process, and then bridge it to Django
                                                using
                                                either a reverse proxy model, or Redis signalling, or some other
                                                mechanism.</p>

                                            <p>The thing is, Channels actually makes it easier to do this if you wish.
                                                The
                                                key part of Channels is introducing a standardised way to run
                                                event-triggered
                                                pieces of code, and a standardised way to route messages via named
                                                channels
                                                that hits the right balance between flexibility and simplicity.</p>

                                            <p>While our interface servers are written in Python, there&#8217;s nothing
                                                stopping
                                                you from writing an interface server in another language, providing it
                                                follows
                                                the same serialisation standards for HTTP/WebSocket/etc. messages. In
                                                fact,
                                                we may ship an alternative server implementation ourselves at some
                                                point.</p>
                                        </div>
                                        <div class="section" id="why-isn-t-there-guaranteed-delivery-a-retry-mechanism">
                                            <h4>Why isn&#8217;t there guaranteed delivery/a retry mechanism?<a
                                                    class="headerlink"
                                                    href="#why-isn-t-there-guaranteed-delivery-a-retry-mechanism"
                                                    title="Permalink to this headline">¶</a></h4>

                                            <p>Channels&#8217; design is such that anything is allowed to fail - a
                                                consumer can
                                                error and not send replies, the channel layer can restart and drop a few
                                                messages,
                                                a dogpile can happen and a few incoming clients get rejected.</p>

                                            <p>This is because designing a system that was fully guaranteed, end-to-end,
                                                would
                                                result in something with incredibly low throughput, and almost no
                                                problem needs
                                                that level of guarantee. If you want some level of guarantee, you can
                                                build on
                                                top of what Channels provides and add it in (for example, use a database
                                                to
                                                mark things that need to be cleaned up and resend messages if they aren&#8217;t
                                                after
                                                a while, or make idempotent consumers and over-send messages rather than
                                                under-send).</p>

                                            <p>That said, it&#8217;s a good way to design a system to presume any part
                                                of it can
                                                fail, and design for detection and recovery of that state, rather than
                                                hanging
                                                your entire livelihood on a system working perfectly as designed.
                                                Channels
                                                takes this idea and uses it to provide a high-throughput solution that
                                                is
                                                mostly reliable, rather than a low-throughput one that is
                                                <em>nearly</em> completely
                                                reliable.</p>
                                        </div>
                                        <div class="section"
                                             id="can-i-run-http-requests-service-calls-etc-in-parallel-from-django-without-blocking">
                                            <h4>Can I run HTTP requests/service calls/etc. in parallel from Django
                                                without blocking?<a class="headerlink"
                                                                    href="#can-i-run-http-requests-service-calls-etc-in-parallel-from-django-without-blocking"
                                                                    title="Permalink to this headline">¶</a></h4>

                                            <p>Not directly - Channels only allows a consumer function to listen to
                                                channels
                                                at the start, which is what kicks it off; you can&#8217;t send tasks off
                                                on channels
                                                to other consumers and then <em>wait on the result</em>. You can send
                                                them off and keep
                                                going, but you cannot ever block waiting on a channel in a consumer, as
                                                otherwise
                                                you&#8217;d hit deadlocks, livelocks, and similar issues.</p>

                                            <p>This is partially a design feature - this falls into the class of &#8220;difficult
                                                async concepts that it&#8217;s easy to shoot yourself in the foot with&#8221;
                                                - but also
                                                to keep the underlying channels implementation simple. By not allowing
                                                this sort
                                                of blocking, we can have specifications for channel layers that allows
                                                horizontal
                                                scaling and sharding.</p>

                                            <p>What you can do is:</p>
                                            <ul class="simple">
                                                <li>Dispatch a whole load of tasks to run later in the background and
                                                    then finish
                                                    your current task - for example, dispatching an avatar thumbnailing
                                                    task in
                                                    the avatar upload view, then returning a &#8220;we got it!&#8221;
                                                    HTTP response.
                                                </li>
                                                <li>Pass details along to the other task about how to continue, in
                                                    particular
                                                    a channel name linked to another consumer that will finish the job,
                                                    or
                                                    IDs or other details of the data (remember, message contents are
                                                    just a dict
                                                    you can put stuff into). For example, you might have a generic image
                                                    fetching
                                                    task for a variety of models that should fetch an image, store it,
                                                    and pass
                                                    the resultant ID and the ID of the object you&#8217;re attaching it
                                                    to onto a different
                                                    channel depending on the model - you&#8217;d pass the next channel
                                                    name and the
                                                    ID of the target object in the message, and then the consumer could
                                                    send
                                                    a new message onto that channel name when it&#8217;s done.
                                                </li>
                                                <li>Have interface servers that perform requests or slow tasks
                                                    (remember, interface
                                                    servers are the specialist code which <em>is</em> written to be
                                                    highly asynchronous)
                                                    and then send their results onto a channel when finished. Again, you
                                                    can&#8217;t wait
                                                    around inside a consumer and block on the results, but you can
                                                    provide another
                                                    consumer on a new channel that will do the second half.
                                                </li>
                                            </ul>
                                        </div>
                                        <div class="section" id="how-do-i-associate-data-with-incoming-connections">
                                            <h4>How do I associate data with incoming connections?<a class="headerlink"
                                                                                                     href="#how-do-i-associate-data-with-incoming-connections"
                                                                                                     title="Permalink to this headline">¶</a>
                                            </h4>

                                            <p>Channels provides full integration with Django&#8217;s session and auth
                                                system for its
                                                WebSockets support, as well as per-websocket sessions for persisting
                                                data, so
                                                you can easily persist data on a per-connection or per-user basis.</p>

                                            <p>You can also provide your own solution if you wish, keyed off of <code
                                                    class="docutils literal"><span
                                                    class="pre">message.reply_channel</span></code>,
                                                which is the unique channel representing the connection, but remember
                                                that
                                                whatever you store in must be <strong>network-transparent</strong> -
                                                storing things in a
                                                global variable won&#8217;t work outside of development.</p>
                                        </div>
                                        <div class="section"
                                             id="how-do-i-talk-to-channels-from-my-non-django-application">
                                            <h4>How do I talk to Channels from my non-Django application?<a
                                                    class="headerlink"
                                                    href="#how-do-i-talk-to-channels-from-my-non-django-application"
                                                    title="Permalink to this headline">¶</a></h4>

                                            <p>If you have an external server or script you want to talk to Channels,
                                                you have
                                                a few choices:</p>
                                            <ul class="simple">
                                                <li>If it&#8217;s a Python program, and you&#8217;ve made an <code
                                                        class="docutils literal"><span class="pre">asgi.py</span></code>
                                                    file for your project
                                                    (see <a class="reference internal"
                                                            href="index.html#document-deploying"><em>Deploying</em></a>),
                                                    you can import the channel layer directly as
                                                    <code class="docutils literal"><span class="pre">yourproject.asgi.channel_layer</span></code>
                                                    and call <code class="docutils literal"><span
                                                            class="pre">send()</span></code> and <code
                                                            class="docutils literal"><span
                                                            class="pre">receive_many()</span></code>
                                                    on it directly. See the <a class="reference internal"
                                                                               href="index.html#document-asgi"><em>ASGI
                                                        spec</em></a> for the API the channel layer
                                                    presents.
                                                </li>
                                                <li>If you just need to send messages in when events happen, you can
                                                    make a
                                                    management command that calls <code class="docutils literal"><span
                                                            class="pre">Channel(&quot;namehere&quot;).send({...})</span></code>
                                                    so your external program can just call
                                                    <code class="docutils literal"><span class="pre">manage.py</span>
                                                        <span class="pre">send_custom_event</span></code> (or similar)
                                                    to send a message. Remember, you
                                                    can send onto channels from any code in your project.
                                                </li>
                                                <li>If neither of these work, you&#8217;ll have to communicate with
                                                    Django over
                                                    HTTP, WebSocket, or another protocol that your project talks, as
                                                    normal.
                                                </li>
                                            </ul>
                                        </div>
                                        <div class="section" id="are-channels-python-2-3-or-2-3">
                                            <h4>Are channels Python 2, 3 or 2+3?<a class="headerlink"
                                                                                   href="#are-channels-python-2-3-or-2-3"
                                                                                   title="Permalink to this headline">¶</a>
                                            </h4>

                                            <p>Django-channels and all of its dependencies are compatible with Python
                                                2.7,
                                                3.3, and higher. This includes the parts of Twisted that some of the
                                                Channels
                                                packages (like daphne) use.</p>
                                        </div>
                                        <div class="section"
                                             id="why-isn-t-there-support-for-socket-io-sockjs-long-poll-fallback">
                                            <h4>Why isn&#8217;t there support for socket.io/SockJS/long poll fallback?<a
                                                    class="headerlink"
                                                    href="#why-isn-t-there-support-for-socket-io-sockjs-long-poll-fallback"
                                                    title="Permalink to this headline">¶</a></h4>

                                            <p>Emulating WebSocket over HTTP long polling requires considerably more
                                                effort
                                                than terminating WebSockets; some server-side state of the connection
                                                must
                                                be kept in a place that&#8217;s accessible from all nodes, so when the
                                                new long
                                                poll comes in, messages can be replayed onto it.</p>

                                            <p>For this reason, we think it&#8217;s out of scope for Channels itself,
                                                though
                                                Channels and Daphne come with first-class support for long-running HTTP
                                                connections without taking up a worker thread (you can consume <code
                                                        class="docutils literal"><span
                                                        class="pre">http.request</span></code>
                                                and not send a response until later, add the reply channel to groups,
                                                and even listen out for the <code class="docutils literal"><span
                                                        class="pre">http.disconnect</span></code> channel that tells you
                                                when
                                                long polls terminate early).</p>
                                        </div>
                                    </div>
                                    <span id="document-asgi"></span>

                                    <div class="section" id="asgi-asynchronous-server-gateway-interface-draft-spec">
                                        <h3>ASGI (Asynchronous Server Gateway Interface) Draft Spec<a class="headerlink"
                                                                                                      href="#asgi-asynchronous-server-gateway-interface-draft-spec"
                                                                                                      title="Permalink to this headline">¶</a>
                                        </h3>

                                        <p><strong>NOTE: This is still in-progress, and may change substantially as
                                            development
                                            progresses.</strong></p>

                                        <div class="section" id="abstract">
                                            <h4>Abstract<a class="headerlink" href="#abstract"
                                                           title="Permalink to this headline">¶</a></h4>

                                            <p>This document proposes a standard interface between network protocol
                                                servers (particularly webservers) and Python applications, intended
                                                to allow handling of multiple common protocol styles (including HTTP,
                                                HTTP2,
                                                and WebSocket).</p>

                                            <p>It is intended to supplement and expand on WSGI, though the design
                                                deliberately includes provisions to allow WSGI-to-ASGI and ASGI-to-WGSI
                                                adapters to be easily written for the HTTP protocol.</p>
                                        </div>
                                        <div class="section" id="rationale">
                                            <h4>Rationale<a class="headerlink" href="#rationale"
                                                            title="Permalink to this headline">¶</a></h4>

                                            <p>The WSGI specification has worked well since it was introduced, and
                                                allowed for great flexibility in Python framework and webserver choice.
                                                However, its design is irrevocably tied to the HTTP-style
                                                request/response cycle, and more and more protocols are becoming a
                                                standard part of web programming that do not follow this pattern
                                                (most notably, WebSocket).</p>

                                            <p>ASGI attempts to preserve a simple application interface, but provide
                                                an abstraction that allows for data to be sent and received at any time,
                                                and from different application threads or processes.</p>

                                            <p>It also lays out new, serialization-compatible formats for things like
                                                HTTP requests and responses and WebSocket data frames, to allow these to
                                                be transported over a network or local memory, and allow separation
                                                of protocol handling and application logic into different processes.</p>

                                            <p>Part of this design is ensuring there is an easy path to use both
                                                existing WSGI servers and applications, as a large majority of Python
                                                web usage relies on WSGI and providing an easy path forwards is critical
                                                to adoption.</p>
                                        </div>
                                        <div class="section" id="overview">
                                            <h4>Overview<a class="headerlink" href="#overview"
                                                           title="Permalink to this headline">¶</a></h4>

                                            <p>ASGI consists of three different components - <em>protocol servers</em>,
                                                a <em>channel layer</em>, and <em>application code</em>. Channel layers
                                                are the core
                                                part of the implementation, and provide an interface to both protocol
                                                servers and applications.</p>

                                            <p>A channel layer provides a protocol server or an application server
                                                with a <code class="docutils literal"><span
                                                        class="pre">send</span></code> callable, which takes a channel
                                                name and message
                                                <code class="docutils literal"><span class="pre">dict</span></code>, and
                                                a <code class="docutils literal"><span class="pre">receive</span></code>
                                                callable, which takes a list of
                                                channel names and returns the next message available on any named
                                                channel.</p>

                                            <p>Thus, rather than under WSGI, where you point the protocol server to the
                                                application, under ASGI you point both the protocol server and the
                                                application
                                                to a channel layer instance. It is intended that applications and
                                                protocol
                                                servers always run in separate processes or threads, and always
                                                communicate
                                                via the channel layer.</p>

                                            <p>Despite the name of the proposal, ASGI does not specify or design to any
                                                specific in-process async solution, such as <code
                                                        class="docutils literal"><span class="pre">asyncio</span></code>,
                                                <code class="docutils literal"><span class="pre">twisted</span></code>,
                                                or
                                                <code class="docutils literal"><span class="pre">gevent</span></code>.
                                                Instead, the <code class="docutils literal"><span
                                                        class="pre">receive</span></code> function can be switched
                                                between
                                                nonblocking or synchronous. This approach allows applications to choose
                                                what&#8217;s
                                                best for their current runtime environment; further improvements may
                                                provide
                                                extensions where cooperative versions of receive are provided.</p>

                                            <p>The distinction between protocol servers and applications in this
                                                document
                                                is mostly to distinguish their roles and to make illustrating concepts
                                                easier.
                                                There is no code-level distinction between the two, and it&#8217;s
                                                entirely possible
                                                to have a process that does both, or middleware-like code that
                                                transforms
                                                messages between two different channel layers or channel names. It is
                                                expected, however, that most deployments will fall into this
                                                pattern.</p>

                                            <p>There is even room for a WSGI-like application abstraction with a
                                                callable
                                                which takes <code class="docutils literal"><span
                                                        class="pre">(channel,</span> <span class="pre">message,</span>
                                                    <span class="pre">send_func)</span></code>, but this would be
                                                slightly
                                                too restrictive for many use cases and does not cover how to specify
                                                channel names to listen on; it is expected that frameworks will cover
                                                this
                                                use case.</p>

                                            <div class="section" id="channels-and-messages">
                                                <h5>Channels and Messages<a class="headerlink"
                                                                            href="#channels-and-messages"
                                                                            title="Permalink to this headline">¶</a>
                                                </h5>

                                                <p>All communication in an ASGI stack uses <em>messages</em> sent over
                                                    <em>channels</em>.
                                                    All messages must be a <code class="docutils literal"><span
                                                            class="pre">dict</span></code> at the top level of the
                                                    object, and
                                                    contain only the following types to ensure serializability:</p>
                                                <ul class="simple">
                                                    <li>Byte strings</li>
                                                    <li>Unicode strings</li>
                                                    <li>Integers (no longs)</li>
                                                    <li>Lists (tuples should be treated as lists)</li>
                                                    <li>Dicts (keys must be unicode strings)</li>
                                                    <li>Booleans</li>
                                                    <li>None</li>
                                                </ul>
                                                <p>Channels are identified by a unicode string name consisting only of
                                                    ASCII
                                                    letters, ASCII numerical digits, periods (<code
                                                            class="docutils literal"><span class="pre">.</span></code>),
                                                    dashes (<code class="docutils literal"><span
                                                            class="pre">-</span></code>) and
                                                    underscores (<code class="docutils literal"><span
                                                            class="pre">_</span></code>), plus an optional type
                                                    character (see below).</p>

                                                <p>Channels are a first-in, first out queue with at-most-once delivery
                                                    semantics. They can have multiple writers and multiple readers; only
                                                    a single
                                                    reader should get each written message. Implementations must never
                                                    deliver
                                                    a message more than once or to more than one reader, and must drop
                                                    messages if
                                                    this is necessary to achieve this restriction.</p>

                                                <p>In order to aid with scaling and network architecture, a distinction
                                                    is made between channels that have multiple readers (such as the
                                                    <code class="docutils literal"><span class="pre">http.request</span></code>
                                                    channel that web applications would listen on from every
                                                    application worker process), <em>single-reader channels</em> that
                                                    are read from a
                                                    single unknown location (such as <code
                                                            class="docutils literal"><span class="pre">http.request.body?ABCDEF</span></code>),
                                                    and
                                                    <em>process-specific channels</em> (such as a <code
                                                            class="docutils literal"><span class="pre">http.response!ABCDEF</span></code>
                                                    channel
                                                    tied to a client socket).</p>

                                                <p><em>Normal channel</em> names contain no type characters, and can be
                                                    routed however
                                                    the backend wishes; in particular, they do not have to appear
                                                    globally
                                                    consistent, and backends may shard their contents out to different
                                                    servers
                                                    so that a querying client only sees some portion of the messages.
                                                    Calling
                                                    <code class="docutils literal"><span
                                                            class="pre">receive</span></code> on these channels does not
                                                    guarantee that you will get the
                                                    messages in order or that you will get anything if the channel is
                                                    non-empty.</p>

                                                <p><em>Single-reader channel</em> names contain a question mark
                                                    (<code class="docutils literal"><span class="pre">?</span></code>)
                                                    character in order to indicate to the channel layer that it must
                                                    make
                                                    these channels appear globally consistent. The <code
                                                            class="docutils literal"><span class="pre">?</span></code>
                                                    is always preceded by
                                                    the main channel name (e.g. <code class="docutils literal"><span
                                                            class="pre">http.response.body</span></code>) and followed
                                                    by a
                                                    random portion. Channel layers may use the random portion to help
                                                    pin the
                                                    channel to a server, but reads from this channel by a single process
                                                    must
                                                    always be in-order and return messages if the channel is non-empty.
                                                    These names
                                                    must be generated by the <code class="docutils literal"><span
                                                            class="pre">new_channel</span></code> call.</p>

                                                <p><em>Process-specific channel</em> names contain an exclamation mark
                                                    (<code class="docutils literal"><span class="pre">!</span></code>)
                                                    character in order to indicate to the channel layer that it may
                                                    have to route the data for these channels differently to ensure it
                                                    reaches the
                                                    single process that needs it; these channels are nearly always tied
                                                    to
                                                    incoming connections from the outside world. The <code
                                                            class="docutils literal"><span class="pre">!</span></code>
                                                    is always preceded by
                                                    the main channel name (e.g. <code class="docutils literal"><span
                                                            class="pre">http.response</span></code>) and followed by the
                                                    per-client/random portion - channel layers can split on the <code
                                                            class="docutils literal"><span class="pre">!</span></code>
                                                    and use just
                                                    the right hand part to route if they desire, or can ignore it if
                                                    they don&#8217;t
                                                    need to use different routing rules. Even if the right hand side
                                                    contains
                                                    client routing information, it must still contain random parts too
                                                    so that
                                                    each call to <code class="docutils literal"><span class="pre">new_channel</span></code>
                                                    returns a new, unused name. These names
                                                    must be generated by the <code class="docutils literal"><span
                                                            class="pre">new_channel</span></code> call; they are
                                                    guaranteed to only
                                                    be read from the same process that calls <code
                                                            class="docutils literal"><span
                                                            class="pre">new_channel</span></code>.</p>

                                                <p>Messages should expire after a set time sitting unread in a channel;
                                                    the recommendation is one minute, though the best value depends on
                                                    the
                                                    channel layer and the way it is deployed.</p>

                                                <p>The maximum message size is 1MB if the message were encoded as JSON;
                                                    if more data than this needs to be transmitted it must be chunked or
                                                    placed
                                                    onto its own single-reader or process-specific channel (see how HTTP
                                                    request
                                                    bodies are done, for example). All channel layers must support
                                                    messages up
                                                    to this size, but protocol specifications are encouraged to keep
                                                    well below it.</p>
                                            </div>
                                            <div class="section" id="handling-protocols">
                                                <h5>Handling Protocols<a class="headerlink" href="#handling-protocols"
                                                                         title="Permalink to this headline">¶</a></h5>

                                                <p>ASGI messages represent two main things - internal application events
                                                    (for example, a channel might be used to queue thumbnails of
                                                    previously
                                                    uploaded videos), and protocol events to/from connected clients.</p>

                                                <p>As such, this specification outlines encodings to and from ASGI
                                                    messages
                                                    for HTTP and WebSocket; this allows any ASGI
                                                    web server to talk to any ASGI web application, as well as servers
                                                    and
                                                    applications for any other protocol with a common specification. It
                                                    is
                                                    recommended that if other protocols become commonplace they should
                                                    gain
                                                    standardized formats in a supplementary specification of their
                                                    own.</p>

                                                <p>The message formats are a key part of the specification; without
                                                    them,
                                                    the protocol server and web application might be able to talk to
                                                    each other,
                                                    but may not understand some of what the other is saying. It&#8217;s
                                                    equivalent to the
                                                    standard keys in the <code class="docutils literal"><span
                                                            class="pre">environ</span></code> dict for WSGI.</p>

                                                <p>The design pattern is that most protocols will share a few channels
                                                    for
                                                    incoming data (for example, <code class="docutils literal"><span
                                                            class="pre">http.request</span></code>, <code
                                                            class="docutils literal"><span
                                                            class="pre">websocket.connect</span></code> and
                                                    <code class="docutils literal"><span
                                                            class="pre">websocket.receive</span></code>), but will have
                                                    individual channels for sending to
                                                    each client (such as <code class="docutils literal"><span
                                                            class="pre">http.response!kj2daj23</span></code>). This
                                                    allows incoming
                                                    data to be dispatched into a cluster of application servers that can
                                                    all
                                                    handle it, while responses are routed to the individual protocol
                                                    server
                                                    that has the other end of the client&#8217;s socket.</p>

                                                <p>Some protocols, however, do not have the concept of a unique socket
                                                    connection; for example, an SMS gateway protocol server might just
                                                    have
                                                    <code class="docutils literal"><span class="pre">sms.receive</span></code>
                                                    and <code class="docutils literal"><span class="pre">sms.send</span></code>,
                                                    and the protocol server cluster would
                                                    take messages from <code class="docutils literal"><span class="pre">sms.send</span></code>
                                                    and route them into the normal phone
                                                    network based on attributes in the message (in this case, a
                                                    telephone
                                                    number).</p>
                                            </div>
                                            <div class="section" id="extensions">
                                                <h5>Extensions<a class="headerlink" href="#extensions"
                                                                 title="Permalink to this headline">¶</a></h5>

                                                <p>Extensions are functionality that is
                                                    not required for basic application code and nearly all protocol
                                                    server
                                                    code, and so has been made optional in order to enable lightweight
                                                    channel layers for applications that don&#8217;t need the full
                                                    feature set defined
                                                    here.</p>

                                                <p>The extensions defined here are:</p>
                                                <ul class="simple">
                                                    <li><code class="docutils literal"><span
                                                            class="pre">groups</span></code>: Allows grouping of
                                                        channels to allow broadcast; see below for more.
                                                    </li>
                                                    <li><code class="docutils literal"><span
                                                            class="pre">flush</span></code>: Allows easier testing and
                                                        development with channel layers.
                                                    </li>
                                                    <li><code class="docutils literal"><span
                                                            class="pre">statistics</span></code>: Allows channel layers
                                                        to provide global and per-channel statistics.
                                                    </li>
                                                    <li><code class="docutils literal"><span class="pre">twisted</span></code>:
                                                        Async compatibility with the Twisted framework.
                                                    </li>
                                                    <li><code class="docutils literal"><span class="pre">asyncio</span></code>:
                                                        Async compatibility with Python 3&#8217;s asyncio.
                                                    </li>
                                                </ul>
                                                <p>There is potential to add further extensions; these may be defined by
                                                    a separate specification, or a new version of this
                                                    specification.</p>

                                                <p>If application code requires an extension, it should check for it as
                                                    soon
                                                    as possible, and hard error if it is not provided. Frameworks should
                                                    encourage optional use of extensions, while attempting to move any
                                                    extension-not-found errors to process startup rather than message
                                                    handling.</p>
                                            </div>
                                            <div class="section" id="groups">
                                                <h5>Groups<a class="headerlink" href="#groups"
                                                             title="Permalink to this headline">¶</a></h5>

                                                <p>While the basic channel model is sufficient to handle basic
                                                    application
                                                    needs, many more advanced uses of asynchronous messaging require
                                                    notifying many users at once when an event occurs - imagine a live
                                                    blog,
                                                    for example, where every viewer should get a long poll response or
                                                    WebSocket packet when a new entry is posted.</p>

                                                <p>This concept could be kept external to the ASGI spec, and would be,
                                                    if it
                                                    were not for the significant performance gains a channel layer
                                                    implementation
                                                    could make on the send-group operation by having it included - the
                                                    alternative being a <code class="docutils literal"><span
                                                            class="pre">send_many</span></code> callable that might have
                                                    to take
                                                    tens of thousands of destination channel names in a single call.
                                                    However,
                                                    the group feature is still optional; its presence is indicated by
                                                    the
                                                    <code class="docutils literal"><span
                                                            class="pre">supports_groups</span></code> attribute on the
                                                    channel layer object.</p>

                                                <p>Thus, there is a simple Group concept in ASGI, which acts as the
                                                    broadcast/multicast mechanism across channels. Channels are added to
                                                    a group,
                                                    and then messages sent to that group are sent to all members of the
                                                    group.
                                                    Channels can be removed from a group manually (e.g. based on a
                                                    disconnect
                                                    event), and the channel layer will garbage collect &#8220;old&#8221;
                                                    channels in groups
                                                    on a periodic basis.</p>

                                                <p>How this garbage collection happens is not specified here, as it
                                                    depends on
                                                    the internal implementation of the channel layer. The recommended
                                                    approach,
                                                    however, is when a message on a process-specific channel expires,
                                                    the channel
                                                    layer should remove that channel from all groups it&#8217;s
                                                    currently a member of;
                                                    this is deemed an acceptable indication that the channel&#8217;s
                                                    listener is gone.</p>

                                                <p><em>Implementation of the group functionality is optional</em>. If it
                                                    is not provided
                                                    and an application or protocol server requires it, they should hard
                                                    error
                                                    and exit with an appropriate error message. It is expected that
                                                    protocol
                                                    servers will not need to use groups.</p>
                                            </div>
                                            <div class="section" id="linearization">
                                                <h5>Linearization<a class="headerlink" href="#linearization"
                                                                    title="Permalink to this headline">¶</a></h5>

                                                <p>The design of ASGI is meant to enable a shared-nothing architecture,
                                                    where messages can be handled by any one of a set of threads,
                                                    processes
                                                    or machines running application code.</p>

                                                <p>This, of course, means that several different copies of the
                                                    application
                                                    could be handling messages simultaneously, and those messages could
                                                    even
                                                    be from the same client; in the worst case, two packets from a
                                                    client
                                                    could even be processed out-of-order if one server is slower than
                                                    another.</p>

                                                <p>This is an existing issue with things like WSGI as well - a user
                                                    could
                                                    open two different tabs to the same site at once and launch
                                                    simultaneous
                                                    requests to different servers - but the nature of the new protocols
                                                    specified here mean that collisions are more likely to occur.</p>

                                                <p>Solving this issue is left to frameworks and application code; there
                                                    are
                                                    already solutions such as database transactions that help solve
                                                    this,
                                                    and the vast majority of application code will not need to deal with
                                                    this
                                                    problem. If ordering of incoming packets matters for a protocol,
                                                    they should
                                                    be annotated with a packet number (as WebSocket is in this
                                                    specification).</p>

                                                <p>Single-reader and process-specific channels, such as those used for
                                                    response
                                                    channels back to clients, are not subject to this problem; a single
                                                    reader
                                                    on these must always receive messages in channel order.</p>
                                            </div>
                                            <div class="section" id="capacity">
                                                <h5>Capacity<a class="headerlink" href="#capacity"
                                                               title="Permalink to this headline">¶</a></h5>

                                                <p>To provide backpressure, each channel in a channel layer may have a
                                                    capacity,
                                                    defined however the layer wishes (it is recommended that it is
                                                    configurable
                                                    by the user using keyword arguments to the channel layer
                                                    constructor, and
                                                    furthermore configurable per channel name or name prefix).</p>

                                                <p>When a channel is at or over capacity, trying to send() to that
                                                    channel
                                                    may raise ChannelFull, which indicates to the sender the channel is
                                                    over
                                                    capacity. How the sender wishes to deal with this will depend on
                                                    context;
                                                    for example, a web application trying to send a response body will
                                                    likely
                                                    wait until it empties out again, while a HTTP interface server
                                                    trying to
                                                    send in a request would drop the request and return a 503 error.</p>

                                                <p>Sending to a group never raises ChannelFull; instead, it must
                                                    silently drop
                                                    the message if it is over capacity, as per ASGI&#8217;s at-most-once
                                                    delivery
                                                    policy.</p>
                                            </div>
                                        </div>
                                        <div class="section" id="specification-details">
                                            <h4>Specification Details<a class="headerlink" href="#specification-details"
                                                                        title="Permalink to this headline">¶</a></h4>

                                            <p>A <em>channel layer</em> must provide an object with these attributes
                                                (all function arguments are positional):</p>
                                            <ul class="simple">
                                                <li><code class="docutils literal"><span
                                                        class="pre">send(channel,</span> <span
                                                        class="pre">message)</span></code>, a callable that takes two
                                                    arguments: the
                                                    channel to send on, as a unicode string, and the message
                                                    to send, as a serializable <code class="docutils literal"><span
                                                            class="pre">dict</span></code>.
                                                </li>
                                                <li><code class="docutils literal"><span
                                                        class="pre">receive(channels,</span> <span class="pre">block=False)</span></code>,
                                                    a callable that takes a list of channel
                                                    names as unicode strings, and returns with either <code
                                                            class="docutils literal"><span class="pre">(None,</span>
                                                        <span class="pre">None)</span></code>
                                                    or <code class="docutils literal"><span class="pre">(channel,</span>
                                                        <span class="pre">message)</span></code> if a message is
                                                    available. If <code class="docutils literal"><span
                                                            class="pre">block</span></code> is True, then
                                                    it will not return until after a built-in timeout or a message
                                                    arrives; if
                                                    <code class="docutils literal"><span class="pre">block</span></code>
                                                    is false, it will always return immediately. It is perfectly
                                                    valid to ignore <code class="docutils literal"><span class="pre">block</span></code>
                                                    and always return immediately, or after a delay;
                                                    <code class="docutils literal"><span class="pre">block</span></code>
                                                    means that the call can take as long as it likes before returning
                                                    a message or nothing, not that it must block until it gets one.
                                                </li>
                                                <li><code class="docutils literal"><span class="pre">new_channel(pattern)</span></code>,
                                                    a callable that takes a unicode string pattern,
                                                    and returns a new valid channel name that does not already exist, by
                                                    adding a unicode string after the <code
                                                            class="docutils literal"><span class="pre">!</span></code>
                                                    or <code class="docutils literal"><span class="pre">?</span></code>
                                                    character in <code class="docutils literal"><span class="pre">pattern</span></code>,
                                                    and checking for existence of that name in the channel layer. The
                                                    <code class="docutils literal"><span
                                                            class="pre">pattern</span></code>
                                                    MUST end with <code class="docutils literal"><span
                                                            class="pre">!</span></code> or <code
                                                            class="docutils literal"><span class="pre">?</span></code>
                                                    or this function must error. If the character
                                                    is <code class="docutils literal"><span class="pre">!</span></code>,
                                                    making it a process-specific channel, <code
                                                            class="docutils literal"><span
                                                            class="pre">new_channel</span></code> must be
                                                    called on the same channel layer that intends to read the channel
                                                    with
                                                    <code class="docutils literal"><span
                                                            class="pre">receive</span></code>; any other channel layer
                                                    instance may not receive
                                                    messages on this channel due to client-routing portions of the
                                                    appended string.
                                                </li>
                                                <li><code class="docutils literal"><span
                                                        class="pre">MessageTooLarge</span></code>, the exception raised
                                                    when a send operation fails
                                                    because the encoded message is over the layer&#8217;s size limit.
                                                </li>
                                                <li><code class="docutils literal"><span class="pre">ChannelFull</span></code>,
                                                    the exception raised when a send operation fails
                                                    because the destination channel is over capacity.
                                                </li>
                                                <li><code class="docutils literal"><span
                                                        class="pre">extensions</span></code>, a list of unicode string
                                                    names indicating which
                                                    extensions this layer provides, or empty if it supports none.
                                                    The names defined in this document are <code
                                                            class="docutils literal"><span
                                                            class="pre">groups</span></code>, <code
                                                            class="docutils literal"><span
                                                            class="pre">flush</span></code> and
                                                    <code class="docutils literal"><span
                                                            class="pre">statistics</span></code>.
                                                </li>
                                            </ul>
                                            <p>A channel layer implementing the <code class="docutils literal"><span
                                                    class="pre">groups</span></code> extension must also provide:</p>
                                            <ul class="simple">
                                                <li><code class="docutils literal"><span
                                                        class="pre">group_add(group,</span> <span
                                                        class="pre">channel)</span></code>, a callable that takes a
                                                    <code class="docutils literal"><span
                                                            class="pre">channel</span></code> and adds
                                                    it to the group given by <code class="docutils literal"><span
                                                            class="pre">group</span></code>. Both are unicode strings.
                                                    If the channel
                                                    is already in the group, the function should return normally.
                                                </li>
                                                <li><code class="docutils literal"><span class="pre">group_discard(group,</span>
                                                    <span class="pre">channel)</span></code>, a callable that removes
                                                    the <code class="docutils literal"><span class="pre">channel</span></code>
                                                    from the <code class="docutils literal"><span
                                                            class="pre">group</span></code> if it is in it, and does
                                                    nothing otherwise.
                                                </li>
                                                <li><code class="docutils literal"><span class="pre">group_channels(group)</span></code>,
                                                    a callable that returns an iterable which yields
                                                    all of the group&#8217;s member channel names. The return value
                                                    should be serializable
                                                    with regards to local adds and discards, but best-effort with
                                                    regards to
                                                    adds and discards on other nodes.
                                                </li>
                                                <li><code class="docutils literal"><span
                                                        class="pre">send_group(group,</span> <span
                                                        class="pre">message)</span></code>, a callable that takes two
                                                    positional
                                                    arguments; the group to send to, as a unicode string, and the
                                                    message
                                                    to send, as a serializable <code class="docutils literal"><span
                                                            class="pre">dict</span></code>. It may raise MessageTooLarge
                                                    but cannot
                                                    raise ChannelFull.
                                                </li>
                                                <li><code class="docutils literal"><span class="pre">group_expiry</span></code>,
                                                    an integer number of seconds that specifies how long group
                                                    membership is valid for after the most recent <code
                                                            class="docutils literal"><span class="pre">group_add</span></code>
                                                    call (see
                                                    <em>Persistence</em> below)
                                                </li>
                                            </ul>
                                            <p>A channel layer implementing the <code class="docutils literal"><span
                                                    class="pre">statistics</span></code> extension must also provide:
                                            </p>
                                            <ul class="simple">
                                                <li><code class="docutils literal"><span
                                                        class="pre">global_statistics()</span></code>, a callable that
                                                    returns statistics across all channels
                                                </li>
                                                <li><code class="docutils literal"><span class="pre">channel_statistics(channel)</span></code>,
                                                    a callable that returns statistics for specified channel
                                                </li>
                                                <li>in both cases statistics are a dict with zero or more of (unicode
                                                    string keys):
                                                    <ul>
                                                        <li><code class="docutils literal"><span class="pre">messages_count</span></code>,
                                                            the number of messages processed since server start
                                                        </li>
                                                        <li><code class="docutils literal"><span class="pre">messages_count_per_second</span></code>,
                                                            the number of messages processed in the last second
                                                        </li>
                                                        <li><code class="docutils literal"><span class="pre">messages_pending</span></code>,
                                                            the current number of messages waiting
                                                        </li>
                                                        <li><code class="docutils literal"><span class="pre">messages_max_age</span></code>,
                                                            how long the oldest message has been waiting, in seconds
                                                        </li>
                                                        <li><code class="docutils literal"><span class="pre">channel_full_count</span></code>,
                                                            the number of times <cite>ChannelFull</cite> exception has
                                                            been risen since server start
                                                        </li>
                                                        <li><code class="docutils literal"><span class="pre">channel_full_count_per_second</span></code>,
                                                            the number of times <cite>ChannelFull</cite> exception has
                                                            been risen in the last second
                                                        </li>
                                                    </ul>
                                                </li>
                                                <li>Implementation may provide total counts, counts per seconds or
                                                    both.
                                                </li>
                                            </ul>
                                            <p>A channel layer implementing the <code class="docutils literal"><span
                                                    class="pre">flush</span></code> extension must also provide:</p>
                                            <ul class="simple">
                                                <li><code class="docutils literal"><span
                                                        class="pre">flush()</span></code>, a callable that resets the
                                                    channel layer to a blank state,
                                                    containing no messages and no groups (if the groups extension is
                                                    implemented). This call must block until the system is cleared and
                                                    will
                                                    consistently look empty to any client, if the channel layer is
                                                    distributed.
                                                </li>
                                            </ul>
                                            <p>A channel layer implementing the <code class="docutils literal"><span
                                                    class="pre">twisted</span></code> extension must also provide:</p>
                                            <ul class="simple">
                                                <li><code class="docutils literal"><span class="pre">receive_twisted(channels)</span></code>,
                                                    a function that behaves
                                                    like <code class="docutils literal"><span class="pre">receive</span></code>
                                                    but that returns a Twisted Deferred that eventually
                                                    returns either <code class="docutils literal"><span class="pre">(channel,</span>
                                                        <span class="pre">message)</span></code> or <code
                                                            class="docutils literal"><span class="pre">(None,</span>
                                                        <span class="pre">None)</span></code>. It is not possible
                                                    to run it in nonblocking mode; use the normal <code
                                                            class="docutils literal"><span
                                                            class="pre">receive</span></code> for that.
                                                </li>
                                            </ul>
                                            <p>A channel layer implementing the <code class="docutils literal"><span
                                                    class="pre">asyncio</span></code> extension must also provide:</p>
                                            <ul class="simple">
                                                <li><code class="docutils literal"><span class="pre">receive_asyncio(channels)</span></code>,
                                                    a function that behaves
                                                    like <code class="docutils literal"><span class="pre">receive</span></code>
                                                    but that fulfills the asyncio coroutine contract to
                                                    block until either a result is available or an internal timeout is
                                                    reached
                                                    and <code class="docutils literal"><span class="pre">(None,</span>
                                                        <span class="pre">None)</span></code> is returned.
                                                </li>
                                            </ul>
                                            <div class="section" id="channel-semantics">
                                                <h5>Channel Semantics<a class="headerlink" href="#channel-semantics"
                                                                        title="Permalink to this headline">¶</a></h5>

                                                <p>Channels <strong>must</strong>:</p>
                                                <ul class="simple">
                                                    <li>Preserve ordering of messages perfectly with only a single
                                                        reader
                                                        and writer if the channel is a <em>single-reader</em> or <em>process-specific</em>
                                                        channel.
                                                    </li>
                                                    <li>Never deliver a message more than once.</li>
                                                    <li>Never block on message send (though they may raise ChannelFull
                                                        or
                                                        MessageTooLarge)
                                                    </li>
                                                    <li>Be able to handle messages of at least 1MB in size when encoded
                                                        as
                                                        JSON (the implementation may use better encoding or compression,
                                                        as long
                                                        as it meets the equivalent size)
                                                    </li>
                                                    <li>Have a maximum name length of at least 100 bytes.</li>
                                                </ul>
                                                <p>They should attempt to preserve ordering in all cases as much as
                                                    possible,
                                                    but perfect global ordering is obviously not possible in the
                                                    distributed case.</p>

                                                <p>They are not expected to deliver all messages, but a success rate of
                                                    at least
                                                    99.99% is expected under normal circumstances. Implementations may
                                                    want to
                                                    have a &#8220;resilience testing&#8221; mode where they deliberately
                                                    drop more messages
                                                    than usual so developers can test their code&#8217;s handling of
                                                    these scenarios.</p>
                                            </div>
                                            <div class="section" id="persistence">
                                                <h5>Persistence<a class="headerlink" href="#persistence"
                                                                  title="Permalink to this headline">¶</a></h5>

                                                <p>Channel layers do not need to persist data long-term; group
                                                    memberships only need to live as long as a connection does, and
                                                    messages
                                                    only as long as the message expiry time, which is usually a couple
                                                    of minutes.</p>

                                                <p>That said, if a channel server goes down momentarily and loses all
                                                    data,
                                                    persistent socket connections will continue to transfer incoming
                                                    data and
                                                    send out new generated data, but will have lost all of their group
                                                    memberships
                                                    and in-flight messages.</p>

                                                <p>In order to avoid a nasty set of bugs caused by these half-deleted
                                                    sockets,
                                                    protocol servers should quit and hard restart if they detect that
                                                    the channel
                                                    layer has gone down or lost data; shedding all existing connections
                                                    and letting
                                                    clients reconnect will immediately resolve the problem.</p>

                                                <p>If a channel layer implements the <code
                                                        class="docutils literal"><span class="pre">groups</span></code>
                                                    extension, it must persist group
                                                    membership until at least the time when the member channel has a
                                                    message
                                                    expire due to non-consumption, after which it may drop membership at
                                                    any time.
                                                    If a channel subsequently has a successful delivery, the channel
                                                    layer must
                                                    then not drop group membership until another message expires on that
                                                    channel.</p>

                                                <p>Channel layers must also drop group membership after a configurable
                                                    long timeout
                                                    after the most recent <code class="docutils literal"><span
                                                            class="pre">group_add</span></code> call for that
                                                    membership, the default being
                                                    86,400 seconds (one day). The value of this timeout is exposed as
                                                    the
                                                    <code class="docutils literal"><span class="pre">group_expiry</span></code>
                                                    property on the channel layer.</p>

                                                <p>Protocol servers must have a configurable timeout value for every
                                                    connection-based
                                                    protocol they serve that closes the connection after the timeout,
                                                    and should
                                                    default this value to the value of <code
                                                            class="docutils literal"><span
                                                            class="pre">group_expiry</span></code>, if the channel
                                                    layer provides it. This allows old group memberships to be cleaned
                                                    up safely,
                                                    knowing that after the group expiry the original connection must
                                                    have closed,
                                                    or is about to be in the next few seconds.</p>

                                                <p>It&#8217;s recommended that end developers put the timeout setting
                                                    much lower - on
                                                    the order of hours or minutes - to enable better protocol design and
                                                    testing.
                                                    Even with ASGI&#8217;s separation of protocol server restart from
                                                    business logic
                                                    restart, you will likely need to move and reprovision protocol
                                                    servers, and
                                                    making sure your code can cope with this is important.</p>
                                            </div>
                                            <div class="section" id="message-formats">
                                                <h5>Message Formats<a class="headerlink" href="#message-formats"
                                                                      title="Permalink to this headline">¶</a></h5>

                                                <p>These describe the standardized message formats for the protocols
                                                    this
                                                    specification supports. All messages are <code
                                                            class="docutils literal"><span
                                                            class="pre">dicts</span></code> at the top level,
                                                    and all keys are required unless otherwise specified (with a default
                                                    to
                                                    use if the key is missing). Keys are unicode strings.</p>

                                                <p>The one common key across all protocols is <code
                                                        class="docutils literal"><span class="pre">reply_channel</span></code>,
                                                    a way to indicate
                                                    the client-specific channel to send responses to. Protocols are
                                                    generally
                                                    encouraged to have one message type and one reply channel type to
                                                    ensure ordering.</p>

                                                <p>A <code class="docutils literal"><span
                                                        class="pre">reply_channel</span></code> should be unique per
                                                    connection. If the protocol in question
                                                    can have any server service a response - e.g. a theoretical SMS
                                                    protocol - it
                                                    should not have <code class="docutils literal"><span class="pre">reply_channel</span></code>
                                                    attributes on messages, but instead a separate
                                                    top-level outgoing channel.</p>

                                                <p>Messages are specified here along with the channel names they are
                                                    expected
                                                    on; if a channel name can vary, such as with reply channels, the
                                                    varying
                                                    portion will be represented by <code class="docutils literal"><span
                                                            class="pre">!</span></code>, such as <code
                                                            class="docutils literal"><span
                                                            class="pre">http.response!</span></code>, which matches
                                                    the format the <code class="docutils literal"><span class="pre">new_channel</span></code>
                                                    callable takes.</p>

                                                <p>There is no label on message types to say what they are; their type
                                                    is implicit
                                                    in the channel name they are received on. Two types that are sent on
                                                    the same
                                                    channel, such as HTTP responses and response chunks, are
                                                    distinguished apart
                                                    by their required fields.</p>
                                            </div>
                                            <div class="section" id="http">
                                                <h5>HTTP<a class="headerlink" href="#http"
                                                           title="Permalink to this headline">¶</a></h5>

                                                <p>The HTTP format covers HTTP/1.0, HTTP/1.1 and HTTP/2, as the changes
                                                    in
                                                    HTTP/2 are largely on the transport level. A protocol server should
                                                    give
                                                    different requests on the same connection different reply channels,
                                                    and
                                                    correctly multiplex the responses back into the same stream as they
                                                    come in.
                                                    The HTTP version is available as a string in the request
                                                    message.</p>

                                                <p>HTTP/2 Server Push responses are included, but must be sent prior to
                                                    the
                                                    main response, and applications must check for <code
                                                            class="docutils literal"><span
                                                            class="pre">http_version</span> <span class="pre">=</span>
                                                        <span class="pre">2</span></code> before
                                                    sending them; if a protocol server or connection incapable of Server
                                                    Push
                                                    receives these, it must drop them.</p>

                                                <p>Multiple header fields with the same name are complex in HTTP. RFC
                                                    7230
                                                    states that for any header field that can appear multiple times, it
                                                    is exactly
                                                    equivalent to sending that header field only once with all the
                                                    values joined by
                                                    commas.</p>

                                                <p>However, RFC 7230 and RFC 6265 make it clear that this rule does not
                                                    apply to
                                                    the various headers used by HTTP cookies (<code
                                                            class="docutils literal"><span
                                                            class="pre">Cookie</span></code> and <code
                                                            class="docutils literal"><span class="pre">Set-Cookie</span></code>).
                                                    The
                                                    <code class="docutils literal"><span
                                                            class="pre">Cookie</span></code> header must only be sent
                                                    once by a user-agent, but the
                                                    <code class="docutils literal"><span
                                                            class="pre">Set-Cookie</span></code> header may appear
                                                    repeatedly and cannot be joined by commas.
                                                    For this reason, we can safely make the request <code
                                                            class="docutils literal"><span
                                                            class="pre">headers</span></code> a <code
                                                            class="docutils literal"><span
                                                            class="pre">dict</span></code>, but
                                                    the response <code class="docutils literal"><span class="pre">headers</span></code>
                                                    must be sent as a list of tuples, which matches WSGI.</p>

                                                <div class="section" id="request">
                                                    <h6>Request<a class="headerlink" href="#request"
                                                                  title="Permalink to this headline">¶</a></h6>

                                                    <p>Sent once for each request that comes into the protocol server.
                                                        If sending
                                                        this raises <code class="docutils literal"><span class="pre">ChannelFull</span></code>,
                                                        the interface server must respond with a
                                                        500-range error, preferably <code class="docutils literal"><span
                                                                class="pre">503</span> <span class="pre">Service</span>
                                                            <span class="pre">Unavailable</span></code>, and close the
                                                        connection.</p>

                                                    <p>Channel: <code class="docutils literal"><span class="pre">http.request</span></code>
                                                    </p>

                                                    <p>Keys:</p>
                                                    <ul class="simple">
                                                        <li><code class="docutils literal"><span class="pre">reply_channel</span></code>:
                                                            Channel name for responses and server pushes, starting with
                                                            <code class="docutils literal"><span class="pre">http.response!</span></code>
                                                        </li>
                                                        <li><code class="docutils literal"><span class="pre">http_version</span></code>:
                                                            Unicode string, one of <code class="docutils literal"><span
                                                                    class="pre">1.0</span></code>, <code
                                                                    class="docutils literal"><span
                                                                    class="pre">1.1</span></code> or <code
                                                                    class="docutils literal"><span class="pre">2</span></code>.
                                                        </li>
                                                        <li><code class="docutils literal"><span
                                                                class="pre">method</span></code>: Unicode string HTTP
                                                            method name, uppercased.
                                                        </li>
                                                        <li><code class="docutils literal"><span
                                                                class="pre">scheme</span></code>: Unicode string URL
                                                            scheme portion (likely <code class="docutils literal"><span
                                                                    class="pre">http</span></code> or <code
                                                                    class="docutils literal"><span
                                                                    class="pre">https</span></code>).
                                                            Optional (but must not be empty), default is <code
                                                                    class="docutils literal"><span class="pre">&quot;http&quot;</span></code>.
                                                        </li>
                                                        <li><code class="docutils literal"><span class="pre">path</span></code>:
                                                            Unicode string HTTP path from URL, with percent escapes
                                                            decoded
                                                            and UTF8 byte sequences decoded into characters.
                                                        </li>
                                                        <li><code class="docutils literal"><span class="pre">query_string</span></code>:
                                                            Byte string URL portion after the <code
                                                                    class="docutils literal"><span class="pre">?</span></code>,
                                                            not url-decoded.
                                                        </li>
                                                        <li><code class="docutils literal"><span
                                                                class="pre">root_path</span></code>: Unicode string that
                                                            indicates the root path this application
                                                            is mounted at; same as <code class="docutils literal"><span
                                                                    class="pre">SCRIPT_NAME</span></code> in WSGI.
                                                            Optional, defaults
                                                            to <code class="docutils literal"><span class="pre">&quot;&quot;</span></code>.
                                                        </li>
                                                        <li><code class="docutils literal"><span
                                                                class="pre">headers</span></code>: A list of <code
                                                                class="docutils literal"><span class="pre">[name,</span>
                                                            <span class="pre">value]</span></code> pairs, where <code
                                                                class="docutils literal"><span
                                                                class="pre">name</span></code> is the
                                                            byte string header name, and <code class="docutils literal"><span
                                                                    class="pre">value</span></code> is the byte string
                                                            header value. Order should be preserved from the original
                                                            HTTP request;
                                                            duplicates are possible and must be preserved in the message
                                                            as received.
                                                            Header names must be lowercased.
                                                        </li>
                                                        <li><code class="docutils literal"><span class="pre">body</span></code>:
                                                            Body of the request, as a byte string. Optional, defaults to
                                                            <code class="docutils literal"><span class="pre">&quot;&quot;</span></code>.
                                                            If <code class="docutils literal"><span class="pre">body_channel</span></code>
                                                            is set, treat as start of body and concatenate
                                                            on further chunks.
                                                        </li>
                                                        <li><code class="docutils literal"><span class="pre">body_channel</span></code>:
                                                            Name of a single-reader channel (containing <code
                                                                    class="docutils literal"><span class="pre">?</span></code>)
                                                            that contains
                                                            Request Body Chunk messages representing a large request
                                                            body.
                                                            Optional, defaults to <code class="docutils literal"><span
                                                                    class="pre">None</span></code>. Chunks append to
                                                            <code class="docutils literal"><span class="pre">body</span></code>
                                                            if set. Presence of
                                                            a channel indicates at least one Request Body Chunk message
                                                            needs to be read,
                                                            and then further consumption keyed off of the <code
                                                                    class="docutils literal"><span class="pre">more_content</span></code>
                                                            key in those
                                                            messages.
                                                        </li>
                                                        <li><code class="docutils literal"><span
                                                                class="pre">client</span></code>: List of <code
                                                                class="docutils literal"><span class="pre">[host,</span>
                                                            <span class="pre">port]</span></code> where <code
                                                                class="docutils literal"><span
                                                                class="pre">host</span></code> is a unicode string of
                                                            the
                                                            remote host&#8217;s IPv4 or IPv6 address, and <code
                                                                    class="docutils literal"><span
                                                                    class="pre">port</span></code> is the remote port as
                                                            an
                                                            integer. Optional, defaults to <code
                                                                    class="docutils literal"><span
                                                                    class="pre">None</span></code>.
                                                        </li>
                                                        <li><code class="docutils literal"><span
                                                                class="pre">server</span></code>: List of <code
                                                                class="docutils literal"><span class="pre">[host,</span>
                                                            <span class="pre">port]</span></code> where <code
                                                                class="docutils literal"><span
                                                                class="pre">host</span></code> is the listening address
                                                            for this server as a unicode string, and <code
                                                                    class="docutils literal"><span
                                                                    class="pre">port</span></code> is the integer
                                                            listening port.
                                                            Optional, defaults to <code class="docutils literal"><span
                                                                    class="pre">None</span></code>.
                                                        </li>
                                                    </ul>
                                                </div>
                                                <div class="section" id="request-body-chunk">
                                                    <h6>Request Body Chunk<a class="headerlink"
                                                                             href="#request-body-chunk"
                                                                             title="Permalink to this headline">¶</a>
                                                    </h6>

                                                    <p>Must be sent after an initial Response. If trying to send this
                                                        raises
                                                        <code class="docutils literal"><span
                                                                class="pre">ChannelFull</span></code>, the interface
                                                        server should wait and try again until it is
                                                        accepted (the consumer at the other end of the channel may not
                                                        be as fast
                                                        consuming the data as the client is at sending it).</p>

                                                    <p>Channel: <code class="docutils literal"><span class="pre">http.request.body?</span></code>
                                                    </p>

                                                    <p>Keys:</p>
                                                    <ul class="simple">
                                                        <li><code class="docutils literal"><span
                                                                class="pre">content</span></code>: Byte string of HTTP
                                                            body content, will be concatenated onto
                                                            previously received <code class="docutils literal"><span
                                                                    class="pre">content</span></code> values and <code
                                                                    class="docutils literal"><span
                                                                    class="pre">body</span></code> key in Request.
                                                            Not required if <code class="docutils literal"><span
                                                                    class="pre">closed</span></code> is True, required
                                                            otherwise.
                                                        </li>
                                                        <li><code class="docutils literal"><span
                                                                class="pre">closed</span></code>: True if the client
                                                            closed the connection prematurely and the
                                                            rest of the body. If you receive this, abandon processing of
                                                            the HTTP request.
                                                            Optional, defaults to <code class="docutils literal"><span
                                                                    class="pre">False</span></code>.
                                                        </li>
                                                        <li><code class="docutils literal"><span class="pre">more_content</span></code>:
                                                            Boolean value signifying if there is additional content
                                                            to come (as part of a Request Body Chunk message). If <code
                                                                    class="docutils literal"><span
                                                                    class="pre">False</span></code>, request will
                                                            be taken as complete, and any further messages on the
                                                            channel
                                                            will be ignored. Optional, defaults to <code
                                                                    class="docutils literal"><span
                                                                    class="pre">False</span></code>.
                                                        </li>
                                                    </ul>
                                                </div>
                                                <div class="section" id="response">
                                                    <h6>Response<a class="headerlink" href="#response"
                                                                   title="Permalink to this headline">¶</a></h6>

                                                    <p>Send after any server pushes, and before any response chunks. If
                                                        <code class="docutils literal"><span
                                                                class="pre">ChannelFull</span></code>
                                                        is encountered, wait and try again later, optionally giving up
                                                        after a
                                                        predetermined timeout.</p>

                                                    <p>Channel: <code class="docutils literal"><span class="pre">http.response!</span></code>
                                                    </p>

                                                    <p>Keys:</p>
                                                    <ul class="simple">
                                                        <li><code class="docutils literal"><span
                                                                class="pre">status</span></code>: Integer HTTP status
                                                            code.
                                                        </li>
                                                        <li><code class="docutils literal"><span
                                                                class="pre">headers</span></code>: A list of <code
                                                                class="docutils literal"><span class="pre">[name,</span>
                                                            <span class="pre">value]</span></code> pairs, where <code
                                                                class="docutils literal"><span
                                                                class="pre">name</span></code> is the
                                                            byte string header name, and <code class="docutils literal"><span
                                                                    class="pre">value</span></code> is the byte string
                                                            header value. Order should be preserved in the HTTP
                                                            response. Header names
                                                            must be lowercased.
                                                        </li>
                                                        <li><code class="docutils literal"><span
                                                                class="pre">content</span></code>: Byte string of HTTP
                                                            body content.
                                                            Optional, defaults to empty string.
                                                        </li>
                                                        <li><code class="docutils literal"><span class="pre">more_content</span></code>:
                                                            Boolean value signifying if there is additional content
                                                            to come (as part of a Response Chunk message). If <code
                                                                    class="docutils literal"><span
                                                                    class="pre">False</span></code>, response will
                                                            be taken as complete and closed off, and any further
                                                            messages on the channel
                                                            will be ignored. Optional, defaults to <code
                                                                    class="docutils literal"><span
                                                                    class="pre">False</span></code>.
                                                        </li>
                                                    </ul>
                                                </div>
                                                <div class="section" id="response-chunk">
                                                    <h6>Response Chunk<a class="headerlink" href="#response-chunk"
                                                                         title="Permalink to this headline">¶</a></h6>

                                                    <p>Must be sent after an initial Response. If <code
                                                            class="docutils literal"><span
                                                            class="pre">ChannelFull</span></code>
                                                        is encountered, wait and try again later.</p>

                                                    <p>Channel: <code class="docutils literal"><span class="pre">http.response!</span></code>
                                                    </p>

                                                    <p>Keys:</p>
                                                    <ul class="simple">
                                                        <li><code class="docutils literal"><span
                                                                class="pre">content</span></code>: Byte string of HTTP
                                                            body content, will be concatenated onto
                                                            previously received <code class="docutils literal"><span
                                                                    class="pre">content</span></code> values.
                                                        </li>
                                                        <li><code class="docutils literal"><span class="pre">more_content</span></code>:
                                                            Boolean value signifying if there is additional content
                                                            to come (as part of a Response Chunk message). If <code
                                                                    class="docutils literal"><span
                                                                    class="pre">False</span></code>, response will
                                                            be taken as complete and closed off, and any further
                                                            messages on the channel
                                                            will be ignored. Optional, defaults to <code
                                                                    class="docutils literal"><span
                                                                    class="pre">False</span></code>.
                                                        </li>
                                                    </ul>
                                                </div>
                                                <div class="section" id="server-push">
                                                    <h6>Server Push<a class="headerlink" href="#server-push"
                                                                      title="Permalink to this headline">¶</a></h6>

                                                    <p>Must be sent before any Response or Response Chunk messages. If
                                                        <code class="docutils literal"><span
                                                                class="pre">ChannelFull</span></code>
                                                        is encountered, wait and try again later, optionally giving up
                                                        after a
                                                        predetermined timeout, and give up on the entire response this
                                                        push is
                                                        connected to.</p>

                                                    <p>When a server receives this message, it must treat the Request
                                                        message in the
                                                        <code class="docutils literal"><span class="pre">request</span></code>
                                                        field of the Server Push as though it were a new HTTP request
                                                        being
                                                        received from the network. A server may, if it chooses, apply
                                                        all of its
                                                        internal logic to handling this request (e.g. the server may
                                                        want to try to
                                                        satisfy the request from a cache). Regardless, if the server is
                                                        unable to
                                                        satisfy the request itself it must create a new <code
                                                                class="docutils literal"><span class="pre">http.response!</span></code>
                                                        channel for
                                                        the application to send the Response message on, fill that
                                                        channel in on the
                                                        <code class="docutils literal"><span
                                                                class="pre">reply_channel</span></code> field of the
                                                        message, and then send the Request back to the
                                                        application on the <code class="docutils literal"><span
                                                                class="pre">http.request</span></code> channel.</p>

                                                    <p>This approach limits the amount of knowledge the application has
                                                        to have about
                                                        pushed responses: they essentially appear to the application
                                                        like a normal HTTP
                                                        request, with the difference being that the application itself
                                                        triggered the
                                                        request.</p>

                                                    <p>If the remote peer does not support server push, either because
                                                        it&#8217;s not a
                                                        HTTP/2 peer or because SETTINGS_ENABLE_PUSH is set to 0, the
                                                        server must do
                                                        nothing in response to this message.</p>

                                                    <p>Channel: <code class="docutils literal"><span class="pre">http.response!</span></code>
                                                    </p>

                                                    <p>Keys:</p>
                                                    <ul class="simple">
                                                        <li><code class="docutils literal"><span
                                                                class="pre">request</span></code>: A Request message.
                                                            The <code class="docutils literal"><span
                                                                    class="pre">body</span></code>, <code
                                                                    class="docutils literal"><span class="pre">body_channel</span></code>,
                                                            and
                                                            <code class="docutils literal"><span class="pre">reply_channel</span></code>
                                                            fields MUST be absent: bodies are not allowed on
                                                            server-pushed requests, and applications should not create
                                                            reply channels.
                                                        </li>
                                                    </ul>
                                                </div>
                                                <div class="section" id="disconnect">
                                                    <h6>Disconnect<a class="headerlink" href="#disconnect"
                                                                     title="Permalink to this headline">¶</a></h6>

                                                    <p>Sent when a HTTP connection is closed. This is mainly useful for
                                                        long-polling,
                                                        where you may have added the response channel to a Group or
                                                        other set of
                                                        channels you want to trigger a reply to when data arrives.</p>

                                                    <p>If <code class="docutils literal"><span
                                                            class="pre">ChannelFull</span></code> is raised, then give
                                                        up attempting to send the message;
                                                        consumption is not required.</p>

                                                    <p>Channel: <code class="docutils literal"><span class="pre">http.disconnect</span></code>
                                                    </p>

                                                    <p>Keys:</p>
                                                    <ul class="simple">
                                                        <li><code class="docutils literal"><span class="pre">reply_channel</span></code>:
                                                            Channel name responses would have been sent on. No longer
                                                            valid after this message is sent; all messages to it will be
                                                            dropped.
                                                        </li>
                                                        <li><code class="docutils literal"><span class="pre">path</span></code>:
                                                            Unicode string HTTP path from URL, with percent escapes
                                                            decoded
                                                            and UTF8 byte sequences decoded into characters.
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                            <div class="section" id="websocket">
                                                <h5>WebSocket<a class="headerlink" href="#websocket"
                                                                title="Permalink to this headline">¶</a></h5>

                                                <p>WebSockets share some HTTP details - they have a path and headers -
                                                    but also
                                                    have more state. Path and header details are only sent in the
                                                    connection
                                                    message; applications that need to refer to these during later
                                                    messages
                                                    should store them in a cache or database.</p>

                                                <p>WebSocket protocol servers should handle PING/PONG requests
                                                    themselves, and
                                                    send PING frames as necessary to ensure the connection is alive.</p>

                                                <p>Note that you <strong>must</strong> ensure that websocket.connect is
                                                    consumed; if an
                                                    interface server gets <code class="docutils literal"><span
                                                            class="pre">ChannelFull</span></code> on this channel it
                                                    will drop the
                                                    connection. Django Channels ships with a no-op consumer attached by
                                                    default;
                                                    we recommend other implementations do the same.</p>

                                                <div class="section" id="connection">
                                                    <h6>Connection<a class="headerlink" href="#connection"
                                                                     title="Permalink to this headline">¶</a></h6>

                                                    <p>Sent when the client initially opens a connection and completes
                                                        the
                                                        WebSocket handshake. If sending this raises <code
                                                                class="docutils literal"><span
                                                                class="pre">ChannelFull</span></code>, the interface
                                                        server must close the connection with either HTTP status code
                                                        <code class="docutils literal"><span
                                                                class="pre">503</span></code> or
                                                        WebSocket close code <code class="docutils literal"><span
                                                                class="pre">1013</span></code>.</p>

                                                    <p>This message must be responded to on the <code
                                                            class="docutils literal"><span
                                                            class="pre">reply_channel</span></code> with a
                                                        <em>Send/Close/Accept</em> message before the socket will pass
                                                        messages on the
                                                        <code class="docutils literal"><span class="pre">receive</span></code>
                                                        channel. The protocol server should ideally send this message
                                                        during the handshake phase of the WebSocket and not complete the
                                                        handshake
                                                        until it gets a reply, returning HTTP status code <code
                                                                class="docutils literal"><span
                                                                class="pre">403</span></code> if the connection is
                                                        denied. If this is not possible, it must buffer WebSocket frames
                                                        and not
                                                        send them onto <code class="docutils literal"><span class="pre">websocket.receive</span></code>
                                                        until a reply is received, and if the
                                                        connection is rejected, return WebSocket close code <code
                                                                class="docutils literal"><span
                                                                class="pre">4403</span></code>.</p>

                                                    <p>Channel: <code class="docutils literal"><span class="pre">websocket.connect</span></code>
                                                    </p>

                                                    <p>Keys:</p>
                                                    <ul class="simple">
                                                        <li><code class="docutils literal"><span class="pre">reply_channel</span></code>:
                                                            Channel name for sending data, start with <code
                                                                    class="docutils literal"><span class="pre">websocket.send!</span></code>
                                                        </li>
                                                        <li><code class="docutils literal"><span
                                                                class="pre">scheme</span></code>: Unicode string URL
                                                            scheme portion (likely <code class="docutils literal"><span
                                                                    class="pre">ws</span></code> or <code
                                                                    class="docutils literal"><span
                                                                    class="pre">wss</span></code>).
                                                            Optional (but must not be empty), default is <code
                                                                    class="docutils literal"><span class="pre">ws</span></code>.
                                                        </li>
                                                        <li><code class="docutils literal"><span class="pre">path</span></code>:
                                                            Unicode HTTP path from URL, already urldecoded.
                                                        </li>
                                                        <li><code class="docutils literal"><span class="pre">query_string</span></code>:
                                                            Byte string URL portion after the <code
                                                                    class="docutils literal"><span class="pre">?</span></code>.
                                                            Optional, default
                                                            is empty string.
                                                        </li>
                                                        <li><code class="docutils literal"><span
                                                                class="pre">root_path</span></code>: Byte string that
                                                            indicates the root path this application
                                                            is mounted at; same as <code class="docutils literal"><span
                                                                    class="pre">SCRIPT_NAME</span></code> in WSGI.
                                                            Optional, defaults
                                                            to empty string.
                                                        </li>
                                                        <li><code class="docutils literal"><span
                                                                class="pre">headers</span></code>: List of <code
                                                                class="docutils literal"><span class="pre">[name,</span>
                                                            <span class="pre">value]</span></code>, where <code
                                                                class="docutils literal"><span
                                                                class="pre">name</span></code> is the
                                                            header name as byte string and <code
                                                                    class="docutils literal"><span
                                                                    class="pre">value</span></code> is the header value
                                                            as a byte
                                                            string. Order should be preserved from the original HTTP
                                                            request;
                                                            duplicates are possible and must be preserved in the message
                                                            as received.
                                                            Header names must be lowercased.
                                                        </li>
                                                        <li><code class="docutils literal"><span
                                                                class="pre">client</span></code>: List of <code
                                                                class="docutils literal"><span class="pre">[host,</span>
                                                            <span class="pre">port]</span></code> where <code
                                                                class="docutils literal"><span
                                                                class="pre">host</span></code> is a unicode string of
                                                            the
                                                            remote host&#8217;s IPv4 or IPv6 address, and <code
                                                                    class="docutils literal"><span
                                                                    class="pre">port</span></code> is the remote port as
                                                            an
                                                            integer. Optional, defaults to <code
                                                                    class="docutils literal"><span
                                                                    class="pre">None</span></code>.
                                                        </li>
                                                        <li><code class="docutils literal"><span
                                                                class="pre">server</span></code>: List of <code
                                                                class="docutils literal"><span class="pre">[host,</span>
                                                            <span class="pre">port]</span></code> where <code
                                                                class="docutils literal"><span
                                                                class="pre">host</span></code> is the listening address
                                                            for this server as a unicode string, and <code
                                                                    class="docutils literal"><span
                                                                    class="pre">port</span></code> is the integer
                                                            listening port.
                                                            Optional, defaults to <code class="docutils literal"><span
                                                                    class="pre">None</span></code>.
                                                        </li>
                                                        <li><code class="docutils literal"><span
                                                                class="pre">order</span></code>: The integer value <code
                                                                class="docutils literal"><span
                                                                class="pre">0</span></code>.
                                                        </li>
                                                    </ul>
                                                </div>
                                                <div class="section" id="receive">
                                                    <h6>Receive<a class="headerlink" href="#receive"
                                                                  title="Permalink to this headline">¶</a></h6>

                                                    <p>Sent when a data frame is received from the client. If <code
                                                            class="docutils literal"><span
                                                            class="pre">ChannelFull</span></code> is
                                                        raised, you may retry sending it but if it does not send the
                                                        socket must
                                                        be closed with websocket error code 1013.</p>

                                                    <p>Channel: <code class="docutils literal"><span class="pre">websocket.receive</span></code>
                                                    </p>

                                                    <p>Keys:</p>
                                                    <ul class="simple">
                                                        <li><code class="docutils literal"><span class="pre">reply_channel</span></code>:
                                                            Channel name for sending data, starting with <code
                                                                    class="docutils literal"><span class="pre">websocket.send!</span></code>
                                                        </li>
                                                        <li><code class="docutils literal"><span class="pre">path</span></code>:
                                                            Path sent during <code class="docutils literal"><span
                                                                    class="pre">connect</span></code>, sent to make
                                                            routing easier for apps.
                                                        </li>
                                                        <li><code class="docutils literal"><span
                                                                class="pre">bytes</span></code>: Byte string of frame
                                                            content, if it was bytes mode, or <code
                                                                    class="docutils literal"><span
                                                                    class="pre">None</span></code>.
                                                        </li>
                                                        <li><code class="docutils literal"><span class="pre">text</span></code>:
                                                            Unicode string of frame content, if it was text mode, or
                                                            <code class="docutils literal"><span class="pre">None</span></code>.
                                                        </li>
                                                        <li><code class="docutils literal"><span
                                                                class="pre">order</span></code>: Order of this frame in
                                                            the WebSocket stream, starting
                                                            at 1 (<code class="docutils literal"><span class="pre">connect</span></code>
                                                            is 0).
                                                        </li>
                                                    </ul>
                                                    <p>One of <code class="docutils literal"><span
                                                            class="pre">bytes</span></code> or <code
                                                            class="docutils literal"><span
                                                            class="pre">text</span></code> must be non-<code
                                                            class="docutils literal"><span
                                                            class="pre">None</span></code>.</p>
                                                </div>
                                                <div class="section" id="disconnection">
                                                    <h6>Disconnection<a class="headerlink" href="#disconnection"
                                                                        title="Permalink to this headline">¶</a></h6>

                                                    <p>Sent when either connection to the client is lost, either from
                                                        the client
                                                        closing the connection, the server closing the connection, or
                                                        loss of the
                                                        socket.</p>

                                                    <p>If <code class="docutils literal"><span
                                                            class="pre">ChannelFull</span></code> is raised, then give
                                                        up attempting to send the message;
                                                        consumption is not required.</p>

                                                    <p>Channel: <code class="docutils literal"><span class="pre">websocket.disconnect</span></code>
                                                    </p>

                                                    <p>Keys:</p>
                                                    <ul class="simple">
                                                        <li><code class="docutils literal"><span class="pre">reply_channel</span></code>:
                                                            Channel name that was used for sending data, starting
                                                            with <code class="docutils literal"><span class="pre">websocket.send!</span></code>.
                                                            Cannot be used to send at this point; provided
                                                            as a way to identify the connection only.
                                                        </li>
                                                        <li><code class="docutils literal"><span class="pre">code</span></code>:
                                                            The WebSocket close code (integer), as per the WebSocket
                                                            spec.
                                                        </li>
                                                        <li><code class="docutils literal"><span class="pre">path</span></code>:
                                                            Path sent during <code class="docutils literal"><span
                                                                    class="pre">connect</span></code>, sent to make
                                                            routing easier for apps.
                                                        </li>
                                                        <li><code class="docutils literal"><span
                                                                class="pre">order</span></code>: Order of the
                                                            disconnection relative to the incoming frames&#8217;
                                                            <code class="docutils literal"><span
                                                                    class="pre">order</span></code> values in <code
                                                                    class="docutils literal"><span class="pre">websocket.receive</span></code>.
                                                        </li>
                                                    </ul>
                                                </div>
                                                <div class="section" id="send-close-accept">
                                                    <h6>Send/Close/Accept<a class="headerlink" href="#send-close-accept"
                                                                            title="Permalink to this headline">¶</a>
                                                    </h6>

                                                    <p>Sends a data frame to the client and/or closes the connection
                                                        from the
                                                        server end and/or accepts a connection. If <code
                                                                class="docutils literal"><span
                                                                class="pre">ChannelFull</span></code> is raised, wait
                                                        and try again.</p>

                                                    <p>If received while the connection is waiting for acceptance after
                                                        a <code class="docutils literal"><span
                                                                class="pre">connect</span></code>
                                                        message:</p>
                                                    <ul class="simple">
                                                        <li>If <code class="docutils literal"><span
                                                                class="pre">bytes</span></code> or <code
                                                                class="docutils literal"><span
                                                                class="pre">text</span></code> is present, accept the
                                                            connection and send the data.
                                                        </li>
                                                        <li>If <code class="docutils literal"><span
                                                                class="pre">accept</span></code> is <code
                                                                class="docutils literal"><span
                                                                class="pre">True</span></code>, accept the connection
                                                            and do nothing else.
                                                        </li>
                                                        <li>If <code class="docutils literal"><span
                                                                class="pre">close</span></code> is <code
                                                                class="docutils literal"><span
                                                                class="pre">True</span></code> or a positive integer,
                                                            reject the connection. If
                                                            <code class="docutils literal"><span
                                                                    class="pre">bytes</span></code> or <code
                                                                    class="docutils literal"><span
                                                                    class="pre">text</span></code> is also set, it
                                                            should accept the connection, send the
                                                            frame, then immediately close the connection.
                                                        </li>
                                                    </ul>
                                                    <p>If received while the connection is established:</p>
                                                    <ul class="simple">
                                                        <li>If <code class="docutils literal"><span
                                                                class="pre">bytes</span></code> or <code
                                                                class="docutils literal"><span
                                                                class="pre">text</span></code> is present, send the
                                                            data.
                                                        </li>
                                                        <li>If <code class="docutils literal"><span
                                                                class="pre">close</span></code> is <code
                                                                class="docutils literal"><span
                                                                class="pre">True</span></code> or a positive integer,
                                                            close the connection after
                                                            any send.
                                                        </li>
                                                        <li><code class="docutils literal"><span
                                                                class="pre">accept</span></code> is ignored.
                                                        </li>
                                                    </ul>
                                                    <p>Channel: <code class="docutils literal"><span class="pre">websocket.send!</span></code>
                                                    </p>

                                                    <p>Keys:</p>
                                                    <ul class="simple">
                                                        <li><code class="docutils literal"><span
                                                                class="pre">bytes</span></code>: Byte string of frame
                                                            content, if in bytes mode, or <code
                                                                    class="docutils literal"><span
                                                                    class="pre">None</span></code>.
                                                        </li>
                                                        <li><code class="docutils literal"><span class="pre">text</span></code>:
                                                            Unicode string of frame content, if in text mode, or <code
                                                                    class="docutils literal"><span
                                                                    class="pre">None</span></code>.
                                                        </li>
                                                        <li><code class="docutils literal"><span
                                                                class="pre">close</span></code>: Boolean indicating if
                                                            the connection should be closed after
                                                            data is sent, if any. Alternatively, a positive integer
                                                            specifying the
                                                            response code. The response code will be 1000 if you pass
                                                            <code class="docutils literal"><span class="pre">True</span></code>.
                                                            Optional, default <code class="docutils literal"><span
                                                                    class="pre">False</span></code>.
                                                        </li>
                                                        <li><code class="docutils literal"><span
                                                                class="pre">accept</span></code>: Boolean saying if the
                                                            connection should be accepted without
                                                            sending a frame if it is in the handshake phase.
                                                        </li>
                                                    </ul>
                                                    <p>A maximum of one of <code class="docutils literal"><span
                                                            class="pre">bytes</span></code> or <code
                                                            class="docutils literal"><span
                                                            class="pre">text</span></code> may be provided. If both are
                                                        provided, the protocol server should ignore the message
                                                        entirely.</p>
                                                </div>
                                            </div>
                                            <div class="section" id="protocol-format-guidelines">
                                                <h5>Protocol Format Guidelines<a class="headerlink"
                                                                                 href="#protocol-format-guidelines"
                                                                                 title="Permalink to this headline">¶</a>
                                                </h5>

                                                <p>Message formats for protocols should follow these rules, unless
                                                    a very good performance or implementation reason is present:</p>
                                                <ul class="simple">
                                                    <li><code class="docutils literal"><span
                                                            class="pre">reply_channel</span></code> should be unique per
                                                        logical connection, and not per
                                                        logical client.
                                                    </li>
                                                    <li>If the protocol has server-side state, entirely encapsulate that
                                                        state in
                                                        the protocol server; do not require the message consumers to use
                                                        an external
                                                        state store.
                                                    </li>
                                                    <li>If the protocol has low-level negotiation, keepalive or other
                                                        features,
                                                        handle these within the protocol server and don&#8217;t expose
                                                        them in ASGI
                                                        messages.
                                                    </li>
                                                    <li>If the protocol has guaranteed ordering and does not use a
                                                        specific channel
                                                        for a given connection (as HTTP does for body data), ASGI
                                                        messages should
                                                        include an <code class="docutils literal"><span class="pre">order</span></code>
                                                        field (0-indexed) that preserves the ordering as
                                                        received by the protocol server (or as sent by the client, if
                                                        available).
                                                        This ordering should span all message types emitted by the
                                                        client - for
                                                        example, a connect message might have order <code
                                                                class="docutils literal"><span
                                                                class="pre">0</span></code>, and the first two frames
                                                        order <code class="docutils literal"><span class="pre">1</span></code>
                                                        and <code class="docutils literal"><span
                                                                class="pre">2</span></code>.
                                                    </li>
                                                    <li>If the protocol is datagram-based, one datagram should equal one
                                                        ASGI message
                                                        (unless size is an issue)
                                                    </li>
                                                </ul>
                                            </div>
                                            <div class="section" id="approximate-global-ordering">
                                                <h5>Approximate Global Ordering<a class="headerlink"
                                                                                  href="#approximate-global-ordering"
                                                                                  title="Permalink to this headline">¶</a>
                                                </h5>

                                                <p>While maintaining true global (across-channels) ordering of messages
                                                    is
                                                    entirely unreasonable to expect of many implementations, they should
                                                    strive
                                                    to prevent busy channels from overpowering quiet channels.</p>

                                                <p>For example, imagine two channels, <code
                                                        class="docutils literal"><span class="pre">busy</span></code>,
                                                    which spikes to 1000 messages a
                                                    second, and <code class="docutils literal"><span
                                                            class="pre">quiet</span></code>, which gets one message a
                                                    second. There&#8217;s a single
                                                    consumer running <code class="docutils literal"><span class="pre">receive(['busy',</span>
                                                        <span class="pre">'quiet'])</span></code> which can handle
                                                    around 200 messages a second.</p>

                                                <p>In a simplistic for-loop implementation, the channel layer might
                                                    always check
                                                    <code class="docutils literal"><span class="pre">busy</span></code>
                                                    first; it always has messages available, and so the consumer never
                                                    even gets to see a message from <code class="docutils literal"><span
                                                            class="pre">quiet</span></code>, even if it was sent with
                                                    the
                                                    first batch of <code class="docutils literal"><span
                                                            class="pre">busy</span></code> messages.</p>

                                                <p>A simple way to solve this is to randomize the order of the channel
                                                    list when
                                                    looking for messages inside the channel layer; other, better methods
                                                    are also
                                                    available, but whatever is chosen, it should try to avoid a scenario
                                                    where
                                                    a message doesn&#8217;t get received purely because another channel
                                                    is busy.</p>
                                            </div>
                                            <div class="section" id="strings-and-unicode">
                                                <h5>Strings and Unicode<a class="headerlink" href="#strings-and-unicode"
                                                                          title="Permalink to this headline">¶</a></h5>

                                                <p>In this document, <em>byte string</em> refers to <code
                                                        class="docutils literal"><span class="pre">str</span></code> on
                                                    Python 2 and <code class="docutils literal"><span
                                                            class="pre">bytes</span></code>
                                                    on Python 3. If this type still supports Unicode codepoints due to
                                                    the
                                                    underlying implementation, then any values should be kept within the
                                                    lower
                                                    8-byte range.</p>

                                                <p><em>Unicode string</em> refers to <code
                                                        class="docutils literal"><span class="pre">unicode</span></code>
                                                    on Python 2 and <code class="docutils literal"><span
                                                            class="pre">str</span></code> on Python 3.
                                                    This document will never specify just <em>string</em> - all strings
                                                    are one of the
                                                    two types.</p>

                                                <p>Some serializers, such as <code class="docutils literal"><span
                                                        class="pre">json</span></code>, cannot differentiate between
                                                    byte
                                                    strings and unicode strings; these should include logic to box one
                                                    type as
                                                    the other (for example, encoding byte strings as base64 unicode
                                                    strings with
                                                    a preceding special character, e.g. U+FFFF).</p>

                                                <p>Channel and group names are always unicode strings, with the
                                                    additional
                                                    limitation that they only use the following characters:</p>
                                                <ul class="simple">
                                                    <li>ASCII letters</li>
                                                    <li>The digits <code class="docutils literal"><span
                                                            class="pre">0</span></code> through <code
                                                            class="docutils literal"><span class="pre">9</span></code>
                                                    </li>
                                                    <li>Hyphen <code class="docutils literal"><span class="pre">-</span></code>
                                                    </li>
                                                    <li>Underscore <code class="docutils literal"><span
                                                            class="pre">_</span></code></li>
                                                    <li>Period <code class="docutils literal"><span class="pre">.</span></code>
                                                    </li>
                                                    <li>Question mark <code class="docutils literal"><span
                                                            class="pre">?</span></code> (only to delineiate
                                                        single-reader channel names,
                                                        and only one per name)
                                                    </li>
                                                    <li>Exclamation mark <code class="docutils literal"><span
                                                            class="pre">!</span></code> (only to delineate
                                                        process-specific channel names,
                                                        and only one per name)
                                                    </li>
                                                </ul>
                                            </div>
                                            <div class="section" id="wsgi-compatibility">
                                                <h5>WSGI Compatibility<a class="headerlink" href="#wsgi-compatibility"
                                                                         title="Permalink to this headline">¶</a></h5>

                                                <p>Part of the design of the HTTP portion of this spec is to make sure
                                                    it
                                                    aligns well with the WSGI specification, to ensure easy adaptability
                                                    between both specifications and the ability to keep using WSGI
                                                    servers or
                                                    applications with ASGI.</p>

                                                <p>The adaptability works in two ways:</p>
                                                <ul class="simple">
                                                    <li>WSGI Server to ASGI: A WSGI application can be written that
                                                        transforms
                                                        <code class="docutils literal"><span class="pre">environ</span></code>
                                                        into a Request message, sends it off on the <code
                                                                class="docutils literal"><span
                                                                class="pre">http.request</span></code>
                                                        channel, and then waits on a generated response channel for a
                                                        Response
                                                        message. This has the disadvantage of tying up an entire WSGI
                                                        thread
                                                        to poll one channel, but should not be a massive performance
                                                        drop if
                                                        there is no backlog on the request channel, and would work fine
                                                        for an
                                                        in-process adapter to run a pure-ASGI web application.
                                                    </li>
                                                    <li>ASGI to WSGI application: A small wrapper process is needed that
                                                        listens
                                                        on the <code class="docutils literal"><span class="pre">http.request</span></code>
                                                        channel, and decodes incoming Request messages
                                                        into an <code class="docutils literal"><span
                                                                class="pre">environ</span></code> dict that matches the
                                                        WSGI specs, while passing in
                                                        a <code class="docutils literal"><span class="pre">start_response</span></code>
                                                        that stores the values for sending with the first
                                                        content chunk. Then, the application iterates over the WSGI app,
                                                        packaging each returned content chunk into a Response or
                                                        Response Chunk
                                                        message (if more than one is yielded).
                                                    </li>
                                                </ul>
                                                <p>There is an almost direct mapping for the various special keys in
                                                    WSGI&#8217;s <code class="docutils literal"><span class="pre">environ</span></code>
                                                    variable to the Request message:</p>
                                                <ul class="simple">
                                                    <li><code class="docutils literal"><span
                                                            class="pre">REQUEST_METHOD</span></code> is the <code
                                                            class="docutils literal"><span
                                                            class="pre">method</span></code> key
                                                    </li>
                                                    <li><code class="docutils literal"><span
                                                            class="pre">SCRIPT_NAME</span></code> is <code
                                                            class="docutils literal"><span class="pre">root_path</span></code>
                                                    </li>
                                                    <li><code class="docutils literal"><span
                                                            class="pre">PATH_INFO</span></code> can be derived from
                                                        <code class="docutils literal"><span
                                                                class="pre">path</span></code> and <code
                                                                class="docutils literal"><span
                                                                class="pre">root_path</span></code></li>
                                                    <li><code class="docutils literal"><span
                                                            class="pre">QUERY_STRING</span></code> is <code
                                                            class="docutils literal"><span
                                                            class="pre">query_string</span></code></li>
                                                    <li><code class="docutils literal"><span
                                                            class="pre">CONTENT_TYPE</span></code> can be extracted from
                                                        <code class="docutils literal"><span class="pre">headers</span></code>
                                                    </li>
                                                    <li><code class="docutils literal"><span
                                                            class="pre">CONTENT_LENGTH</span></code> can be extracted
                                                        from <code class="docutils literal"><span
                                                                class="pre">headers</span></code></li>
                                                    <li><code class="docutils literal"><span
                                                            class="pre">SERVER_NAME</span></code> and <code
                                                            class="docutils literal"><span
                                                            class="pre">SERVER_PORT</span></code> are in <code
                                                            class="docutils literal"><span
                                                            class="pre">server</span></code></li>
                                                    <li><code class="docutils literal"><span
                                                            class="pre">REMOTE_HOST</span></code>/<code
                                                            class="docutils literal"><span
                                                            class="pre">REMOTE_ADDR</span></code> and <code
                                                            class="docutils literal"><span
                                                            class="pre">REMOTE_PORT</span></code> are in <code
                                                            class="docutils literal"><span
                                                            class="pre">client</span></code></li>
                                                    <li><code class="docutils literal"><span
                                                            class="pre">SERVER_PROTOCOL</span></code> is encoded in
                                                        <code class="docutils literal"><span
                                                                class="pre">http_version</span></code></li>
                                                    <li><code class="docutils literal"><span
                                                            class="pre">wsgi.url_scheme</span></code> is <code
                                                            class="docutils literal"><span
                                                            class="pre">scheme</span></code></li>
                                                    <li><code class="docutils literal"><span
                                                            class="pre">wsgi.input</span></code> is a StringIO around
                                                        <code class="docutils literal"><span
                                                                class="pre">body</span></code></li>
                                                    <li><code class="docutils literal"><span
                                                            class="pre">wsgi.errors</span></code> is directed by the
                                                        wrapper as needed
                                                    </li>
                                                </ul>
                                                <p>The <code class="docutils literal"><span
                                                        class="pre">start_response</span></code> callable maps similarly
                                                    to Response:</p>
                                                <ul class="simple">
                                                    <li>The <code class="docutils literal"><span
                                                            class="pre">status</span></code> argument becomes <code
                                                            class="docutils literal"><span
                                                            class="pre">status</span></code>, with the reason phrase
                                                        dropped.
                                                    </li>
                                                    <li><code class="docutils literal"><span class="pre">response_headers</span></code>
                                                        maps to <code class="docutils literal"><span
                                                                class="pre">headers</span></code></li>
                                                </ul>
                                                <p>It may even be possible to map Request Body Chunks in a way that
                                                    allows
                                                    streaming of body data, though it would likely be easier and
                                                    sufficient for
                                                    many applications to simply buffer the whole body into memory before
                                                    calling
                                                    the WSGI application.</p>
                                            </div>
                                        </div>
                                        <div class="section" id="common-questions">
                                            <h4>Common Questions<a class="headerlink" href="#common-questions"
                                                                   title="Permalink to this headline">¶</a></h4>
                                            <ol class="arabic">
                                                <li><p class="first">Why are messages <code
                                                        class="docutils literal"><span class="pre">dicts</span></code>,
                                                    rather than a more advanced type?</p>

                                                    <p>We want messages to be very portable, especially across process
                                                        and
                                                        machine boundaries, and so a simple encodable type seemed the
                                                        best way.
                                                        We expect frameworks to wrap each protocol-specific set of
                                                        messages in
                                                        custom classes (e.g. <code class="docutils literal"><span
                                                                class="pre">http.request</span></code> messages become
                                                        <code class="docutils literal"><span class="pre">Request</span></code>
                                                        objects)</p>
                                                </li>
                                            </ol>
                                        </div>
                                        <div class="section" id="todos">
                                            <h4>TODOs<a class="headerlink" href="#todos"
                                                        title="Permalink to this headline">¶</a></h4>
                                            <ul class="simple">
                                                <li>Maybe remove <code class="docutils literal"><span class="pre">http_version</span></code>
                                                    and replace with <code class="docutils literal"><span class="pre">supports_server_push</span></code>?
                                                </li>
                                                <li><code class="docutils literal"><span
                                                        class="pre">receive</span></code> can&#8217;t easily be
                                                    implemented with async/cooperative code
                                                    behind it as it&#8217;s nonblocking - possible alternative call
                                                    type?
                                                    Asyncio extension that provides <code class="docutils literal"><span
                                                            class="pre">receive_yield</span></code>?
                                                </li>
                                                <li>Possible extension to allow detection of channel layer flush/restart
                                                    and
                                                    prompt protocol servers to restart?
                                                </li>
                                                <li>Maybe WSGI-app like spec for simple &#8220;applications&#8221; that
                                                    allows standardized
                                                    application-running servers?
                                                </li>
                                            </ul>
                                        </div>
                                        <div class="section" id="copyright">
                                            <h4>Copyright<a class="headerlink" href="#copyright"
                                                            title="Permalink to this headline">¶</a></h4>

                                            <p>This document has been placed in the public domain.</p>
                                        </div>
                                        <div class="section" id="protocol-definitions">
                                            <h4>Protocol Definitions<a class="headerlink" href="#protocol-definitions"
                                                                       title="Permalink to this headline">¶</a></h4>

                                            <div class="toctree-wrapper compound">
                                                <span id="document-asgi/email"></span>

                                                <div class="section" id="email-asgi-message-format-draft-spec">
                                                    <h5>Email ASGI Message Format (Draft Spec)<a class="headerlink"
                                                                                                 href="#email-asgi-message-format-draft-spec"
                                                                                                 title="Permalink to this headline">¶</a>
                                                    </h5>

                                                    <p>Represents emails sent or received, likely over the SMTP protocol
                                                        though that
                                                        is not directly specified here (a protocol server could in
                                                        theory deliver
                                                        or receive email over HTTP to some external service, for
                                                        example). Generally
                                                        adheres to RFC 5322 as much as possible.</p>

                                                    <p>As emails have no concept of a session and there&#8217;s no
                                                        trustable socket or
                                                        author model, the send and receive channels are both
                                                        multi-listener, and
                                                        there is no <code class="docutils literal"><span class="pre">reply_channel</span></code>
                                                        on any message type. If you want to persist
                                                        data across different email receive consumers, you should decide
                                                        what part
                                                        of the message to use for an identifier (from address? to
                                                        address? subject?
                                                        thread id?) and provide the persistence yourself.</p>

                                                    <p>The protocol server should handle encoding of headers by itself,
                                                        understanding
                                                        RFC 1342 format headers and decoding them into unicode upon
                                                        receive, and
                                                        encoding outgoing emails similarly (preferably using UTF-8).</p>

                                                    <div class="section" id="receive">
                                                        <h6>Receive<a class="headerlink" href="#receive"
                                                                      title="Permalink to this headline">¶</a></h6>

                                                        <p>Sent when an email is received.</p>

                                                        <p>Channel: <code class="docutils literal"><span class="pre">email.receive</span></code>
                                                        </p>

                                                        <p>Keys:</p>
                                                        <ul class="simple">
                                                            <li><code class="docutils literal"><span
                                                                    class="pre">from</span></code>: Unicode string
                                                                specifying the return-path of the email as specified
                                                                in the SMTP envelope. Will be <code
                                                                        class="docutils literal"><span
                                                                        class="pre">None</span></code> if no return path
                                                                was provided.
                                                            </li>
                                                            <li><code class="docutils literal"><span
                                                                    class="pre">to</span></code>: List of unicode
                                                                strings specifying the recipients requested in the
                                                                SMTP envelope using <code class="docutils literal"><span
                                                                        class="pre">RCPT</span> <span
                                                                        class="pre">TO</span></code> commands. Will
                                                                always contain at least one
                                                                value.
                                                            </li>
                                                            <li><code class="docutils literal"><span
                                                                    class="pre">headers</span></code>: Dictionary of
                                                                unicode string keys and unicode string values,
                                                                containing all headers, including <code
                                                                        class="docutils literal"><span class="pre">subject</span></code>.
                                                                Header names are all forced
                                                                to lower case. Header values are decoded from RFC 1342
                                                                if needed.
                                                            </li>
                                                            <li><code class="docutils literal"><span
                                                                    class="pre">content</span></code>: Contains a
                                                                content object (see section below) representing the
                                                                body of the message.
                                                            </li>
                                                        </ul>
                                                        <p>Note that <code class="docutils literal"><span class="pre">from</span></code>
                                                            and <code class="docutils literal"><span
                                                                    class="pre">to</span></code> are extracted from the
                                                            SMTP envelope, and not
                                                            from the headers inside the message; if you wish to get the
                                                            header values,
                                                            you should use <code class="docutils literal"><span
                                                                    class="pre">headers['from']</span></code> and <code
                                                                    class="docutils literal"><span class="pre">headers['to']</span></code>;
                                                            they may be different.</p>
                                                    </div>
                                                    <div class="section" id="send">
                                                        <h6>Send<a class="headerlink" href="#send"
                                                                   title="Permalink to this headline">¶</a></h6>

                                                        <p>Sends an email out via whatever transport</p>
                                                    </div>
                                                    <div class="section" id="content-objects">
                                                        <h6>Content objects<a class="headerlink" href="#content-objects"
                                                                              title="Permalink to this headline">¶</a>
                                                        </h6>

                                                        <p>Used in both send and receive to represent the tree structure
                                                            of a MIME
                                                            multipart message tree.</p>

                                                        <p>A content object is always a dict, containing at least the
                                                            key:</p>
                                                        <ul class="simple">
                                                            <li><code class="docutils literal"><span class="pre">content-type</span></code>:
                                                                The unicode string of the content type for this section.
                                                            </li>
                                                        </ul>
                                                        <p>Multipart content objects also have:</p>
                                                        <ul class="simple">
                                                            <li><code class="docutils literal"><span
                                                                    class="pre">parts</span></code>: A list of content
                                                                objects contained inside this multipart
                                                            </li>
                                                        </ul>
                                                        <p>Any other type of object has:</p>
                                                        <ul class="simple">
                                                            <li><code class="docutils literal"><span
                                                                    class="pre">body</span></code>: Byte string content
                                                                of this part, decoded from any
                                                                <code class="docutils literal"><span class="pre">Content-Transfer-Encoding</span></code>
                                                                if one was specified as a MIME header.
                                                            </li>
                                                        </ul>
                                                    </div>
                                                </div>
                                                <span id="document-asgi/udp"></span>

                                                <div class="section" id="udp-asgi-message-format-draft-spec">
                                                    <h5>UDP ASGI Message Format (Draft Spec)<a class="headerlink"
                                                                                               href="#udp-asgi-message-format-draft-spec"
                                                                                               title="Permalink to this headline">¶</a>
                                                    </h5>

                                                    <p>Raw UDP is specified here as it is a datagram-based, unordered
                                                        and unreliable
                                                        protocol, which neatly maps to the underlying message
                                                        abstraction. It is not
                                                        expected that many applications would use the low-level
                                                        protocol, but it may
                                                        be useful for some.</p>

                                                    <p>While it might seem odd to have reply channels for UDP as it is a
                                                        stateless
                                                        protocol, replies need to come from the same server as the
                                                        messages were
                                                        sent to, so the reply channel here ensures that reply packets
                                                        from an ASGI
                                                        stack do not come from a different protocol server to the one
                                                        you sent the
                                                        initial packet to.</p>

                                                    <div class="section" id="receive">
                                                        <h6>Receive<a class="headerlink" href="#receive"
                                                                      title="Permalink to this headline">¶</a></h6>

                                                        <p>Sent when a UDP datagram is received.</p>

                                                        <p>Channel: <code class="docutils literal"><span class="pre">udp.receive</span></code>
                                                        </p>

                                                        <p>Keys:</p>
                                                        <ul class="simple">
                                                            <li><code class="docutils literal"><span class="pre">reply_channel</span></code>:
                                                                Channel name for sending data, starts with <code
                                                                        class="docutils literal"><span class="pre">udp.send!</span></code>
                                                            </li>
                                                            <li><code class="docutils literal"><span
                                                                    class="pre">data</span></code>: Byte string of UDP
                                                                datagram payload.
                                                            </li>
                                                            <li><code class="docutils literal"><span
                                                                    class="pre">client</span></code>: List of <code
                                                                    class="docutils literal"><span
                                                                    class="pre">[host,</span> <span
                                                                    class="pre">port]</span></code> where <code
                                                                    class="docutils literal"><span
                                                                    class="pre">host</span></code> is a unicode string
                                                                of the
                                                                remote host&#8217;s IPv4 or IPv6 address, and <code
                                                                        class="docutils literal"><span
                                                                        class="pre">port</span></code> is the remote
                                                                port as an
                                                                integer.
                                                            </li>
                                                            <li><code class="docutils literal"><span
                                                                    class="pre">server</span></code>: List of <code
                                                                    class="docutils literal"><span
                                                                    class="pre">[host,</span> <span
                                                                    class="pre">port]</span></code> where <code
                                                                    class="docutils literal"><span
                                                                    class="pre">host</span></code> is the listening
                                                                address
                                                                for this server as a unicode string, and <code
                                                                        class="docutils literal"><span
                                                                        class="pre">port</span></code> is the integer
                                                                listening port.
                                                                Optional, defaults to <code
                                                                        class="docutils literal"><span
                                                                        class="pre">None</span></code>.
                                                            </li>
                                                        </ul>
                                                    </div>
                                                    <div class="section" id="send">
                                                        <h6>Send<a class="headerlink" href="#send"
                                                                   title="Permalink to this headline">¶</a></h6>

                                                        <p>Sent to send out a UDP datagram to a client.</p>

                                                        <p>Channel: <code class="docutils literal"><span class="pre">udp.send!</span></code>
                                                        </p>

                                                        <p>Keys:</p>
                                                        <ul class="simple">
                                                            <li><code class="docutils literal"><span
                                                                    class="pre">data</span></code>: Byte string of UDP
                                                                datagram payload.
                                                            </li>
                                                        </ul>
                                                    </div>
                                                </div>
                                                <span id="document-asgi/delay"></span>

                                                <div class="section" id="delay-protocol-asgi-message-format-draft-spec">
                                                    <h5>Delay Protocol ASGI Message Format (Draft Spec)<a
                                                            class="headerlink"
                                                            href="#delay-protocol-asgi-message-format-draft-spec"
                                                            title="Permalink to this headline">¶</a></h5>

                                                    <p>Protocol that allows any ASGI message to be delayed for a given
                                                        number of milliseconds.</p>

                                                    <p>This simple protocol enables developers to schedule ASGI messages
                                                        to be sent at a time in the future.
                                                        It can be used in conjunction with any other channel. This
                                                        allows you do simple tasks
                                                        like scheduling an email to be sent later, to more complex tasks
                                                        like testing latency in protocols.</p>

                                                    <div class="section" id="delay">
                                                        <h6>Delay<a class="headerlink" href="#delay"
                                                                    title="Permalink to this headline">¶</a></h6>

                                                        <p>Send a message to this channel to delay a message.</p>

                                                        <p>Channel: <code class="docutils literal"><span class="pre">asgi.delay</span></code>
                                                        </p>

                                                        <p>Keys:</p>
                                                        <blockquote>
                                                            <div>
                                                                <ul class="simple">
                                                                    <li><code class="docutils literal"><span
                                                                            class="pre">channel</span></code>: Unicode
                                                                        string specifying the final destination channel
                                                                        for the message after the delay.
                                                                    </li>
                                                                    <li><code class="docutils literal"><span
                                                                            class="pre">delay</span></code>: Positive
                                                                        integer specifying the number of milliseconds to
                                                                        delay the message.
                                                                    </li>
                                                                    <li><code class="docutils literal"><span
                                                                            class="pre">content</span></code>:
                                                                        Dictionary of unicode string keys for the
                                                                        message content. This should meet the
                                                                    </li>
                                                                </ul>
                                                            </div>
                                                        </blockquote>
                                                        <p>content specifications for the specified destination
                                                            channel.</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <span id="document-community"></span>

                                    <div class="section" id="community-projects">
                                        <h3>Community Projects<a class="headerlink" href="#community-projects"
                                                                 title="Permalink to this headline">¶</a></h3>

                                        <p>These projects from the community are developed on top of Channels:</p>
                                        <ul class="simple">
                                            <li><a class="reference external"
                                                   href="https://github.com/djangobot/djangobot">Djangobot</a>, a
                                                bi-directional interface server for Slack.
                                            </li>
                                            <li><a class="reference external"
                                                   href="https://github.com/nephila/django-knocker">knocker</a>, a
                                                generic desktop-notification system.
                                            </li>
                                            <li><a class="reference external"
                                                   href="https://github.com/rajasimon/beatserver">Beatserver</a>, a
                                                periodic task scheduler for django channels.
                                            </li>
                                            <li><a class="reference external"
                                                   href="https://github.com/furious-luke/django-cq">cq</a>, a simple
                                                distributed task system.
                                            </li>
                                            <li><a class="reference external"
                                                   href="https://github.com/Krukov/django-channels-panel">Debugpannel</a>,
                                                a django Debug Toolbar panel for channels.
                                            </li>
                                        </ul>
                                        <p>If you&#8217;d like to add your project, please submit a PR with a link and
                                            brief description.</p>
                                    </div>
                                    <span id="document-contributing"></span>

                                    <div class="section" id="contributing">
                                        <h3>Contributing<a class="headerlink" href="#contributing"
                                                           title="Permalink to this headline">¶</a></h3>

                                        <p>If you&#8217;re looking to contribute to Channels, then please read on - we
                                            encourage
                                            contributions both large and small, from both novice and seasoned
                                            developers.</p>

                                        <div class="section" id="what-can-i-work-on">
                                            <h4>What can I work on?<a class="headerlink" href="#what-can-i-work-on"
                                                                      title="Permalink to this headline">¶</a></h4>

                                            <p>We&#8217;re looking for help with the following areas:</p>
                                            <blockquote>
                                                <div>
                                                    <ul class="simple">
                                                        <li>Documentation and tutorial writing</li>
                                                        <li>Bugfixing and testing</li>
                                                        <li>Feature polish and occasional new feature design</li>
                                                        <li>Case studies and writeups</li>
                                                    </ul>
                                                </div>
                                            </blockquote>
                                            <p>You can find what we&#8217;re looking to work on in the GitHub issues
                                                list for each
                                                of the Channels sub-projects:</p>
                                            <blockquote>
                                                <div>
                                                    <ul class="simple">
                                                        <li><a class="reference external"
                                                               href="https://github.com/django/channels/issues/">Channels
                                                            issues</a>, for the Django integration and overall project
                                                            efforts
                                                        </li>
                                                        <li><a class="reference external"
                                                               href="https://github.com/django/daphne/issues/">Daphne
                                                            issues</a>, for the HTTP and Websocket termination
                                                        </li>
                                                        <li><a class="reference external"
                                                               href="https://github.com/django/asgiref/issues/">asgiref
                                                            issues</a>, for the base ASGI library/memory backend
                                                        </li>
                                                        <li><a class="reference external"
                                                               href="https://github.com/django/asgi_redis/issues/">asgi_redis
                                                            issues</a>, for the Redis channel backend
                                                        </li>
                                                        <li><a class="reference external"
                                                               href="https://github.com/django/asgi_ipc/issues/">asgi_ipc
                                                            issues</a>, for the POSIX IPC channel backend
                                                        </li>
                                                    </ul>
                                                </div>
                                            </blockquote>
                                            <p>Issues are categorized by difficulty level:</p>
                                            <blockquote>
                                                <div>
                                                    <ul class="simple">
                                                        <li><code class="docutils literal"><span class="pre">exp/beginner</span></code>:
                                                            Easy issues suitable for a first-time contributor.
                                                        </li>
                                                        <li><code class="docutils literal"><span class="pre">exp/intermediate</span></code>:
                                                            Moderate issues that need skill and a day or two to solve.
                                                        </li>
                                                        <li><code class="docutils literal"><span class="pre">exp/advanced</span></code>:
                                                            Difficult issues that require expertise and potentially
                                                            weeks of work.
                                                        </li>
                                                    </ul>
                                                </div>
                                            </blockquote>
                                            <p>They are also classified by type:</p>
                                            <blockquote>
                                                <div>
                                                    <ul class="simple">
                                                        <li><code class="docutils literal"><span class="pre">documentation</span></code>:
                                                            Documentation issues. Pick these if you want to help us by
                                                            writing docs.
                                                        </li>
                                                        <li><code class="docutils literal"><span class="pre">bug</span></code>:
                                                            A bug in existing code. Usually easier for beginners as
                                                            there&#8217;s a defined thing to fix.
                                                        </li>
                                                        <li><code class="docutils literal"><span
                                                                class="pre">enhancement</span></code>: A new feature for
                                                            the code; may be a bit more open-ended.
                                                        </li>
                                                    </ul>
                                                </div>
                                            </blockquote>
                                            <p>You should filter the issues list by the experience level and type of
                                                work
                                                you&#8217;d like to do, and then if you want to take something on leave
                                                a comment
                                                and assign yourself to it. If you want advice about how to take on a
                                                bug,
                                                leave a comment asking about it, or pop into the IRC channel at
                                                <code class="docutils literal"><span class="pre">#django-channels</span></code>
                                                on Freenode and we&#8217;ll be happy to help.</p>

                                            <p>The issues are also just a suggested list - any offer to help is welcome
                                                as long
                                                as it fits the project goals, but you should make an issue for the thing
                                                you
                                                wish to do and discuss it first if it&#8217;s relatively large (but if
                                                you just found
                                                a small bug and want to fix it, sending us a pull request straight away
                                                is fine).</p>
                                        </div>
                                        <div class="section" id="i-m-a-novice-contributor-developer-can-i-help">
                                            <h4>I&#8217;m a novice contributor/developer - can I help?<a
                                                    class="headerlink"
                                                    href="#i-m-a-novice-contributor-developer-can-i-help"
                                                    title="Permalink to this headline">¶</a></h4>

                                            <p>Of course! The issues labelled with <code class="docutils literal"><span
                                                    class="pre">exp/beginner</span></code> are a perfect place to
                                                get started, as they&#8217;re usually small and well defined. If you
                                                want help with
                                                one of them, pop into the IRC channel at <code class="docutils literal"><span
                                                        class="pre">#django-channels</span></code> on Freenode or
                                                get in touch with Andrew directly at <a class="reference external"
                                                                                        href="mailto:andrew&#37;&#52;&#48;aeracode&#46;org">andrew<span>&#64;</span>aeracode<span>&#46;</span>org</a>.
                                            </p>
                                        </div>
                                        <div class="section" id="can-you-pay-me-for-my-time">
                                            <h4>Can you pay me for my time?<a class="headerlink"
                                                                              href="#can-you-pay-me-for-my-time"
                                                                              title="Permalink to this headline">¶</a>
                                            </h4>

                                            <p>Thanks to Mozilla, we have a reasonable budget to pay people for their
                                                time
                                                working on all of the above sorts of tasks and more. Generally, we&#8217;d
                                                prefer
                                                to fund larger projects (you can find these labelled as <code
                                                        class="docutils literal"><span
                                                        class="pre">epic-project</span></code> in the
                                                issues lists) to reduce the administrative overhead, but we&#8217;re
                                                open to any
                                                proposal.</p>

                                            <p>If you&#8217;re interested in working on something and being paid, you&#8217;ll
                                                need to
                                                draw up a short proposal and get in touch with the committee, discuss
                                                the work
                                                and your history with open-source contribution (we strongly prefer that
                                                you have
                                                a proven track record on at least a few things) and the amount you&#8217;d
                                                like to be paid.</p>

                                            <p>If you&#8217;re interested in working on one of these tasks, get in touch
                                                with
                                                Andrew Godwin (<a class="reference external"
                                                                  href="mailto:andrew&#37;&#52;&#48;aeracode&#46;org">andrew<span>&#64;</span>aeracode<span>&#46;</span>org</a>)
                                                as a first point of contact; he can help
                                                talk you through what&#8217;s involved, and help judge/refine your
                                                proposal before
                                                it goes to the committee.</p>

                                            <p>Tasks not on any issues list can also be proposed; Andrew can help talk
                                                about them
                                                and if they would be sensible to do.</p>
                                        </div>
                                    </div>
                                    <span id="document-releases/index"></span>

                                    <div class="section" id="release-notes">
                                        <h3>Release Notes<a class="headerlink" href="#release-notes"
                                                            title="Permalink to this headline">¶</a></h3>

                                        <div class="toctree-wrapper compound">
                                            <span id="document-releases/1.0.0"></span>

                                            <div class="section" id="release-notes">
                                                <h4>1.0.0 Release Notes<a class="headerlink" href="#release-notes"
                                                                          title="Permalink to this headline">¶</a></h4>

                                                <p>Channels 1.0.0 brings together a number of design changes, including
                                                    some
                                                    breaking changes, into our first fully stable release, and also
                                                    brings the
                                                    databinding code out of alpha phase. It was released on
                                                    2017/01/08.</p>

                                                <p>The result is a faster, easier to use, and safer Channels, including
                                                    one major
                                                    change that will fix almost all problems with sessions and
                                                    connect/receive
                                                    ordering in a way that needs no persistent storage.</p>

                                                <p>It was unfortunately not possible to make all of the changes
                                                    backwards
                                                    compatible, though most code should not be too affected and the
                                                    fixes are
                                                    generally quite easy.</p>

                                                <p>You <strong>must also update Daphne</strong> to at least 1.0.0 to
                                                    have this release of
                                                    Channels work correctly.</p>

                                                <div class="section" id="major-features">
                                                    <h5>Major Features<a class="headerlink" href="#major-features"
                                                                         title="Permalink to this headline">¶</a></h5>

                                                    <p>Channels 1.0 introduces a couple of new major features.</p>

                                                    <div class="section" id="websocket-accept-reject-flow">
                                                        <h6>WebSocket accept/reject flow<a class="headerlink"
                                                                                           href="#websocket-accept-reject-flow"
                                                                                           title="Permalink to this headline">¶</a>
                                                        </h6>

                                                        <p>Rather than be immediately accepted, WebSockets now pause
                                                            during the handshake
                                                            while they send over a message on <code
                                                                    class="docutils literal"><span class="pre">websocket.connect</span></code>,
                                                            and your application
                                                            must either accept or reject the connection before the
                                                            handshake is completed
                                                            and messages can be received.</p>

                                                        <p>You <strong>must</strong> update Daphne to at least 1.0.0 to
                                                            make this work correctly.</p>

                                                        <p>This has several advantages:</p>
                                                        <ul class="simple">
                                                            <li>You can now reject WebSockets before they even finish
                                                                connecting, giving
                                                                appropriate error codes to browsers and not letting the
                                                                browser-side socket
                                                                ever get into a connected state and send messages.
                                                            </li>
                                                            <li>Combined with Consumer Atomicity (below), it means there
                                                                is no longer any need
                                                                for the old &#8220;slight ordering&#8221; mode, as the
                                                                connect consumer must run to
                                                                completion and accept the socket before any messages can
                                                                be received and
                                                                forwarded onto <code class="docutils literal"><span
                                                                        class="pre">websocket.receive</span></code>.
                                                            </li>
                                                            <li>Any <code class="docutils literal"><span class="pre">send</span></code>
                                                                message sent to the WebSocket will implicitly accept the
                                                                connection,
                                                                meaning only a limited set of <code
                                                                        class="docutils literal"><span class="pre">connect</span></code>
                                                                consumers need changes (see
                                                                Backwards Incompatible Changes below)
                                                            </li>
                                                        </ul>
                                                    </div>
                                                    <div class="section" id="consumer-atomicity">
                                                        <h6>Consumer Atomicity<a class="headerlink"
                                                                                 href="#consumer-atomicity"
                                                                                 title="Permalink to this headline">¶</a>
                                                        </h6>

                                                        <p>Consumers will now buffer messages you try to send until the
                                                            consumer completes
                                                            and then send them once it exits and the outbound part of
                                                            any decorators have
                                                            been run (even if an exception is raised).</p>

                                                        <p>This makes the flow of messages much easier to reason about -
                                                            consumers can now
                                                            be reasoned about as atomic blocks that run and then send
                                                            messages, meaning that
                                                            if you send a message to start another consumer you&#8217;re
                                                            guaranteed that the
                                                            sending consumer has finished running by the time it&#8217;s
                                                            acted upon.</p>

                                                        <p>If you want to send messages immediately rather than at the
                                                            end of the consumer,
                                                            you can still do that by passing the <code
                                                                    class="docutils literal"><span class="pre">immediately</span></code>
                                                            argument:</p>

                                                        <div class="highlight-python">
                                                            <div class="highlight"><pre><span></span><span class="n">Channel</span><span
                                                                    class="p">(</span><span class="s2">&quot;thumbnailing-tasks&quot;</span><span
                                                                    class="p">)</span><span class="o">.</span><span
                                                                    class="n">send</span><span class="p">({</span><span
                                                                    class="s2">&quot;id&quot;</span><span
                                                                    class="p">:</span> <span
                                                                    class="mi">34245</span><span
                                                                    class="p">},</span> <span
                                                                    class="n">immediately</span><span class="o">=</span><span
                                                                    class="bp">True</span><span class="p">)</span>
</pre>
                                                            </div>
                                                        </div>
                                                        <p>This should be mostly backwards compatible, and may actually
                                                            fix race
                                                            conditions in some apps that were pre-existing.</p>
                                                    </div>
                                                    <div class="section" id="databinding-group-action-overhaul">
                                                        <h6>Databinding Group/Action Overhaul<a class="headerlink"
                                                                                                href="#databinding-group-action-overhaul"
                                                                                                title="Permalink to this headline">¶</a>
                                                        </h6>

                                                        <p>Previously, databinding subclasses had to implement
                                                            <code class="docutils literal"><span class="pre">group_names(instance,</span>
                                                                <span class="pre">action)</span></code> to return what
                                                            groups to send an instance&#8217;s
                                                            change to of the type <code class="docutils literal"><span
                                                                    class="pre">action</span></code>. This had flaws,
                                                            most notably when what was
                                                            actually just a modification to the instance in question
                                                            changed its
                                                            permission status so more clients could see it; to those
                                                            clients, it should
                                                            instead have been &#8220;created&#8221;.</p>

                                                        <p>Now, Channels just calls <code class="docutils literal"><span
                                                                class="pre">group_names(instance)</span></code>, and you
                                                            should return what
                                                            groups can see the instance at the current point in time
                                                            given the instance
                                                            you were passed. Channels will actually call the method
                                                            before and after changes,
                                                            comparing the groups you gave, and sending out create,
                                                            update or delete messages
                                                            to clients appropriately.</p>

                                                        <p>Existing databinding code will need to be adapted; see the
                                                            &#8220;Backwards Incompatible Changes&#8221; section for
                                                            more.</p>
                                                    </div>
                                                    <div class="section" id="demultiplexer-overhaul">
                                                        <h6>Demultiplexer Overhaul<a class="headerlink"
                                                                                     href="#demultiplexer-overhaul"
                                                                                     title="Permalink to this headline">¶</a>
                                                        </h6>

                                                        <p>Demuliplexers have changed to remove the behaviour where they
                                                            re-sent messages
                                                            onto new channels without special headers, and instead now
                                                            correctly split out
                                                            incoming messages into sub-messages that still look like
                                                            <code class="docutils literal"><span class="pre">websocket.receive</span></code>
                                                            messages, and directly dispatch these to the relevant
                                                            consumer.</p>

                                                        <p>They also now forward all <code
                                                                class="docutils literal"><span class="pre">websocket.connect</span></code>
                                                            and <code class="docutils literal"><span class="pre">websocket.disconnect</span></code>
                                                            messages to all of their sub-consumers, so it&#8217;s much
                                                            easier to compose things
                                                            together from code that also works outside the context of
                                                            multiplexing.</p>

                                                        <p>For more, read the updated <code
                                                                class="xref doc docutils literal"><span class="pre">/generic</span></code>
                                                            docs.</p>
                                                    </div>
                                                    <div class="section" id="delay-server">
                                                        <h6>Delay Server<a class="headerlink" href="#delay-server"
                                                                           title="Permalink to this headline">¶</a></h6>

                                                        <p>A built-in delay server, launched with <cite>manage.py
                                                            rundelay</cite>, now ships if you
                                                            wish to use it. It needs some extra initial setup and uses a
                                                            database for
                                                            persistance; see <a class="reference internal"
                                                                                href="index.html#document-delay"><em>Delay
                                                                Server</em></a> for more information.</p>
                                                    </div>
                                                </div>
                                                <div class="section" id="minor-changes">
                                                    <h5>Minor Changes<a class="headerlink" href="#minor-changes"
                                                                        title="Permalink to this headline">¶</a></h5>
                                                    <ul class="simple">
                                                        <li>Serializers can now specify fields as <code
                                                                class="docutils literal"><span
                                                                class="pre">__all__</span></code> to auto-include all
                                                            fields,
                                                            and <code class="docutils literal"><span
                                                                    class="pre">exclude</span></code> to remove certain
                                                            unwanted fields.
                                                        </li>
                                                        <li><code class="docutils literal"><span
                                                                class="pre">runserver</span></code> respects <code
                                                                class="docutils literal"><span class="pre">FORCE_SCRIPT_NAME</span></code>
                                                        </li>
                                                        <li>Websockets can now be closed with a specific code by calling
                                                            <code class="docutils literal"><span class="pre">close(status=4000)</span></code>
                                                        </li>
                                                        <li><code class="docutils literal"><span class="pre">enforce_ordering</span></code>
                                                            no longer has a <code class="docutils literal"><span
                                                                    class="pre">slight</span></code> mode (because of
                                                            the accept
                                                            flow changes), and is more efficient with session saving.
                                                        </li>
                                                        <li><code class="docutils literal"><span
                                                                class="pre">runserver</span></code> respects <code
                                                                class="docutils literal"><span
                                                                class="pre">--nothreading</span></code> and only
                                                            launches one worker, takes
                                                            a <code class="docutils literal"><span class="pre">--http-timeout</span></code>
                                                            option if you want to override it from the default <code
                                                                    class="docutils literal"><span class="pre">60</span></code>,
                                                        </li>
                                                        <li>A new <code class="docutils literal"><span class="pre">&#64;channel_and_http_session</span></code>
                                                            decorator rehydrates the HTTP session out
                                                            of the channel session if you want to access it inside
                                                            receive consumers.
                                                        </li>
                                                        <li>Streaming responses no longer have a chance of being
                                                            cached.
                                                        </li>
                                                        <li><code class="docutils literal"><span class="pre">request.META['SERVER_PORT']</span></code>
                                                            is now always a string.
                                                        </li>
                                                        <li><code class="docutils literal"><span class="pre">http.disconnect</span></code>
                                                            now has a <code class="docutils literal"><span class="pre">path</span></code>
                                                            key so you can route it.
                                                        </li>
                                                        <li>Test client now has a <code class="docutils literal"><span
                                                                class="pre">send_and_consume</span></code> method.
                                                        </li>
                                                    </ul>
                                                </div>
                                                <div class="section" id="backwards-incompatible-changes">
                                                    <h5>Backwards Incompatible Changes<a class="headerlink"
                                                                                         href="#backwards-incompatible-changes"
                                                                                         title="Permalink to this headline">¶</a>
                                                    </h5>

                                                    <div class="section" id="connect-consumers">
                                                        <h6>Connect Consumers<a class="headerlink"
                                                                                href="#connect-consumers"
                                                                                title="Permalink to this headline">¶</a>
                                                        </h6>

                                                        <p>If you have a custom consumer for <code
                                                                class="docutils literal"><span class="pre">websocket.connect</span></code>,
                                                            you must ensure that
                                                            it either:</p>
                                                        <ul class="simple">
                                                            <li>Sends at least one message onto the <code
                                                                    class="docutils literal"><span class="pre">reply_channel</span></code>
                                                                that generates a
                                                                WebSocket frame (either <code
                                                                        class="docutils literal"><span
                                                                        class="pre">bytes</span></code> or <code
                                                                        class="docutils literal"><span
                                                                        class="pre">text</span></code> is set), either
                                                                directly
                                                                or via a group.
                                                            </li>
                                                            <li>Sends a message onto the <code class="docutils literal"><span
                                                                    class="pre">reply_channel</span></code> that is
                                                                <code class="docutils literal"><span class="pre">{&quot;accept&quot;:</span>
                                                                    <span class="pre">True}</span></code>,
                                                                to accept a connection without sending data.
                                                            </li>
                                                            <li>Sends a message onto the <code class="docutils literal"><span
                                                                    class="pre">reply_channel</span></code> that is
                                                                <code class="docutils literal"><span class="pre">{&quot;close&quot;:</span>
                                                                    <span class="pre">True}</span></code>,
                                                                to reject a connection mid-handshake.
                                                            </li>
                                                        </ul>
                                                        <p>Many consumers already do the former, but if your connect
                                                            consumer does not
                                                            send anything you MUST now send an accept message or the
                                                            socket will remain
                                                            in the handshaking phase forever and you&#8217;ll never get
                                                            any messages.</p>

                                                        <p>All built-in Channels consumers (e.g. in the generic
                                                            consumers) have been
                                                            upgraded to do this.</p>

                                                        <p>You <strong>must</strong> update Daphne to at least 1.0.0 to
                                                            make this work correctly.</p>
                                                    </div>
                                                    <div class="section" id="databinding-group-names">
                                                        <h6>Databinding group_names<a class="headerlink"
                                                                                      href="#databinding-group-names"
                                                                                      title="Permalink to this headline">¶</a>
                                                        </h6>

                                                        <p>If you have databinding subclasses, you will have implemented
                                                            <code class="docutils literal"><span class="pre">group_names(instance,</span>
                                                                <span class="pre">action)</span></code>, which returns
                                                            the groups to use based on the
                                                            instance and action provided.</p>

                                                        <p>Now, instead, you must implement <code
                                                                class="docutils literal"><span class="pre">group_names(instance)</span></code>,
                                                            which returns the
                                                            groups that can see the instance as it is presented for you;
                                                            the action
                                                            results will be worked out for you. For example, if you want
                                                            to only show
                                                            objects marked as &#8220;admin_only&#8221; to admins, and
                                                            objects without it to everyone,
                                                            previously you would have done:</p>

                                                        <div class="highlight-python">
                                                            <div class="highlight"><pre><span></span><span
                                                                    class="k">def</span> <span
                                                                    class="nf">group_names</span><span
                                                                    class="p">(</span><span class="bp">self</span><span
                                                                    class="p">,</span> <span
                                                                    class="n">instance</span><span
                                                                    class="p">,</span> <span
                                                                    class="n">action</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">instance</span><span class="o">.</span><span
                                                                        class="n">admin_only</span><span
                                                                        class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;admins&quot;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;admins&quot;</span><span class="p">,</span> <span
                                                                        class="s2">&quot;non-admins&quot;</span><span
                                                                        class="p">]</span>
</pre>
                                                            </div>
                                                        </div>
                                                        <p>Because you did nothing based on the <code
                                                                class="docutils literal"><span class="pre">action</span></code>
                                                            (and if you did, you would
                                                            have got incomplete messages, hence this design change), you
                                                            can just change
                                                            the signature of the method like this:</p>

                                                        <div class="highlight-python">
                                                            <div class="highlight"><pre><span></span><span
                                                                    class="k">def</span> <span
                                                                    class="nf">group_names</span><span
                                                                    class="p">(</span><span class="bp">self</span><span
                                                                    class="p">,</span> <span
                                                                    class="n">instance</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">instance</span><span class="o">.</span><span
                                                                        class="n">admin_only</span><span
                                                                        class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;admins&quot;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;admins&quot;</span><span class="p">,</span> <span
                                                                        class="s2">&quot;non-admins&quot;</span><span
                                                                        class="p">]</span>
</pre>
                                                            </div>
                                                        </div>
                                                        <p>Now, when an object is updated to have <code
                                                                class="docutils literal"><span
                                                                class="pre">admin_only</span> <span class="pre">=</span>
                                                            <span class="pre">True</span></code>, the clients
                                                            in the <code class="docutils literal"><span class="pre">non-admins</span></code>
                                                            group will get a <code class="docutils literal"><span
                                                                    class="pre">delete</span></code> message, while
                                                            those in
                                                            the <code class="docutils literal"><span
                                                                    class="pre">admins</span></code> group will get an
                                                            <code class="docutils literal"><span
                                                                    class="pre">update</span></code> message.</p>
                                                    </div>
                                                    <div class="section" id="demultiplexers">
                                                        <h6>Demultiplexers<a class="headerlink" href="#demultiplexers"
                                                                             title="Permalink to this headline">¶</a>
                                                        </h6>

                                                        <p>Demultiplexers have changed from using a <code
                                                                class="docutils literal"><span
                                                                class="pre">mapping</span></code> dict, which mapped
                                                            stream
                                                            names to channels, to using a <code
                                                                    class="docutils literal"><span
                                                                    class="pre">consumers</span></code> dict which maps
                                                            stream names
                                                            directly to consumer classes.</p>

                                                        <p>You will have to convert over to using direct references to
                                                            consumers, change
                                                            the name of the dict, and then you can remove any channel
                                                            routing for the old
                                                            channels that were in <code class="docutils literal"><span
                                                                    class="pre">mapping</span></code> from your routes.
                                                        </p>

                                                        <p>Additionally, the Demultiplexer now forwards messages as they
                                                            would look from
                                                            a direct connection, meaning that where you previously got a
                                                            decoded object
                                                            through you will now get a correctly-formatted <code
                                                                    class="docutils literal"><span class="pre">websocket.receive</span></code>
                                                            message
                                                            through with the content as a <code
                                                                    class="docutils literal"><span
                                                                    class="pre">text</span></code> key, JSON-encoded.
                                                            You will also
                                                            now have to handle <code class="docutils literal"><span
                                                                    class="pre">websocket.connect</span></code> and
                                                            <code class="docutils literal"><span class="pre">websocket.disconnect</span></code>
                                                            messages.</p>

                                                        <p>Both of these issues can be solved using the <code
                                                                class="docutils literal"><span class="pre">JsonWebsocketConsumer</span></code>
                                                            generic
                                                            consumer, which will decode for you and correctly separate
                                                            connection and
                                                            disconnection handling into their own methods.</p>
                                                    </div>
                                                </div>
                                            </div>
                                            <span id="document-releases/1.0.1"></span>

                                            <div class="section" id="release-notes">
                                                <h4>1.0.1 Release Notes<a class="headerlink" href="#release-notes"
                                                                          title="Permalink to this headline">¶</a></h4>

                                                <p>Channels 1.0.1 is a minor bugfix release, released on 2017/01/09.</p>

                                                <div class="section" id="changes">
                                                    <h5>Changes<a class="headerlink" href="#changes"
                                                                  title="Permalink to this headline">¶</a></h5>
                                                    <ul class="simple">
                                                        <li>WebSocket generic views now accept connections by default in
                                                            their connect
                                                            handler for better backwards compatibility.
                                                        </li>
                                                    </ul>
                                                </div>
                                                <div class="section" id="backwards-incompatible-changes">
                                                    <h5>Backwards Incompatible Changes<a class="headerlink"
                                                                                         href="#backwards-incompatible-changes"
                                                                                         title="Permalink to this headline">¶</a>
                                                    </h5>

                                                    <p>None.</p>
                                                </div>
                                            </div>
                                            <span id="document-releases/1.0.2"></span>

                                            <div class="section" id="release-notes">
                                                <h4>1.0.2 Release Notes<a class="headerlink" href="#release-notes"
                                                                          title="Permalink to this headline">¶</a></h4>

                                                <p>Channels 1.0.2 is a minor bugfix release, released on 2017/01/12.</p>

                                                <div class="section" id="changes">
                                                    <h5>Changes<a class="headerlink" href="#changes"
                                                                  title="Permalink to this headline">¶</a></h5>
                                                    <ul class="simple">
                                                        <li>Websockets can now be closed from anywhere using the new
                                                            <code class="docutils literal"><span class="pre">WebsocketCloseException</span></code>,
                                                            available as <code class="docutils literal"><span
                                                                    class="pre">channels.exceptions.WebsocketCloseException(code=None)</span></code>.
                                                            There is
                                                            also a generic <code class="docutils literal"><span
                                                                    class="pre">ChannelSocketException</span></code> you
                                                            can base any exceptions on that,
                                                            if it is caught, gets handed the current <code
                                                                    class="docutils literal"><span
                                                                    class="pre">message</span></code> in a <code
                                                                    class="docutils literal"><span
                                                                    class="pre">run</span></code> method, so you
                                                            can do custom behaviours.
                                                        </li>
                                                        <li>Calling <code class="docutils literal"><span class="pre">Channel.send</span></code>
                                                            or <code class="docutils literal"><span class="pre">Group.send</span></code>
                                                            from outside a consumer context
                                                            (i.e. in tests or management commands) will once again send
                                                            the message immediately,
                                                            rather than putting it into the consumer message buffer to
                                                            be flushed when the
                                                            consumer ends (which never happens)
                                                        </li>
                                                        <li>The base implementation of databinding now correctly only
                                                            calls <code class="docutils literal"><span class="pre">group_names(instance)</span></code>,
                                                            as documented.
                                                        </li>
                                                    </ul>
                                                </div>
                                                <div class="section" id="backwards-incompatible-changes">
                                                    <h5>Backwards Incompatible Changes<a class="headerlink"
                                                                                         href="#backwards-incompatible-changes"
                                                                                         title="Permalink to this headline">¶</a>
                                                    </h5>

                                                    <p>None.</p>
                                                </div>
                                            </div>
                                            <span id="document-releases/1.0.3"></span>

                                            <div class="section" id="release-notes">
                                                <h4>1.0.3 Release Notes<a class="headerlink" href="#release-notes"
                                                                          title="Permalink to this headline">¶</a></h4>

                                                <p>Channels 1.0.3 is a minor bugfix release, released on 2017/02/01.</p>

                                                <div class="section" id="changes">
                                                    <h5>Changes<a class="headerlink" href="#changes"
                                                                  title="Permalink to this headline">¶</a></h5>
                                                    <ul class="simple">
                                                        <li>Database connections are no longer force-closed after each
                                                            test is run.
                                                        </li>
                                                        <li>Channel sessions are not re-saved if they&#8217;re empty
                                                            even if they&#8217;re marked as
                                                            modified, allowing logout to work correctly.
                                                        </li>
                                                        <li>WebsocketDemultiplexer now correctly does sessions for the
                                                            second/third/etc.
                                                            connect and disconnect handlers.
                                                        </li>
                                                        <li>Request reading timeouts now correctly return 408 rather
                                                            than erroring out.
                                                        </li>
                                                        <li>The <code class="docutils literal"><span class="pre">rundelay</span></code>
                                                            delay server now only polls the database once per second,
                                                            and this interval is configurable with the <code
                                                                    class="docutils literal"><span
                                                                    class="pre">--sleep</span></code> option.
                                                        </li>
                                                    </ul>
                                                </div>
                                                <div class="section" id="backwards-incompatible-changes">
                                                    <h5>Backwards Incompatible Changes<a class="headerlink"
                                                                                         href="#backwards-incompatible-changes"
                                                                                         title="Permalink to this headline">¶</a>
                                                    </h5>

                                                    <p>None.</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>


                    </div>
                </div>
                <footer>


                    <hr/>

                    <div role="contentinfo">
                        <p>
                            &copy; Copyright 2017, Andrew Godwin.
      
        <span class="commit">
          Revision <code>20af4e31</code>.
        </span>


                        </p>
                    </div>
                    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a
                        href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a
                        href="https://readthedocs.org">Read the Docs</a>.

                </footer>

            </div>
        </div>

    </section>

</div>


<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Read the Docs</span>
      v: stable
      <span class="fa fa-caret-down"></span>
    </span>

    <div class="rst-other-versions">
        <dl>
            <dt>Versions</dt>

            <dd><a href="/en/latest/">latest</a></dd>

            <dd><a href="/en/stable/">stable</a></dd>

        </dl>
        <dl>
            <dt>Downloads</dt>

            <dd><a href="//readthedocs.org/projects/channels/downloads/pdf/stable/">pdf</a></dd>

            <dd><a href="//readthedocs.org/projects/channels/downloads/htmlzip/stable/">htmlzip</a></dd>

            <dd><a href="//readthedocs.org/projects/channels/downloads/epub/stable/">epub</a></dd>

        </dl>
        <dl>
            <dt>On Read the Docs</dt>
            <dd>
                <a href="//readthedocs.org/projects/channels/?fromdocs=channels">Project Home</a>
            </dd>
            <dd>
                <a href="//readthedocs.org/builds/channels/?fromdocs=channels">Builds</a>
            </dd>
        </dl>
        <hr/>
        Free document hosting provided by <a href="http://www.readthedocs.org">Read the Docs</a>.

    </div>
</div>


<script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
        URL_ROOT: './',
        VERSION: '1.0.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE: true
    };
</script>
<script type="text/javascript" src="_static/jquery.js"></script>
<script type="text/javascript" src="_static/underscore.js"></script>
<script type="text/javascript" src="_static/doctools.js"></script>


<script type="text/javascript">
    jQuery(function () {
        SphinxRtdTheme.StickyNav.enable();
    });
</script>


</body>
</html>
